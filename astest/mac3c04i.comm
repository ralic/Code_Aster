# TITRE SIMULATION NUMERIQUE DU COMPORTEMENT D'UN ASSEMBLAGE COMBUSTIBLE EN COMPRESSION ET EN FLEXION
# ======================================================================
# COPYRIGHT (C) 1991 - 2013  EDF R&D                  WWW.CODE-ASTER.ORG
# THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY  
# IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY  
# THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR     
# (AT YOUR OPTION) ANY LATER VERSION.                                                    
#                                                                       
# THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT   
# WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF            
# MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU      
# GENERAL PUBLIC LICENSE FOR MORE DETAILS.                              
#                                                                       
# YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE     
# ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,         
#    1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.        
# ======================================================================

# UTILISATION : COMPARAISON DE LA SIMULATION NUMERIQUE D'UN ASSEMBLAGE
#               COMBUSTIBLE EN COMPRESSION AVEC LES RESULTATS EXPERIMENTAUX

DEBUT(CODE=_F(NIV_PUB_WEB='INTRANET'),IMPR_MACRO='NON',PAR_LOT='NON')

tabn = LIRE_TABLE(UNITE      = 38,
                  FORMAT     = 'LIBRE',
                  SEPARATEUR = '\t')

MA1=LIRE_MAILLAGE(FORMAT='MED',UNITE=20);

COMPR = CALC_MAC3COEUR(TYPE_COEUR  = 'MONO_FROID',
                      TABLE_N     =  tabn,
                      MAILLAGE_N  =  MA1,
                      DEFORMATION = _F(UNITE_THYC   = 32,
                                       NIVE_FLUENCE = 0.,
                                       TYPE_MAINTIEN = 'FORCE',
                                       FORCE_MAINTIEN = 38920.,
                                       ARCHIMEDE      = 'NON',
                                       ),)

#----------------------------------------------------------------------
# TRACER LA COURBE FORCE-DEPLACEMENT
#----------------------------------------------------------------------

# courbe de charge de l'essai de compression

# COMP_CH = LIRE_FONCTION(UNITE=21,
#                     NOM_PARA='DX',
#                     PROL_DROITE='CONSTANT',
#                     PROL_GAUCHE = 'CONSTANT',);
# 
# # courbe de decharge de l'essai de compression
# 
# COMP_DCH = LIRE_FONCTION(UNITE=22,
#                     NOM_PARA='DX',
#                     PROL_DROITE='CONSTANT',
#                     PROL_GAUCHE = 'CONSTANT',);
# 
# 
# 
COMPR=CALC_CHAMP(reuse =COMPR,
                 RESULTAT=COMPR,
                 FORCE=('FORC_NODA',),)

POST1=POST_RELEVE_T(ACTION=_F(OPERATION='EXTRACTION',
                              INTITULE='DX',
                              RESULTAT =COMPR,
                              NOM_CHAM ='DEPL',
                              NOM_CMP = 'DX',
                              GROUP_NO='PEBO_S',
                              ),)

# on decale sur 0. l'origine de la table POST1
# pour retrancher le deplacement du a la pesanteur.
ini=POST1['DX',2]
fdecal='(DX-%(ini)e) * -1.    '
formul = FORMULE(VALE=fdecal%locals(),NOM_PARA=('DX',),)
POST1=CALC_TABLE(reuse=POST1,TABLE=POST1,ACTION=_F(OPERATION='OPER',FORMULE=formul,NOM_PARA='DXdecal',),)
POST1=CALC_TABLE(reuse=POST1,TABLE=POST1,ACTION=_F(OPERATION='EXTR',NOM_PARA=('INST','DXdecal',),),)
POST1=CALC_TABLE(reuse=POST1,TABLE=POST1,ACTION=_F(OPERATION='RENOMME',NOM_PARA=['DXdecal','DX']),)


DEPLC=RECU_FONCTION(TABLE=POST1,PARA_X='INST',PARA_Y='DX',)

POST2=POST_RELEVE_T(
   ACTION=_F(INTITULE='FORCES',
             GROUP_NO=('PMNT_S'),
             RESULTAT=COMPR,
             NOM_CHAM='FORC_NODA',
             RESULTANTE=('DX','DY','DZ'),
             REPERE='GLOBAL',
             OPERATION='EXTRACTION',),)
FORC2=RECU_FONCTION(
             TABLE=POST2,
             PARA_X='INST',
             PARA_Y='DX',
             PROL_DROITE='CONSTANT',
             PROL_GAUCHE='CONSTANT',)

FORCC=CALC_FONCTION(COMB=_F(FONCTION=FORC2, COEF=-1.,),)
# 
# # l'activation des commandes suivantes permet
# # de tracer la courbe force-deplacement
# IMPR_FONCTION(FORMAT='XMGRACE',UNITE=29,
#               COURBE=(_F(FONCTION=COMP_CH ,LEGENDE='essai compression - charge'  ,MARQUEUR =   0,COULEUR =    2,STYLE = 1,),
#                       _F(FONCTION=COMP_DCH,LEGENDE='essai compression - decharge',MARQUEUR =   0,COULEUR =    2,STYLE = 1,),
#                       _F(FONC_X=DEPLC,FONC_Y=FORCC,LEGENDE='Calcul',MARQUEUR =   0,COULEUR =    4,STYLE = 1,),
# ),
#               BORNE_X=(0.,1.3E-3),BORNE_Y=(0.,40000.),ECHELLE_X='LIN',ECHELLE_Y='LIN',GRILLE_X=0.2E-3,GRILLE_Y=100.,LEGENDE_X='DX(mm)',LEGENDE_Y='effort (N)',
#               TITRE='Recalage essai de compression AFA3GLRAA_N4',)

TEST_TABLE(CRITERE='RELATIF',REFERENCE='SOURCE_EXTERNE',PRECISION=0.3,  VALE_CALC=9.59626E-05,VALE_REFE=7.4263988494e-05  ,NOM_PARA='DX',TABLE=POST1,FILTRE=_F(NOM_PARA='INST',VALE=5.500E-4,),)
TEST_TABLE(CRITERE='RELATIF',REFERENCE='SOURCE_EXTERNE',PRECISION=0.01, VALE_CALC=4.80932E-04,VALE_REFE=0.000485481476881 ,NOM_PARA='DX',TABLE=POST1,FILTRE=_F(NOM_PARA='INST',VALE=7.500E-4,),)
TEST_TABLE(CRITERE='RELATIF',REFERENCE='SOURCE_EXTERNE',PRECISION=0.02, VALE_CALC=6.03972E-04,VALE_REFE=0.000611054806408 ,NOM_PARA='DX',TABLE=POST1,FILTRE=_F(NOM_PARA='INST',VALE=8.000E-4,),)
TEST_TABLE(CRITERE='RELATIF',REFERENCE='SOURCE_EXTERNE',PRECISION=0.008,VALE_CALC=8.90814E-04,VALE_REFE=0.000884621188877 ,NOM_PARA='DX',TABLE=POST1,FILTRE=_F(NOM_PARA='INST',VALE=9.000E-4,),)
TEST_TABLE(CRITERE='RELATIF',REFERENCE='SOURCE_EXTERNE',PRECISION=0.02, VALE_CALC=0.00118476648405 ,VALE_REFE=0.00120005452312  ,NOM_PARA='DX',TABLE=POST1,FILTRE=_F(NOM_PARA='INST',VALE=1.000E-3,),)
TEST_TABLE(CRITERE='RELATIF',REFERENCE='SOURCE_EXTERNE',PRECISION=0.03, VALE_CALC=0.00108881348821,VALE_REFE=0.00111746167353  , NOM_PARA='DX',TABLE=POST1,FILTRE=_F(NOM_PARA='INST',VALE=8.050E-3,),)
TEST_TABLE(CRITERE='RELATIF',REFERENCE='SOURCE_EXTERNE',PRECISION=0.04, VALE_CALC=9.92859E-04,VALE_REFE=0.00103298995006  ,NOM_PARA='DX',TABLE=POST1,FILTRE=_F(NOM_PARA='INST',VALE=8.1E-3,),)
TEST_TABLE(CRITERE='RELATIF',REFERENCE='SOURCE_EXTERNE',PRECISION=0.07, VALE_CALC=8.00948E-04,VALE_REFE=0.000858012695368 ,NOM_PARA='DX',TABLE=POST1,FILTRE=_F(NOM_PARA='INST',VALE=8.2E-3,),)
TEST_TABLE(CRITERE='RELATIF',REFERENCE='SOURCE_EXTERNE',PRECISION=0.11, VALE_CALC=6.09032E-04,VALE_REFE=0.000677927085904,NOM_PARA='DX',TABLE=POST1,FILTRE=_F(NOM_PARA='INST',VALE=8.3E-3,),)
TEST_TABLE(CRITERE='RELATIF',REFERENCE='SOURCE_EXTERNE',PRECISION=0.15, VALE_CALC=4.17112E-04,VALE_REFE=0.000487670986385,NOM_PARA='DX',TABLE=POST1,FILTRE=_F(NOM_PARA='INST',VALE=8.400E-3,),)
TEST_TABLE(CRITERE='RELATIF',REFERENCE='SOURCE_EXTERNE',PRECISION=0.2,  VALE_CALC=0.00022518759171,VALE_REFE=0.000279523      ,NOM_PARA='DX',TABLE=POST1,FILTRE=_F(NOM_PARA='INST',VALE=8.500E-3,),)

TEST_FONCTION(VALEUR=_F(CRITERE='ABSOLU',REFERENCE='SOURCE_EXTERNE',PRECISION=0.5,VALE_CALC=3.89200E+03 ,VALE_REFE=3.89200E+03,NOM_PARA='DX',FONCTION=FORCC,VALE_PARA=5.500E-4,),)
TEST_FONCTION(VALEUR=_F(CRITERE='ABSOLU',REFERENCE='SOURCE_EXTERNE',PRECISION=0.5,VALE_CALC=1.94600E+04 ,VALE_REFE=1.94600E+04,NOM_PARA='DX',FONCTION=FORCC,VALE_PARA=7.500E-4,),)
TEST_FONCTION(VALEUR=_F(CRITERE='ABSOLU',REFERENCE='SOURCE_EXTERNE',PRECISION=0.5,VALE_CALC=2.33520E+04 ,VALE_REFE=2.33520E+04,NOM_PARA='DX',FONCTION=FORCC,VALE_PARA=8.000E-4,),)
TEST_FONCTION(VALEUR=_F(CRITERE='ABSOLU',REFERENCE='SOURCE_EXTERNE',PRECISION=0.5,VALE_CALC=3.11360E+04 ,VALE_REFE=3.11360E+04,NOM_PARA='DX',FONCTION=FORCC,VALE_PARA=9.000E-4,),)
TEST_FONCTION(VALEUR=_F(CRITERE='ABSOLU',REFERENCE='SOURCE_EXTERNE',PRECISION=0.5,VALE_CALC=3.89200E+04 ,VALE_REFE=3.89200E+04,NOM_PARA='DX',FONCTION=FORCC,VALE_PARA=1.000E-3,),)
TEST_FONCTION(VALEUR=_F(CRITERE='ABSOLU',REFERENCE='SOURCE_EXTERNE',PRECISION=0.5,VALE_CALC=3.50280E+04 ,VALE_REFE=3.50280E+04,NOM_PARA='DX',FONCTION=FORCC,VALE_PARA=8.050E-3,),)
TEST_FONCTION(VALEUR=_F(CRITERE='ABSOLU',REFERENCE='SOURCE_EXTERNE',PRECISION=0.5,VALE_CALC=3.11360E+04 ,VALE_REFE=3.11360E+04,NOM_PARA='DX',FONCTION=FORCC,VALE_PARA=8.1E-3,),)
TEST_FONCTION(VALEUR=_F(CRITERE='ABSOLU',REFERENCE='SOURCE_EXTERNE',PRECISION=0.5,VALE_CALC=2.33520E+04 ,VALE_REFE=2.33520E+04,NOM_PARA='DX',FONCTION=FORCC,VALE_PARA=8.2E-3,),)
TEST_FONCTION(VALEUR=_F(CRITERE='ABSOLU',REFERENCE='SOURCE_EXTERNE',PRECISION=0.5,VALE_CALC=1.55680E+04 ,VALE_REFE=1.55680E+04,NOM_PARA='DX',FONCTION=FORCC,VALE_PARA=8.3E-3,),)
TEST_FONCTION(VALEUR=_F(CRITERE='ABSOLU',REFERENCE='SOURCE_EXTERNE',PRECISION=0.5,VALE_CALC=7.78400E+03 ,VALE_REFE=7.78400E+03,NOM_PARA='DX',FONCTION=FORCC,VALE_PARA=8.4E-3,),)
TEST_FONCTION(VALEUR=_F(CRITERE='ABSOLU',REFERENCE='SOURCE_EXTERNE',PRECISION=0.5,VALE_CALC=2.97429E-13 ,VALE_REFE=2.97749E-13,NOM_PARA='DX',FONCTION=FORCC,VALE_PARA=8.500E-3,),)


FIN()
