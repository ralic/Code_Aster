# MODIF  DATE 09/07/2012   AUTEUR PELLET J.PELLET 
# TITRE ROTOR FISSURE TOURNANT SOUMIS A UN MOMENT DE FLEXION
# sdnl133b.para = tps_job 60 mem_job 128Mo ncpus 1 liste_test S
#            CONFIGURATION MANAGEMENT OF EDF VERSION
# ======================================================================
# COPYRIGHT (C) 1991 - 2012  EDF R&D                  WWW.CODE-ASTER.ORG
# THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY
# IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY
# THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR
# (AT YOUR OPTION) ANY LATER VERSION.
#
# THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT
# WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF
# MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU
# GENERAL PUBLIC LICENSE FOR MORE DETAILS.
#
# YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE
# ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,
#    1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.
# ======================================================================

DEBUT(CODE=_F(NOM='SDNL133B', NIV_PUB_WEB='INTERNET',),
      IGNORE_ALARM=('MODELISA4_9',)
      )

tfin = 1.;
fmax=250.

pas = 1e-05;

YOUNG = 210.e9;

DIAM = .8;
LONG = (2.0 * DIAM);
I = (((((pi * DIAM) * DIAM) * DIAM) * DIAM) / 64.0);
PEN = YOUNG*I/2/LONG


coef=10000.
raidmax = coef*PEN


MAIL1=LIRE_MAILLAGE();

MAIL1=DEFI_GROUP(reuse =MAIL1,
              MAILLAGE=MAIL1,
              CREA_GROUP_NO=(_F(GROUP_MA=('ROTOR',),),),)

MODELE=AFFE_MODELE(MAILLAGE=MAIL1,
                   AFFE=(_F(GROUP_MA='ROTOR',
                            PHENOMENE='MECANIQUE',
                            MODELISATION='POU_D_E',),
                         _F(GROUP_MA='FIS',
                            PHENOMENE='MECANIQUE',
                            MODELISATION='DIS_TR',),),);

ACIER=DEFI_MATERIAU(ELAS=_F(E=YOUNG,
                            NU=0.3,
                            RHO=7800.0,),);

CHMAT=AFFE_MATERIAU(MAILLAGE=MAIL1,
                    AFFE=_F(GROUP_MA='ROTOR',
                            MATER=ACIER,),);

CARELEM=AFFE_CARA_ELEM(MODELE=MODELE,
                       POUTRE=_F(GROUP_MA='ROTOR',
                                 SECTION='CERCLE',
                                 CARA='R',
                                 VALE=(DIAM / 2.0),),
                       DISCRET=(_F(CARA='K_TR_D_L',
                                  GROUP_MA='FIS',
                                  VALE=(raidmax,raidmax,raidmax,raidmax,raidmax,raidmax,),),
                                _F(CARA='M_TR_D_L', GROUP_MA='FIS', VALE=(0,0,0,0)),))

CARELEF=AFFE_CARA_ELEM(MODELE=MODELE,
                       POUTRE=_F(GROUP_MA='ROTOR',
                                 SECTION='CERCLE',
                                 CARA='R',
                                 VALE=(DIAM / 2.0),),
                       DISCRET=(_F(CARA='K_TR_D_L',
                                  GROUP_MA='FIS',
                                  VALE=(raidmax,raidmax,raidmax,0,raidmax,0,),),
                                _F(CARA='M_TR_D_L', GROUP_MA='FIS', VALE=(0,0,0,0)),))

BLOQUAGE=AFFE_CHAR_MECA(MODELE=MODELE,
                        DDL_IMPO=(_F(GROUP_NO='PAL_G',
                                     DX=0.,
                                     DY=0.,
                                     DZ=0.,
                                     DRX=0.,
                                     DRY=0.,
                                     DRZ=0.,),
                                  _F(GROUP_NO='PAL_D',
                                     DRY=0.,),),);


MACRO_MATR_ASSE(MODELE=MODELE,
                CHAM_MATER=CHMAT,
                CARA_ELEM=CARELEM,
                CHARGE=BLOQUAGE,
                NUME_DDL=CO('NUD'),
                MATR_ASSE=(_F(MATRICE=CO('RIGIAS'),
                              OPTION='RIGI_MECA',),
                           _F(MATRICE=CO('MASSAS'),
                              OPTION='MASS_MECA',),),);

MODES=MODE_ITER_SIMULT(MATR_A=RIGIAS,
                       MATR_B=MASSAS,
                       VERI_MODE=_F(STURM='NON',),
                       CALC_FREQ=_F(OPTION='BANDE',
                                    FREQ=(-1,fmax,),),);


MACRO_MATR_ASSE(MODELE=MODELE,
                CHAM_MATER=CHMAT,
                CARA_ELEM=CARELEF,
                CHARGE=BLOQUAGE,
                NUME_DDL=NUD,
                MATR_ASSE=(_F(MATRICE=CO('RIGIAF'),
                              OPTION='RIGI_MECA',),
                           _F(MATRICE=CO('MASSAF'),
                              OPTION='MASS_MECA',),),);

MODFF=MODE_ITER_SIMULT(MATR_A=RIGIAF,
                       MATR_B=MASSAF,
                       VERI_MODE=_F(STURM='NON',SEUIL=1.E-4),
                       CALC_FREQ=_F(OPTION='BANDE',
                                    FREQ=(-1,fmax,),),);


MODEF=EXTR_MODE(FILTRE_MODE=_F(MODE=MODFF, NUME_MODE=(1,2,), ),);


BMOD=DEFI_BASE_MODALE(RITZ=_F(MODE_MECA=(MODEF,MODES,),),
                      NUME_REF=NUD,);


PROJ_BASE(  BASE=BMOD,
            STOCKAGE='PLEIN',
            MATR_ASSE_GENE=(
             _F(
                             MATRICE = CO("MASSEGEN"),
                             MATR_ASSE = MASSAF),
             _F(
                             MATRICE = CO("RIGIDGEN"),
                             MATR_ASSE = RIGIAF)),
             )


CHA_FX=AFFE_CHAR_MECA(MODELE=MODELE,
                      FORCE_NODALE=_F(
                        GROUP_NO='PAL_D',
                                      MX=1.,),);

CHA_FZ=AFFE_CHAR_MECA(MODELE=MODELE,
                      FORCE_NODALE=_F(
                        GROUP_NO='PAL_D',
          MZ=0.,),);


VEC_FX=CALC_VECT_ELEM(  CHARGE=(CHA_FX,),
                         OPTION='CHAR_MECA',
                         CARA_ELEM=CARELEM,
    );

VEC_FZ=CALC_VECT_ELEM(  CHARGE=(CHA_FZ,),
                         OPTION='CHAR_MECA',
                         CARA_ELEM=CARELEM,
    );

VASFZ=ASSE_VECTEUR(  VECT_ELEM=VEC_FZ,  NUME_DDL=NUD );

VASFX=ASSE_VECTEUR(  VECT_ELEM=VEC_FX,  NUME_DDL=NUD );

F_K1=LIRE_FONCTION(UNITE=38,
                  NOM_PARA='ABSC',
    INDIC_PARA=[1,1],
    INDIC_RESU=[1,2],
                  PROL_DROITE="LINEAIRE",
                  PROL_GAUCHE="LINEAIRE",
    INTERPOL='LIN')

F_KP1=LIRE_FONCTION(UNITE=38,
                  NOM_PARA='ABSC',
    INDIC_PARA=[1,1],
    INDIC_RESU=[1,3],
                  PROL_DROITE="LINEAIRE",
                  PROL_GAUCHE="LINEAIRE",
    INTERPOL='LIN')

F_K=CALC_FONCTION(COMB=(_F(FONCTION=F_K1, COEF=PEN)))
F_KP=CALC_FONCTION(COMB=(_F(FONCTION=F_KP1, COEF=PEN)))

IMPR_FONCTION(FORMAT='XMGRACE',
              UNITE=29,
       COURBE=(_F(FONCTION=F_K,MARQUEUR=0),
               _F(FONCTION=F_KP,MARQUEUR=0),),)


RAMP=DEFI_FONCTION(NOM_PARA='INST',
                   VALE=(0,0,
                         0.2,1,
                         10,1,
                         ),);


PROJ_BASE(  BASE=BMOD,
            STOCKAGE='PLEIN',
            MATR_ASSE_GENE=(
             _F(
                             MATRICE = CO("MASGEN"),
                             MATR_ASSE = MASSAF),
             _F(
                             MATRICE = CO("RIGGEN"),
                             MATR_ASSE = RIGIAF)),
             VECT_ASSE_GENE=(
                            _F( VECTEUR = CO("VAGFZ"), VECT_ASSE = VASFZ,),
                            _F( VECTEUR = CO("VAGFX"), VECT_ASSE = VASFX,),
             ))


TRANGEN = DYNA_VIBRA   (     MATR_MASS=MASGEN,   MATR_RIGI=RIGGEN,
                             BASE_CALCUL ='GENE',
                             TYPE_CALCUL ='TRAN',
                             SCHEMA_TEMPS=_F(SCHEMA='EULER'),
                             AMOR_MODAL= _F(AMOR_REDUIT=.5),
                             INCREMENT=_F(  INST_INIT = 0.,  INST_FIN = tfin, PAS = pas, VERI_PAS='NON'),
                             EXCIT=(
                                    _F(VECT_ASSE_GENE=VAGFZ,FONC_MULT=RAMP,),
                                    _F(VECT_ASSE_GENE=VAGFX,FONC_MULT=RAMP,),
                                    ),
                             ROTOR_FISS =  _F(
                                                NOEUD_G = 'N2',
                                                NOEUD_D = 'N3',
                                                ANGL_INIT=0.,
                                                VITE_ROTA=-10.*pi,
                                                K_PHI=F_K,
                                                DK_DPHI=F_KP,)
                             )




DEPN4Z=RECU_FONCTION(RESU_GENE=TRANGEN,
                      NOM_CHAM='DEPL',
                      NOM_CMP='DZ',
                      NOEUD='N4',);


IMPR_FONCTION(FORMAT='XMGRACE',
              UNITE=31,
              COURBE=(
                      _F(FONCTION=DEPN4Z, MARQUEUR=0,),
              ))


TEST_FONCTION(VALEUR=(_F(FONCTION=DEPN4Z,
                         VALE_PARA=0.9*tfin,
                         VALE_REFE=4.8308805E-09,
                         REFERENCE='NON_REGRESSION',
                         PRECISION=1E-6,
                         VERSION='11.00'),
                      _F(FONCTION=DEPN4Z,
                         VALE_PARA=tfin,
                         VALE_REFE=1.8442027E-09,
                         PRECISION=1E-6,
                         REFERENCE='NON_REGRESSION',
                         VERSION='11.00')));

TEST_FONCTION(VALEUR=(_F(FONCTION=DEPN4Z,
                         VALE_PARA=0.9*tfin,
                         VALE_REFE=4.52765E-09,
                         PRECISION=.1,
                         REFERENCE='AUTRE_ASTER',
                         ),
                      _F(FONCTION=DEPN4Z,
                         VALE_PARA=tfin,
                         VALE_REFE=1.77757E-09,
                         PRECISION=.1,
                         REFERENCE='AUTRE_ASTER',
                         )));

LIDEPO=DEFI_LIST_REEL(DEBUT=0, INTERVALLE=_F(JUSQU_A=tfin, PAS=1.E-3,),);

TRA=REST_GENE_PHYS(RESU_GENE=TRANGEN,
                   LIST_INST=LIDEPO,
                   CRITERE='ABSOLU',
                   PRECISION=pas/10.,
                   NOM_CHAM='DEPL',);



DEPE_1=POST_RELEVE_T(ACTION=_F(OPERATION='EXTRACTION',
                             INTITULE='FERMEE',
                             RESULTAT=TRA,
                             NOM_CHAM='DEPL',
                             GROUP_NO='ROTOR',
                             INST=tfin,
                             NOM_CMP=('DX','DY','DZ',),))

IMPR_TABLE(UNITE=36, TABLE=DEPE_1)


DEPE_2=POST_RELEVE_T(ACTION=_F(OPERATION='EXTRACTION',
                             INTITULE='OUVERTE',
                             RESULTAT=TRA,
                             NOM_CHAM='DEPL',
                             GROUP_NO='ROTOR',
                             INST=.9*tfin,
                             NOM_CMP=('DX','DY','DZ',),))

IMPR_TABLE(UNITE=37, TABLE=DEPE_2)

FIN();
