# MODIF  DATE 17/07/2007   AUTEUR PELLET J.PELLET 
# TITRE SENSIBILITE DE MODES PROPRES REELS D'UNE POUTRE POU_D_E
#            CONFIGURATION MANAGEMENT OF EDF VERSION
# ======================================================================
# COPYRIGHT (C) 1991 - 2005  EDF R&D                  WWW.CODE-ASTER.ORG
# THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY
# IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY
# THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR
# (AT YOUR OPTION) ANY LATER VERSION.
#
# THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT
# WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF
# MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU
# GENERAL PUBLIC LICENSE FOR MORE DETAILS.
#
# YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE
# ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,
#    1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.
# ======================================================================
#       PAR RAPPORT AUX PARAMETRES MATERIAU
#       (CALCUL MODAL PAR ITERATION INVERSE)

DEBUT(CODE=_F(NOM='SENSD09A', NIV_PUB_WEB='INTERNET', VISU_EFICAS='NON'), PAR_LOT='OUI', DEBUG=_F(SDVERI='NON'))
# ----------------------------------------------------------------------
# Poutre a section circulaire (L=0.4m, r=0.02m, ep=0.02m)
# Sensibilite des modes propres par rapport a E et NU
# Conditions aux limites : appuyee-appuyee (flexion)
#                          encastree-encastree (torsion)
# La solution de reference est obtenue analytiquement
# ----------------------------------------------------------------------

pi = 3.14159
r = 0.02
ep = 0.02
l = 0.4
rho = 7800.

#           E     NU
sensible=[2.1E11, 0.3, ]

n=len(sensible)
PS=[None]*n

for i in range(n):
    PS[i]=DEFI_PARA_SENSI(VALE=sensible[i])

MAILLAGE=LIRE_MAILLAGE();

MO=AFFE_MODELE(MAILLAGE=MAILLAGE,
               AFFE=_F(GROUP_MA=('POUTRE',),
                       PHENOMENE='MECANIQUE',
                       MODELISATION='POU_D_E',),);

MAT=DEFI_MATERIAU(ELAS_FO=_F(E=PS[0],
                             RHO=rho,
                             NU=PS[1],
                             ),);

CHMAT=AFFE_MATERIAU(MAILLAGE=MAILLAGE,
                    AFFE=(_F(GROUP_MA=('POUTRE',),MATER=MAT,),),)

CARELE=AFFE_CARA_ELEM(MODELE= MO,
                      POUTRE= (_F(GROUP_MA= ( 'POUTRE',),
                                 SECTION= 'CERCLE',
                                 CARA= ('R','EP',),
                                 VALE= (r, ep,),),
                      ),)

CLIM=AFFE_CHAR_MECA(MODELE=MO,
                    DDL_IMPO=(_F(GROUP_NO='FIXE',DX=0.,DZ=0.,DRX=0.,),
                              _F(GROUP_NO='TOUT',DY=0.,DRZ=0.,),),);

MATELER=CALC_MATR_ELEM(MODELE=MO,OPTION='RIGI_MECA',
                       CHAM_MATER=CHMAT,
                       CARA_ELEM=CARELE,
                       CHARGE=CLIM);

MATELEM=CALC_MATR_ELEM(MODELE=MO,
                       OPTION='MASS_MECA',
                       CHAM_MATER=CHMAT,
                       CARA_ELEM=CARELE,
                       CHARGE=CLIM);

NUM=NUME_DDL(MATR_RIGI=MATELER);

MATASSR=ASSE_MATRICE(MATR_ELEM=MATELER,NUME_DDL=NUM);

MATASSM=ASSE_MATRICE(MATR_ELEM=MATELEM,NUME_DDL=NUM);

# calcul de la solution analytique
def sqrt(x):
    return x**.5

f1 = pi*r*sqrt(sensible[0]/rho)/(4.*l*l)
f2 = 4*f1
ft = sqrt(sensible[0]/(2*rho*(1+sensible[1])))/(2.*l)
df1_e = f1/(2.*sensible[0])
df2_e= 4*df1_e
dft_e = ft/(2*sensible[0])
df1_nu = 0.0
df2_nu= 0.0
dft_nu = -ft/(2*(1+sensible[1]))

# MODES REELS

MODE=MODE_ITER_INV(MATR_A=MATASSR,MATR_B=MATASSM,
         SENSIBILITE=(PS[0],PS[1],),CHAM_MATER=CHMAT,CARA_ELEM=CARELE,
         CALC_FREQ=_F(FREQ=(f1,f2,ft,),OPTION='PROCHE'),
#         VERI_MODE=(_F(STOP_ERREUR='OUI',SEUIL=1.E-2),),
         )

#IMPR_RESU(FORMAT='RESULTAT',
#          RESU=(_F(RESULTAT=MODE,),
#                _F(RESULTAT=MODE,SENSIBILITE=(PS[0],),),
#                _F(RESULTAT=MODE,SENSIBILITE=(PS[1],),),),)

TEST_RESU(RESU=(
          _F( RESULTAT = MODE, PARA = 'FREQ', REFERENCE='ANALYTIQUE',
                CRITERE = 'RELATIF', PRECISION = 1.E-2,
                NUME_ORDRE = 1, VALE = f1),
          _F( RESULTAT = MODE, PARA = 'FREQ', REFERENCE='ANALYTIQUE',
                CRITERE = 'RELATIF', PRECISION = 1.E-2,
                NUME_ORDRE = 2, VALE = f2),
          _F( RESULTAT = MODE, PARA = 'FREQ', REFERENCE='ANALYTIQUE',
                CRITERE = 'RELATIF', PRECISION = 1.E-2,
                NUME_ORDRE = 3, VALE = ft),
          _F( RESULTAT = MODE, PARA = 'FREQ', REFERENCE='ANALYTIQUE',
                CRITERE = 'RELATIF', PRECISION = 1.E-2,
                SENSIBILITE=PS[0],
                NUME_ORDRE = 1, VALE = df1_e),
          _F( RESULTAT = MODE, PARA = 'FREQ', REFERENCE='ANALYTIQUE',
                CRITERE = 'RELATIF', PRECISION = 1.E-2,
                SENSIBILITE=PS[0],
                NUME_ORDRE = 2, VALE = df2_e),
          _F( RESULTAT = MODE, PARA = 'FREQ', REFERENCE='ANALYTIQUE',
                CRITERE = 'RELATIF', PRECISION = 1.E-2,
                SENSIBILITE=PS[0],
                NUME_ORDRE = 3, VALE = dft_e),
          _F( RESULTAT = MODE, PARA = 'FREQ', REFERENCE='ANALYTIQUE',
                CRITERE = 'ABSOLU', PRECISION = 1.E-15,
                SENSIBILITE=PS[1],
                NUME_ORDRE = 1, VALE = df1_nu),
          _F( RESULTAT = MODE, PARA = 'FREQ', REFERENCE='ANALYTIQUE',
                CRITERE = 'ABSOLU', PRECISION = 1.E-15,
                SENSIBILITE=PS[1],
                NUME_ORDRE = 2, VALE = df2_nu),
          _F( RESULTAT = MODE, PARA = 'FREQ', REFERENCE='ANALYTIQUE',
                CRITERE = 'RELATIF', PRECISION = 1.E-2,
                SENSIBILITE=PS[1],
                NUME_ORDRE = 3, VALE = dft_nu),
          _F( RESULTAT = MODE, REFERENCE='ANALYTIQUE',
                NOM_CHAM='DEPL',GROUP_NO='MILIEU',NOM_CMP='DZ',
                CRITERE = 'ABSOLU', PRECISION = 1.E-15,
                SENSIBILITE=PS[0],
                NUME_ORDRE = 1, VALE = 0.E0),
          _F( RESULTAT = MODE, REFERENCE='ANALYTIQUE',
                NOM_CHAM='DEPL',GROUP_NO='MILIEU',NOM_CMP='DRX',
                CRITERE = 'ABSOLU', PRECISION = 1.E-10,
                SENSIBILITE=PS[0],
                NUME_ORDRE = 3, VALE = 0.E0),
          _F( RESULTAT = MODE, REFERENCE='ANALYTIQUE',
                NOM_CHAM='DEPL',GROUP_NO='MILIEU',NOM_CMP='DZ',
                CRITERE = 'ABSOLU', PRECISION = 1.E-15,
                SENSIBILITE=PS[1],
                NUME_ORDRE = 1, VALE = 0.E0),
          _F( RESULTAT = MODE, REFERENCE='ANALYTIQUE',
                NOM_CHAM='DEPL',GROUP_NO='MILIEU',NOM_CMP='DRX',
                CRITERE = 'ABSOLU', PRECISION = 1.E-10,
                SENSIBILITE=PS[1],
                NUME_ORDRE = 3, VALE = 0.E0),
          ),)

FIN()

