# MODIF  DATE 15/11/2004   AUTEUR MCOURTOI M.COURTOIS 
# TITRE TP2 FORMATION THERMOPLASTICITE. PLAQUE TROUEE EN TRACTION. 
#            CONFIGURATION MANAGEMENT OF EDF VERSION
# ======================================================================
# COPYRIGHT (C) 1991 - 2001  EDF R&D                  WWW.CODE-ASTER.ORG
# THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY
# IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY
# THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR   
# (AT YOUR OPTION) ANY LATER VERSION.                                 
#
# THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT 
# WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF          
# MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU    
# GENERAL PUBLIC LICENSE FOR MORE DETAILS.                            
#
# YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE   
# ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,       
#    1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.      
# ======================================================================
# MODELISATION C : RECALCUL DES CONTRAINTES ET VARIABLES INTERNES 
# A PARTIR DES DEPLACEMENTS STOCKES AU FORMAT IDEAS
#####################

#####################
## LE DEBUT EST IDENTIQUE AU PREMIER CALCUL
## LA DIFFERENCE VIENT DU STAT_NON_LINE



DEBUT(CODE=_F( NOM = 'SSNP115C',NIV_PUB_WEB='INTERNET'))

PRE_GIBI()

M=LIRE_MAILLAGE(VERI_MAIL=_F(VERIF='NON'),   )

MO=AFFE_MODELE(            MAILLAGE=M,
                                   VERIF='MAILLE',
                                  AFFE=_F(  TOUT = 'OUI',
                                         PHENOMENE = 'MECANIQUE',
                                         MODELISATION = 'C_PLAN'))

CTRAC=DEFI_FONCTION(    NOM_PARA='EPSI',
                                VALE=(
                                       0.004, 4.,
                                       0.006,  5., 
                                       0.009,  5.5, 
                                       0.02,  6.,
                                      ),
                            PROL_DROITE='CONSTANT')

MA=DEFI_MATERIAU(            ELAS=_F(  E = 1000.,
                                         NU = 0.3),
                              TRACTION=_F(  SIGM = CTRAC))

CM=AFFE_MATERIAU(        MAILLAGE=M,
                                  AFFE=_F(  TOUT = 'OUI',
                                         MATER = MA))

CHBID=AFFE_CHAR_MECA(         MODELE=MO,
                FORCE_CONTOUR=_F(  GROUP_MA = 'LFG',   FY = 0.)
                       )

L_INST=DEFI_LIST_REEL(          DEBUT=0.,
                                
                      INTERVALLE=_F(  JUSQU_A = 6.,      NOMBRE = 30)
                                                          )

#############################################################
# ON RELIT LES DEPLACEMENTS POUR RELANCER LE CALCUL DES CONTRAINTES 
#############################################################


U1=LIRE_RESU( 
           FORMAT='IDEAS',
  UNITE=29,
  TYPE_RESU='EVOL_NOLI',
  NOM_CHAM='DEPL',
  MODELE=MO,
          TOUT_ORDRE='OUI'
     )

RESUNL=STAT_NON_LINE(
                                    MODELE=MO,
                                CHAM_MATER=CM,
               ####
               # VEILLER A NE PAS METTE DE CONDIITONX AUX LIMITES
               ####
                                    EXCIT=_F(  CHARGE = CHBID),
                         #  EXCIT         :( CHARGE         : CH2
                         #                   FONC_MULT    : F_DEPL)
                                COMP_INCR=_F(  RELATION = 'VMIS_ISOT_TRAC'),
                                        NEWTON=_F( 
                              PREDICTION = 'DEPL_CALCULE',
                              EVOL_NOLI = U1),
                                 INCREMENT=_F(  LIST_INST = L_INST),
                              CONVERGENCE=_F( 
                     # NE PAS FAIRE D'ITERATIONS
                                           ITER_GLOB_MAXI = 0,
                                           ARRET = 'NON')
                      )

# CALCUL DES CHAMPS AUX NOEUDS PAR ELEMENT

RESUNL=CALC_ELEM(  reuse=RESUNL,  
                          OPTION=(
                                  'SIEF_ELNO_ELGA', 
                                  'VARI_ELNO_ELGA', 
                                  'EQUI_ELGA_SIGM', 
                                  'EPSI_ELNO_DEPL',
                                  ),
                      RESULTAT=RESUNL
                        )

# CALCUL DES CHAMPS MOYENNES AUX NOEUDS 

RESUNL=CALC_NO(  reuse=RESUNL,    
                          OPTION=(
                                   'SIEF_NOEU_ELGA',
                                   'EPSI_NOEU_DEPL',
                                  ),
                      RESULTAT=RESUNL 
                        )

TEST_RESU( 
           RESU=_F(  RESULTAT = RESUNL,       INST = 5.2,
             NOM_CHAM = 'SIEF_NOEU_ELGA',  REFERENCE = 'NON_REGRESSION',
             GROUP_NO = 'G', NOM_CMP = 'SIYY', VALE = 5.20202E+00)
             )

# DEPOUILLEMENTS DES RESULTATS


# VALEURS MAXI DES CONTRAINTES EQUIVALENTES ET DES VARIABLES INTERNES


IMPR_RESU(   MODELE=MO,RESU=(
  _F( RESULTAT = RESUNL, VALE_MAX = 'OUI', NOM_CHAM = 'EQUI_ELGA_SIGM'),
  _F( RESULTAT = RESUNL, VALE_MAX = 'OUI', NOM_CHAM = 'VARI_ELGA'))
     )

# COURBE SIGMA YY AU POINT G EN FONCTION DE EPSYY



SYYG=RECU_FONCTION(      RESULTAT=RESUNL,
                            NOM_CMP='SIYY',
                            NOM_CHAM='SIEF_NOEU_ELGA',
                            GROUP_NO='G',
                            TOUT_ORDRE='OUI')

EYYG=RECU_FONCTION(      RESULTAT=RESUNL,
                            NOM_CMP='EPYY',
                            NOM_CHAM='EPSI_NOEU_DEPL',
                            GROUP_NO='G',
                            TOUT_ORDRE='OUI')

IMPR_FONCTION(  UNITE=25,    FORMAT='AGRAF',
                  COURBE=_F(  FONCTION = EYYG),
       TITRE='EYY EN FONCTION DU TEMPS'
              )

IMPR_FONCTION(  UNITE=27, UNITE_DIGR=28,    FORMAT='AGRAF',
                  COURBE=_F(  FONCTION = SYYG),
       TITRE='SYY EN FONCTION DU TEMPS'
              )

IMPR_FONCTION(  UNITE=31, UNITE_DIGR=32,    FORMAT='AGRAF',
                  COURBE=_F(  FONC_X = EYYG, FONC_Y = SYYG),
       TITRE='SYY EN FONCTION DE EYY AU POINT G',
                  LEGENDE_X='EPSI YY',
                  LEGENDE_Y='SIGMA YY'
              )

# EVOLUTION DE SIGMA YY LE LONG DE BD A L'INSTANT 5.2  

# INSTANT DE DEPOUILLEMENT 


TDEP=5.2

# SEGMENT VOISIN DE BD


LBAS=INTE_MAIL_2D(    MAILLAGE=M,
                        DEFI_SEGMENT=_F(  ORIGINE = ( 10.,  0.1, ),
                                       EXTREMITE = ( 100.,  0.1, ))
                        )

SYYLBAS=POST_RELEVE_T( 
      ACTION=_F(  INTITULE = 'SYYBD',
              CHEMIN = LBAS, RESULTAT = RESUNL,
             NOM_CMP = 'SIYY', INST = TDEP,
            NOM_CHAM = 'SIEF_ELNO_ELGA',
           OPERATION = 'EXTRACTION')
            )

SYYBD=RECU_FONCTION(    TABLE=SYYLBAS,
                        PARA_X='ABSC_CURV',
                        PARA_Y='SIYY'
                      )

IMPR_FONCTION(  UNITE=33, UNITE_DIGR=34,    FORMAT='AGRAF',
                  COURBE=_F(  FONCTION = SYYBD),
       TITRE='SIGMA-YY LE LONG DE L AXE X, INSTANT TDEP',
                  LEGENDE_X='ABSCISSE CURVILIGNE SUR B-D',
                  LEGENDE_Y='SIGMA YY'
              )

FIN()
#
