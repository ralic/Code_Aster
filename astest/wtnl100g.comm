# MODIF  DATE 11/10/2011   AUTEUR MEUNIER S.MEUNIER 
# TITRE  - CONSOLIDATION TERZAGHI 2D Q8
#            CONFIGURATION MANAGEMENT OF EDF VERSION
# ======================================================================
# COPYRIGHT (C) 1991 - 2011  EDF R&D                  WWW.CODE-ASTER.ORG
# THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY  
# IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY  
# THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR     
# (AT YOUR OPTION) ANY LATER VERSION.                                                    
#                                                                       
# THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT   
# WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF            
# MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU      
# GENERAL PUBLIC LICENSE FOR MORE DETAILS.                              
#                                                                       
# YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE     
# ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,         
#    1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.        
# ======================================================================
# tps_job 180 mem_job 200Mo ncpus 1 liste_test R
# wtnl100g.para = tps_job 180 mem_job 200Mo ncpus 1 liste_test R

DEBUT(CODE=_F(NOM='WTNL100G',
              NIV_PUB_WEB='INTERNET',),PAR_LOT='NON',);

MAIL=LIRE_MAILLAGE();

MODELE=AFFE_MODELE(MAILLAGE=MAIL,
                   AFFE=_F(TOUT='OUI',
                           PHENOMENE='MECANIQUE',
                           MODELISATION='D_PLAN_HMD',),);

#  LISTE DES INSTANTS DE CALCUL

LI=DEFI_LIST_REEL(DEBUT=0.0,
                  INTERVALLE=(_F(JUSQU_A=1.E-4,
                                 NOMBRE=1,),
                              _F(JUSQU_A=1.E-3,
                                 NOMBRE=9,),
                              _F(JUSQU_A=1.E-2,
                                 NOMBRE=30,),
                              _F(JUSQU_A=0.10000000000000001,
                                 NOMBRE=40,),
                              _F(JUSQU_A=1.0,
                                 NOMBRE=50,),
                              _F(JUSQU_A=10,
                                 NOMBRE=45,),
                              _F(JUSQU_A=100,
                                 NOMBRE=47,),
                              _F(JUSQU_A=250,
                                 NOMBRE=8,),),);

linst=LI.sdj.VALE.get()
lenlinst=len(linst)
p_inst_fin=linst[-1];

UN=DEFI_CONSTANTE(VALE=1.0,);

ZERO=DEFI_CONSTANTE(VALE=0.0,);

BIDON=DEFI_CONSTANTE(VALE=0.0,);

#
#
#K=k*mu/(rhow*g)

KINT=DEFI_CONSTANTE(VALE=1.E-08,);

#

MATERIAU=DEFI_MATERIAU(ELAS=_F(E=1.E7,
                               NU=0.0,
                               RHO=2800.0,
                               ALPHA=1.0000000000000001E-05,),
                       COMP_THM='LIQU_SATU',
                       THM_INIT=_F(PRE1=1.E6,
                                   PORO=0.5,
                                   TEMP=293.0,
                                   PRE2=1.E5,
                                   PRES_VAPE=2320.0,),
                       THM_DIFFU=_F(RHO=2800.0,
                                    BIOT_COEF=1.0,
                                    PESA_X=0.0,
                                    PESA_Y=0.0,
                                    PESA_Z=0.0,
                                    CP=660.0,
                                    PERM_IN=KINT,
                                    R_GAZ=8.3149999999999995,
                                    SATU_PRES=UN,
                                    D_SATU_PRES=ZERO,
                                    PERM_LIQU=UN,
                                    D_PERM_LIQU_SATU=ZERO,
                                    PERM_GAZ=BIDON,
                                    D_PERM_SATU_GAZ=BIDON,
                                    D_PERM_PRES_GAZ=BIDON,),
                       THM_LIQU=_F(RHO=1000.0,
                                   UN_SUR_K=0.0,
                                   VISC=UN,
                                   D_VISC_TEMP=ZERO,
                                   ALPHA=1.E-4,
                                   CP=4180.0,),
                       THM_GAZ=_F(MASS_MOL=0.02896,
                                  CP=1000.0,
                                  VISC=BIDON,
                                  D_VISC_TEMP=BIDON,),
                       THM_VAPE_GAZ=_F(MASS_MOL=0.017999999999999999,
                                       CP=1870.0,
                                       VISC=BIDON,
                                       D_VISC_TEMP=BIDON,),);

CHMAT0=AFFE_MATERIAU(MAILLAGE=MAIL,
                     AFFE=_F(TOUT='OUI',
                             MATER=MATERIAU,),);

CHAR1=AFFE_CHAR_CINE(MODELE=MODELE,
                    MECA_IMPO=(_F(GROUP_NO='HAUT',
                                  PRE1=0.0,),
                               _F(GROUP_NO='BAS',
                                  DX=0.0,
                                  DY=0.0,),
                               _F(GROUP_NO='BORDVERT',
                                  DX=0.0,),),);

CHAR2=AFFE_CHAR_MECA(MODELE=MODELE,
                    PRES_REP=_F(GROUP_MA='FACESUP',
                                PRES=1.0,),);

RESU1=STAT_NON_LINE(MODELE=MODELE,
                    CHAM_MATER=CHMAT0,
                    EXCIT=(_F(CHARGE=CHAR1,),
                           _F(CHARGE=CHAR2,),),
                    COMP_INCR=_F(RELATION='KIT_HM',PARM_THETA=0.56999999999999995,
                                 RELATION_KIT=('ELAS','LIQU_SATU','HYDR_UTIL',),),
                    INCREMENT=_F(LIST_INST=LI,
                                 INST_FIN=p_inst_fin,),
                    NEWTON=_F(MATRICE='TANGENTE',REAC_INCR=3,),
                    CONVERGENCE=_F(ITER_GLOB_MAXI=10,),
                    SOLVEUR=_F(METHODE='MUMPS',PCENT_PIVOT=100,),
#                    ARCHIVAGE=_F(INST=(0.0001,1.E-3,0.01,0.10000000000000001,1.0,10.0,50.212765959999999,100.0,193.75,250.0,),
#                                 PRECISION=1.E-3,),
);

MATPROJ = PROJ_CHAMP(METHODE='COLLOCATION',PROJECTION='NON',
               MAILLAGE_1=MAIL,
               MAILLAGE_2=MAIL,)

RESU1=CALC_ELEM(reuse =RESU1,
                RESULTAT=RESU1,
                OPTION=('SIEF_ELNO','VARI_ELNO','SIEQ_ELNO','EPSI_ELNO',),);

RESU1=CALC_NO(reuse =RESU1,
              RESULTAT=RESU1,
              OPTION=('SIEF_NOEU','VARI_NOEU','SIEQ_NOEU',),);

SIGMA2=POST_RELEVE_T(ACTION=_F(OPERATION='EXTRACTION',
                               INTITULE='SIGMA',
                               RESULTAT=RESU1,
                               NOM_CHAM='SIEF_NOEU',
                               INST=(0.0001,0.001,0.01,0.1,1.0,10.0,50.21276596,100.0,193.75,250.0,),
                               GROUP_NO='BORDVERT',
                               NOM_CMP=('SIXX','SIYY','SIZZ','SIXY',),),);

VARIN2=POST_RELEVE_T(ACTION=_F(OPERATION='EXTRACTION',
                               INTITULE='VARI',
                               RESULTAT=RESU1,
                               NOM_CHAM='VARI_NOEU',
                               INST=(0.0001,0.001,0.01,0.1,1.0,10.0,50.21276596,100.0,193.75,250.0,),
                               GROUP_NO='BORDVERT',
                               TOUT_CMP='OUI',),);

DEPLA2=POST_RELEVE_T(ACTION=_F(OPERATION='EXTRACTION',
                               INTITULE='DEPL',
                               RESULTAT=RESU1,
                               NOM_CHAM='DEPL',
                               INST=(0.0001,0.001,0.01,0.1,1.0,10.0,50.21276596,100.0,193.75,250.0,),
                               GROUP_NO='BORDVERT',
                               TOUT_CMP='OUI',),);

IMPR_TABLE(TABLE=SIGMA2,);

IMPR_TABLE(TABLE=VARIN2,);

IMPR_TABLE(TABLE=DEPLA2,);

MODHYD=AFFE_MODELE(MAILLAGE=MAIL,
                   AFFE=_F(TOUT='OUI',
                           PHENOMENE='MECANIQUE',
                           MODELISATION='D_PLAN_HS',),);

PREIMP=AFFE_CHAR_CINE(MODELE=MODHYD,
                      MECA_IMPO=_F(GROUP_NO='HAUT',
                                   PRE1=0,),);

CHAINAGE_THM(
             TYPE_CHAINAGE = 'INIT',
             MODELE_MECA   = MODELE,
             MODELE_HYDR   = MODHYD,
             MATR_MH       = CO('MATMH',),
             MATR_HM1      = CO('MATHM1',),
             MATR_HM2      = CO('MATHM2',),
);

for k in range(1,lenlinst) :

  UNPAS=DEFI_LIST_REEL(DEBUT=linst[k-1],
                       INTERVALLE=_F(JUSQU_A=linst[k],
                                     NOMBRE=1,),);

  UNPASSUB =DEFI_LIST_INST(DEFI_LIST=_F(LIST_INST =UNPAS ),
                           ECHEC=_F(
                                    SUBD_METHODE='MANUEL',
                                    SUBD_PAS  = 4,
                                    SUBD_NIVEAU=5,),);

  RESU1b=EXTR_RESU(RESULTAT=RESU1,ARCHIVAGE=_F(LIST_INST=UNPAS,),);

  DEFVHY=CHAINAGE_THM(RESU_MECA=RESU1b,
                      MODELE_HYDR=MODHYD,
                      MATR_MH=MATMH,
                      TYPE_CHAINAGE='MECA_HYDR',
                      INST=linst[k],);

  MATEHY=AFFE_MATERIAU(MAILLAGE=MAIL,
                      AFFE=_F(TOUT='OUI',
                              MATER=MATERIAU,),
                      AFFE_VARC=_F(NOM_VARC='DIVU',
                                   EVOL=DEFVHY,),);

  if (k==1) :

    PRELIQ=STAT_NON_LINE(MODELE=MODHYD,
                        CHAM_MATER=MATEHY,
                        EXCIT=_F(CHARGE=PREIMP,),
                        SOLVEUR=_F(METHODE='MUMPS',PCENT_PIVOT=100,),
                        CONVERGENCE=_F(RESI_GLOB_RELA=1e-7,
                                     ITER_GLOB_MAXI=50,),
                        COMP_INCR=_F(RELATION='KIT_H',PARM_THETA=0.56999999999999995,
                                     RELATION_KIT=('LIQU_SATU','HYDR_UTIL',),),
                        INCREMENT=_F(LIST_INST=UNPASSUB,),);

  else :

    PRELIQ=STAT_NON_LINE(reuse=PRELIQ,
                         MODELE=MODHYD,
                         CHAM_MATER=MATEHY,
                         EXCIT=_F(CHARGE=PREIMP,),
                         SOLVEUR=_F(METHODE='MUMPS',PCENT_PIVOT=100,),
                         ETAT_INIT=_F(EVOL_NOLI=PRELIQ,
                                      INST=linst[k-1]),
                         CONVERGENCE=_F(RESI_GLOB_RELA=1e-7,
                                        ITER_GLOB_MAXI=50,),
                         COMP_INCR=_F(RELATION='KIT_H',PARM_THETA=0.56999999999999995,
                                      RELATION_KIT=('LIQU_SATU','HYDR_UTIL',),),
                         INCREMENT=_F(LIST_INST=UNPASSUB,),);

  DETRUIRE(INFO=1,CONCEPT=_F(NOM=(DEFVHY,UNPAS,UNPASSUB,MATEHY,RESU1b,),),);

TEST_RESU(RESU=(_F(RESULTAT=PRELIQ,
                   INST=1.E-4,
                   NOM_CHAM='DEPL',
                   NOM_CMP='PRE1',
                   NOEUD='NO29',
                   VALE=0.99999999978709,
                   PRECISION=6.E-5,
                   REFERENCE='AUTRE_ASTER',),
                _F(RESULTAT=PRELIQ,
                   INST=1.E-4,
                   NOM_CHAM='DEPL',
                   NOM_CMP='PRE1',
                   NOEUD='NO31',
                   VALE=0.99998540842584,
                   PRECISION=5.E-5,
                   REFERENCE='AUTRE_ASTER',),
                _F(RESULTAT=PRELIQ,
                   INST=p_inst_fin,
                   NOM_CHAM='DEPL',
                   NOM_CMP='PRE1',
                   NOEUD='NO1',
                   VALE=0.68590977472517,
                   PRECISION=2.E-5,
                   REFERENCE='AUTRE_ASTER',),
                _F(RESULTAT=PRELIQ,
                   INST=p_inst_fin,
                   NOM_CHAM='DEPL',
                   NOM_CMP='PRE1',
                   NOEUD='NO3',
                   VALE=0.68267565049244,
                   PRECISION=2.E-5,
                   REFERENCE='AUTRE_ASTER',),
                _F(RESULTAT=PRELIQ,
                   INST=p_inst_fin,
                   NOM_CHAM='DEPL',
                   NOM_CMP='PRE1',
                   NOEUD='NO5',
                   VALE=0.67299850708276,
                   PRECISION=2.E-5,
                   REFERENCE='AUTRE_ASTER',),
                _F(RESULTAT=PRELIQ,
                   INST=p_inst_fin,
                   NOM_CHAM='DEPL',
                   NOM_CMP='PRE1',
                   NOEUD='NO7',
                   VALE=0.65695429874833,
                   PRECISION=4.E-5,
                   REFERENCE='AUTRE_ASTER',),
                _F(RESULTAT=PRELIQ,
                   INST=p_inst_fin,
                   NOM_CHAM='DEPL',
                   NOM_CMP='PRE1',
                   NOEUD='NO9',
                   VALE=0.63467045748567,
                   PRECISION=4.E-5,
                   REFERENCE='AUTRE_ASTER',),
                _F(RESULTAT=PRELIQ,
                   INST=p_inst_fin,
                   NOM_CHAM='DEPL',
                   NOM_CMP='PRE1',
                   NOEUD='NO11',
                   VALE=0.60632699727877,
                   PRECISION=4.E-5,
                   REFERENCE='AUTRE_ASTER',),
                _F(RESULTAT=PRELIQ,
                   INST=p_inst_fin,
                   NOM_CHAM='DEPL',
                   NOM_CMP='PRE1',
                   NOEUD='NO13',
                   VALE=0.57215775858405,
                   PRECISION=4.E-5,
                   REFERENCE='AUTRE_ASTER',),
                _F(RESULTAT=PRELIQ,
                   INST=p_inst_fin,
                   NOM_CHAM='DEPL',
                   NOM_CMP='PRE1',
                   NOEUD='NO15',
                   VALE=0.53245152480768,
                   PRECISION=4.E-5,
                   REFERENCE='AUTRE_ASTER',),
                _F(RESULTAT=PRELIQ,
                   INST=p_inst_fin,
                   NOM_CHAM='DEPL',
                   NOM_CMP='PRE1',
                   NOEUD='NO17',
                   VALE=0.48755271010105,
                   PRECISION=4.E-5,
                   REFERENCE='AUTRE_ASTER',),
                _F(RESULTAT=PRELIQ,
                   INST=p_inst_fin,
                   NOM_CHAM='DEPL',
                   NOM_CMP='PRE1',
                   NOEUD='NO19',
                   VALE=0.43786131319852,
                   PRECISION=4.E-5,
                   REFERENCE='AUTRE_ASTER',),
                _F(RESULTAT=PRELIQ,
                   INST=p_inst_fin,
                   NOM_CHAM='DEPL',
                   NOM_CMP='PRE1',
                   NOEUD='NO21',
                   VALE=0.38383185605803,
                   PRECISION=4.E-5,
                   REFERENCE='AUTRE_ASTER',),
                _F(RESULTAT=PRELIQ,
                   INST=p_inst_fin,
                   NOM_CHAM='DEPL',
                   NOM_CMP='PRE1',
                   NOEUD='NO23',
                   VALE=0.32597107707154,
                   PRECISION=4.E-5,
                   REFERENCE='AUTRE_ASTER',),
                _F(RESULTAT=PRELIQ,
                   INST=p_inst_fin,
                   NOM_CHAM='DEPL',
                   NOM_CMP='PRE1',
                   NOEUD='NO25',
                   VALE=0.26483422256870,
                   PRECISION=4.E-5,
                   REFERENCE='AUTRE_ASTER',),
                _F(RESULTAT=PRELIQ,
                   INST=p_inst_fin,
                   NOM_CHAM='DEPL',
                   NOM_CMP='PRE1',
                   NOEUD='NO27',
                   VALE=0.20101987121393,
                   PRECISION=4.E-5,
                   REFERENCE='AUTRE_ASTER',),
                _F(RESULTAT=PRELIQ,
                   INST=p_inst_fin,
                   NOM_CHAM='DEPL',
                   NOM_CMP='PRE1',
                   NOEUD='NO29',
                   VALE=0.13516332616052,
                   PRECISION=4.E-5,
                   REFERENCE='AUTRE_ASTER',),
                _F(RESULTAT=PRELIQ,
                   INST=p_inst_fin,
                   NOM_CHAM='DEPL',
                   NOM_CMP='PRE1',
                   NOEUD='NO31',
                   VALE=0.067928711089501,
                   PRECISION=4.E-5,
                   REFERENCE='AUTRE_ASTER',),
                _F(RESULTAT=PRELIQ,
                   INST=p_inst_fin,
                   NOM_CHAM='DEPL',
                   NOM_CMP='PRE1',
                   NOEUD='NO33',
                   VALE=-3.1562143220002E-30,
                   CRITERE='ABSOLU',
                   PRECISION=4e-5,
                   REFERENCE='AUTRE_ASTER',),),);

FIN();
