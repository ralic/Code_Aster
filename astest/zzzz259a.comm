# MODIF  DATE 15/03/2010   AUTEUR GNICOLAS G.NICOLAS 
# RESPONSABLE GNICOLAS G.NICOLAS
# TITRE ADAPTATION DE MAILLAGE ET SUIVI DE FRONTIERE 2D
#            CONFIGURATION MANAGEMENT OF EDF VERSION
# ======================================================================
# COPYRIGHT (C) 1991 - 2010  EDF R&D                  WWW.CODE-ASTER.ORG
# THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY  
# IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY  
# THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR     
# (AT YOUR OPTION) ANY LATER VERSION.                                                    
#                                                                       
# THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT   
# WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF            
# MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU      
# GENERAL PUBLIC LICENSE FOR MORE DETAILS.                              
#                                                                       
# YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE     
# ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,         
#    1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.        
# ======================================================================
# zzzz259a.para = tps_job 300 mem_job 512Mo ncpus 1 liste_test S
# On fait une suite d'adaptations pilotees par les groupes.

DEBUT(CODE=_F(NOM='ZZZZ259A',
              NIV_PUB_WEB='INTERNET',),
      DEBUG=_F(SDVERI='OUI',),);

#
# 1. Lecture des maillages
#
# 1.1. L'intersection des deux tuyaux

MA_ARCS=LIRE_MAILLAGE(UNITE=19,
                      FORMAT='MED');
#
# 1.2. Le volume

M_0=LIRE_MAILLAGE(FORMAT='MED');
#
M_0=MODI_MAILLAGE( reuse=M_0,   MAILLAGE=M_0,
                   ORIE_PEAU_3D=_F(
           GROUP_MA = ('T1_INT', 'T1_EXT','T2_INT', 'T2_EXT','IN1','IN2','OUT',),  )
                 )
#
# 2. Adaptation du maillage de 0 vers 1
#    On decoupe tous les triangles des faces internes des deux tuyaux
#    On voit l'arrondi se maintenir sur les faces internes.

MACR_ADAP_MAIL(MAILLAGE_N=M_0,
               MAILLAGE_NP1=CO('M_1'),
               ADAPTATION='RAFFINEMENT_UNIFORME',
               GROUP_MA=('T1_INT','T2_INT',),
               FRONTIERE_ANALYTIQUE=(
                    _F(GROUP_MA='T1_INT',
                       TYPE='CYLINDRE',
                       X_CENTRE=   0.,
                       Y_CENTRE=  25.,
                       Z_CENTRE= -25.,
                       X_AXE=  25.,
                       Y_AXE=  50.,
                       Z_AXE=  75.,
                       RAYON= 75.,),
                    _F(GROUP_MA='T1_EXT',
                       TYPE='CYLINDRE',
                       X_CENTRE=   0.,
                       Y_CENTRE=  25.,
                       Z_CENTRE= -25.,
                       X_AXE=  25.,
                       Y_AXE=  50.,
                       Z_AXE=  75.,
                       RAYON= 100.,),
                    _F(GROUP_MA='T2_INT',
                       TYPE='CYLINDRE',
                       X_CENTRE=  17.5,
                       Y_CENTRE=  -2.5,
                       Z_CENTRE= -12.5,
                       X_AXE= -100.,
                       Y_AXE=  -75.,
                       Z_AXE=  -25.,
                       RAYON= 25.,),
                    _F(GROUP_MA='T2_EXT',
                       TYPE='CYLINDRE',
                       X_CENTRE=  17.5,
                       Y_CENTRE=  -2.5,
                       Z_CENTRE= -12.5,
                       X_AXE= -100.,
                       Y_AXE=  -75.,
                       Z_AXE=  -25.,
                       RAYON= 50.,),),
               MAILLAGE_FRONTIERE=MA_ARCS,
               GROUP_MA_FRONT=('INT_EA','INT_EB','INT_IA','INT_IB','IN2_EA','IN2_EB','IN2_IA','IN2_IB',),
               NOMBRE='OUI',
               PROP_CALCUL='OUI',);

#IMPR_RESU(FORMAT='MED',RESU=_F(MAILLAGE=M_1,),);

#
# 3. Adaptation du maillage de 1 vers 2
#    On decoupe tous les triangles des faces externes des deux tuyaux
#    On voit l'arrondi se maintenir sur les faces externes.

MACR_ADAP_MAIL(MAILLAGE_N=M_1,
               MAILLAGE_NP1=CO('M_2'),
               ADAPTATION='RAFFINEMENT_UNIFORME',
               GROUP_MA=('T1_EXT','T2_EXT',),
               FRONTIERE_ANALYTIQUE=(
                    _F(GROUP_MA='T1_INT',
                       TYPE='CYLINDRE',
                       X_CENTRE=   0.,
                       Y_CENTRE=  25.,
                       Z_CENTRE= -25.,
                       X_AXE=  25.,
                       Y_AXE=  50.,
                       Z_AXE=  75.,
                       RAYON= 75.,),
                    _F(GROUP_MA='T1_EXT',
                       TYPE='CYLINDRE',
                       X_CENTRE=   0.,
                       Y_CENTRE=  25.,
                       Z_CENTRE= -25.,
                       X_AXE=  25.,
                       Y_AXE=  50.,
                       Z_AXE=  75.,
                       RAYON= 100.,),
                    _F(GROUP_MA='T2_INT',
                       TYPE='CYLINDRE',
                       X_CENTRE=  17.5,
                       Y_CENTRE=  -2.5,
                       Z_CENTRE= -12.5,
                       X_AXE= -100.,
                       Y_AXE=  -75.,
                       Z_AXE=  -25.,
                       RAYON= 25.,),
                    _F(GROUP_MA='T2_EXT',
                       TYPE='CYLINDRE',
                       X_CENTRE=  17.5,
                       Y_CENTRE=  -2.5,
                       Z_CENTRE= -12.5,
                       X_AXE= -100.,
                       Y_AXE=  -75.,
                       Z_AXE=  -25.,
                       RAYON= 50.,),),
               MAILLAGE_FRONTIERE=MA_ARCS,
               GROUP_MA_FRONT=('INT_EA','INT_EB','INT_IA','INT_IB','IN2_EA','IN2_EB','IN2_IA','IN2_IB',),);

#IMPR_RESU(FORMAT='MED',RESU=_F(MAILLAGE=M_2,),);

#
# 4. Adaptation du maillage de 2 vers 3
#    On decoupe tous les segments de l'intersection des deux tuyaux et les deux faces d'entree
#    On voit la finesse de la description de l'intersection.

MACR_ADAP_MAIL(MAILLAGE_N=M_2,
               MAILLAGE_NP1=CO('M_3'),
               ADAPTATION='RAFFINEMENT_UNIFORME',
               GROUP_MA=('INT_EA','INT_EB','INT_IA','INT_IB','IN2','IN1',),
               FRONTIERE_ANALYTIQUE=(
                    _F(GROUP_MA='T1_INT',
                       TYPE='CYLINDRE',
                       X_CENTRE=   0.,
                       Y_CENTRE=  25.,
                       Z_CENTRE= -25.,
                       X_AXE=  25.,
                       Y_AXE=  50.,
                       Z_AXE=  75.,
                       RAYON= 75.,),
                    _F(GROUP_MA='T1_EXT',
                       TYPE='CYLINDRE',
                       X_CENTRE=   0.,
                       Y_CENTRE=  25.,
                       Z_CENTRE= -25.,
                       X_AXE=  25.,
                       Y_AXE=  50.,
                       Z_AXE=  75.,
                       RAYON= 100.,),
                    _F(GROUP_MA='T2_INT',
                       TYPE='CYLINDRE',
                       X_CENTRE=  17.5,
                       Y_CENTRE=  -2.5,
                       Z_CENTRE= -12.5,
                       X_AXE= -100.,
                       Y_AXE=  -75.,
                       Z_AXE=  -25.,
                       RAYON= 25.,),
                    _F(GROUP_MA='T2_EXT',
                       TYPE='CYLINDRE',
                       X_CENTRE=  17.5,
                       Y_CENTRE=  -2.5,
                       Z_CENTRE= -12.5,
                       X_AXE= -100.,
                       Y_AXE=  -75.,
                       Z_AXE=  -25.,
                       RAYON= 50.,),),
               MAILLAGE_FRONTIERE=MA_ARCS,
               GROUP_MA_FRONT=('INT_EA','INT_EB','INT_IA','INT_IB','IN2_EA','IN2_EB','IN2_IA','IN2_IB',),);

#IMPR_RESU(FORMAT='MED',RESU=_F(MAILLAGE=M_3,),);

#
# 5. Adaptation du maillage de 3 vers 4
#    On decoupe tous les segments de l'intersection des deux tuyaux et l'entree du piquage
#    On voit la finesse de la description de l'intersection.

MACR_ADAP_MAIL(MAILLAGE_N=M_3,
               MAILLAGE_NP1=CO('M_4'),
               ADAPTATION='RAFFINEMENT_UNIFORME',
               GROUP_MA=('INT_EA','INT_EB','INT_IA','INT_IB','IN2',),
               FRONTIERE_ANALYTIQUE=(
                    _F(GROUP_MA='T1_INT',
                       TYPE='CYLINDRE',
                       X_CENTRE=   0.,
                       Y_CENTRE=  25.,
                       Z_CENTRE= -25.,
                       X_AXE=  25.,
                       Y_AXE=  50.,
                       Z_AXE=  75.,
                       RAYON= 75.,),
                    _F(GROUP_MA='T1_EXT',
                       TYPE='CYLINDRE',
                       X_CENTRE=   0.,
                       Y_CENTRE=  25.,
                       Z_CENTRE= -25.,
                       X_AXE=  25.,
                       Y_AXE=  50.,
                       Z_AXE=  75.,
                       RAYON= 100.,),
                    _F(GROUP_MA='T2_INT',
                       TYPE='CYLINDRE',
                       X_CENTRE=  17.5,
                       Y_CENTRE=  -2.5,
                       Z_CENTRE= -12.5,
                       X_AXE= -100.,
                       Y_AXE=  -75.,
                       Z_AXE=  -25.,
                       RAYON= 25.,),
                    _F(GROUP_MA='T2_EXT',
                       TYPE='CYLINDRE',
                       X_CENTRE=  17.5,
                       Y_CENTRE=  -2.5,
                       Z_CENTRE= -12.5,
                       X_AXE= -100.,
                       Y_AXE=  -75.,
                       Z_AXE=  -25.,
                       RAYON= 50.,),),
               MAILLAGE_FRONTIERE=MA_ARCS,
               GROUP_MA_FRONT=('INT_EA','INT_EB','INT_IA','INT_IB','IN2_EA','IN2_EB','IN2_IA','IN2_IB',),);

#IMPR_RESU(FORMAT='MED',RESU=_F(MAILLAGE=M_4,),);
#
# 6. Un p'tit calcul pour un TEST_RESU
#
MAI=CREA_MAILLAGE(MAILLAGE=M_4,
                  LINE_QUAD=_F(TOUT='OUI',),);
MATERIO=DEFI_MATERIAU( THER=_F(  LAMBDA = 40., RHO_CP = 1., ), )
#
MATPIQ=AFFE_MATERIAU( MAILLAGE=MAI,AFFE=_F( TOUT='OUI', MATER = MATERIO, ),)
#
MOTHPIQ=AFFE_MODELE( MAILLAGE=MAI,
  AFFE=_F( TOUT = 'OUI',   PHENOMENE = 'THERMIQUE',   MODELISATION = '3D',  ))
#
CHTHPIQ=AFFE_CHAR_THER(    MODELE=MOTHPIQ,
    TEMP_IMPO=(_F(  GROUP_MA = 'T1_INT', TEMP = 600.0,),
               _F(  GROUP_MA = 'T2_INT', TEMP = 400.0,),),
    ECHANGE=_F( GROUP_MA = ('T1_EXT','T2_EXT',),  COEF_H = 5.,  TEMP_EXT = 300.,),
    FLUX_REP=_F( GROUP_MA = ('IN1','IN2','OUT',),  FLUN = 0.,),);
#
THPIQ=THER_LINEAIRE( MODELE=MOTHPIQ,
                        CHAM_MATER=MATPIQ,
                        EXCIT=_F(  CHARGE = CHTHPIQ,   ),
                   )
####IMPR_RESU(FORMAT='MED',RESU=_F(RESULTAT=THPIQ,),);
#
TEST_RESU(RESU=(
       _F(  RESULTAT = THPIQ,   NUME_ORDRE = 0,
            NOM_CHAM = 'TEMP',      GROUP_NO = 'POINT',
            CRITERE = 'RELATIF',    PRECISION = 1.E-8,
            NOM_CMP = 'TEMP',       VALE = 370.861930,
            REFERENCE = 'NON_REGRESSION', VERSION = '10.00.24'  ))
          )
#
FIN();
