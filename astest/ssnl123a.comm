# MODIF  DATE 07/06/2002   AUTEUR DURAND C.DURAND 
# TITRE FLAMBEMENT D'UNE POUTRE DROITE MULTI-FIBRES
#            CONFIGURATION MANAGEMENT OF EDF VERSION
# ======================================================================
# COPYRIGHT (C) 1991 - 2002  EDF R&D                  WWW.CODE-ASTER.ORG
# THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY
# IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY
# THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR   
# (AT YOUR OPTION) ANY LATER VERSION.                                 
#
# THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT 
# WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF          
# MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU    
# GENERAL PUBLIC LICENSE FOR MORE DETAILS.                            
#
# YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE   
# ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,       
#    1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.      
#                                                                       
#                                                                       
# ======================================================================
# - Un effort de compression en extremite de poutre.
# - Le chargement se fait en 2 pas, avec un stat_non_line
# - Recuperation, avec une boucle python des blocages et des efforts de
#     precontrainte necessaires au 2 calculs de flambement.
#

DEBUT( CODE=_F( NOM = 'SSNL123A',NIV_PUB_WEB='INTERNET'),
       PAR_LOT='NON' )

# Lecture du maillage
MA = LIRE_MAILLAGE()

# AFFECTATION DES MODELES DE COMPORTEMENT
MO = AFFE_MODELE(
   MAILLAGE= MA,
   VERIF=('MAILLE','NOEUD'),
   AFFE=(
      _F(GROUP_MA=('S002','S001',),
         PHENOMENE= 'MECANIQUE',
         MODELISATION= 'POU_D_TGM'),
))

# DEFINITION DES MATERIAUX
#            DES CARACTERISTIQUES ELASTIQUES et PLASTIQUES DES POUTRES
# Comportement du materiau : E360.
MAT0001 = DEFI_MATERIAU(
   ELAS =_F( E= 2.100000e+11, NU= 3.000000e-01, RHO= 7.850000e+03,
             ALPHA= 6.700000e-06),
   ECRO_LINE= _F( D_SIGM_EPSI = 1.0E+08 ,
                  SY= 400.0E+06),
)


# -------------------------------------------------------
# Affectation des materiaux
CHMAT = AFFE_MATERIAU( MAILLAGE= MA, MODELE= MO, 
   AFFE=(
# Pour les poutres ou les barres ou les cables
# Elements avec le materiau : E360.
_F( GROUP_MA= ('S002','S001',
),MATER= MAT0001 ),
))


# AFFECTATION DES CARACTERISTIQUES DES ELEMENTS
CAREL = AFFE_CARA_ELEM( MODELE= MO,
# Sections de spref /RE40X20 de modele POU_D_TGM
POUTRE=(
   _F(SECTION= 'GENERALE', GROUP_MA=('S002','S001',),
   CARA= ( 'A','IY','IZ','AY',
           'AZ','EY','EZ','JX',
           'JG','IYR2','IZR2'),
   VALE= ( 8.000000e-04,2.666667e-08,1.066667e-07,1.191790e+00,
           1.172840e+00,0.000000e+00,0.000000e+00,7.093682e-08,
           1.438125e-12,0.000000e+00,0.000000e+00 ) ),
),

AFFE_FIBRE = (
#  Sections: /RE40X20, modele: POU_D_TGM, Epa: 4, lar: 8
  _F( CARA = 'SURFACE', COOR_AXE_POUTRE = (0.0 , 0.0),
      GROUP_MA = ('S002',),
      VALE = ( 
# Nombre de fibre : 32
        -1.75000e-02,  -7.50000e-03,   2.50000e-05,
        -1.75000e-02,  -2.50000e-03,   2.50000e-05,
        -1.75000e-02,   2.50000e-03,   2.50000e-05,
        -1.75000e-02,   7.50000e-03,   2.50000e-05,
        -1.25000e-02,  -7.50000e-03,   2.50000e-05,
        -1.25000e-02,  -2.50000e-03,   2.50000e-05,
        -1.25000e-02,   2.50000e-03,   2.50000e-05,
        -1.25000e-02,   7.50000e-03,   2.50000e-05,
        -7.50000e-03,  -7.50000e-03,   2.50000e-05,
        -7.50000e-03,  -2.50000e-03,   2.50000e-05,
        -7.50000e-03,   2.50000e-03,   2.50000e-05,
        -7.50000e-03,   7.50000e-03,   2.50000e-05,
        -2.50000e-03,  -7.50000e-03,   2.50000e-05,
        -2.50000e-03,  -2.50000e-03,   2.50000e-05,
        -2.50000e-03,   2.50000e-03,   2.50000e-05,
        -2.50000e-03,   7.50000e-03,   2.50000e-05,
         2.50000e-03,  -7.50000e-03,   2.50000e-05,
         2.50000e-03,  -2.50000e-03,   2.50000e-05,
         2.50000e-03,   2.50000e-03,   2.50000e-05,
         2.50000e-03,   7.50000e-03,   2.50000e-05,
         7.50000e-03,  -7.50000e-03,   2.50000e-05,
         7.50000e-03,  -2.50000e-03,   2.50000e-05,
         7.50000e-03,   2.50000e-03,   2.50000e-05,
         7.50000e-03,   7.50000e-03,   2.50000e-05,
         1.25000e-02,  -7.50000e-03,   2.50000e-05,
         1.25000e-02,  -2.50000e-03,   2.50000e-05,
         1.25000e-02,   2.50000e-03,   2.50000e-05,
         1.25000e-02,   7.50000e-03,   2.50000e-05,
         1.75000e-02,  -7.50000e-03,   2.50000e-05,
         1.75000e-02,  -2.50000e-03,   2.50000e-05,
         1.75000e-02,   2.50000e-03,   2.50000e-05,
         1.75000e-02,   7.50000e-03,   2.50000e-05,
# Points particuliers : 4
        -2.00000e-02,  -1.00000e-02,   0.00000e+00,
        -2.00000e-02,   1.00000e-02,   0.00000e+00,
         2.00000e-02,   1.00000e-02,   0.00000e+00,
         2.00000e-02,  -1.00000e-02,   0.00000e+00,
# // Position des Jauges : 24
        -2.00000e-02,  -7.50000e-03,   0.00000e+00,
        -2.00000e-02,  -2.50000e-03,   0.00000e+00,
        -2.00000e-02,   2.50000e-03,   0.00000e+00,
        -2.00000e-02,   7.50000e-03,   0.00000e+00,
        -1.75000e-02,   1.00000e-02,   0.00000e+00,
        -1.25000e-02,   1.00000e-02,   0.00000e+00,
        -7.50000e-03,   1.00000e-02,   0.00000e+00,
        -2.50000e-03,   1.00000e-02,   0.00000e+00,
         2.50000e-03,   1.00000e-02,   0.00000e+00,
         7.50000e-03,   1.00000e-02,   0.00000e+00,
         1.25000e-02,   1.00000e-02,   0.00000e+00,
         1.75000e-02,   1.00000e-02,   0.00000e+00,
         2.00000e-02,   7.50000e-03,   0.00000e+00,
         2.00000e-02,   2.50000e-03,   0.00000e+00,
         2.00000e-02,  -2.50000e-03,   0.00000e+00,
         2.00000e-02,  -7.50000e-03,   0.00000e+00,
         1.75000e-02,  -1.00000e-02,   0.00000e+00,
         1.25000e-02,  -1.00000e-02,   0.00000e+00,
         7.50000e-03,  -1.00000e-02,   0.00000e+00,
         2.50000e-03,  -1.00000e-02,   0.00000e+00,
        -2.50000e-03,  -1.00000e-02,   0.00000e+00,
        -7.50000e-03,  -1.00000e-02,   0.00000e+00,
        -1.25000e-02,  -1.00000e-02,   0.00000e+00,
        -1.75000e-02,  -1.00000e-02,   0.00000e+00,
           ), ),

#  Sections: /RE40X20, modele: POU_D_TGM, Epa: 4, lar: 8
  _F( CARA = 'SURFACE', COOR_AXE_POUTRE = (0.0 , 0.0),
      GROUP_MA = ('S001',),
      VALE = ( 
# Nombre de fibre : 32
        -1.75000e-02,  -7.50000e-03,   2.50000e-05,
        -1.75000e-02,  -2.50000e-03,   2.50000e-05,
        -1.75000e-02,   2.50000e-03,   2.50000e-05,
        -1.75000e-02,   7.50000e-03,   2.50000e-05,
        -1.25000e-02,  -7.50000e-03,   2.50000e-05,
        -1.25000e-02,  -2.50000e-03,   2.50000e-05,
        -1.25000e-02,   2.50000e-03,   2.50000e-05,
        -1.25000e-02,   7.50000e-03,   2.50000e-05,
        -7.50000e-03,  -7.50000e-03,   2.50000e-05,
        -7.50000e-03,  -2.50000e-03,   2.50000e-05,
        -7.50000e-03,   2.50000e-03,   2.50000e-05,
        -7.50000e-03,   7.50000e-03,   2.50000e-05,
        -2.50000e-03,  -7.50000e-03,   2.50000e-05,
        -2.50000e-03,  -2.50000e-03,   2.50000e-05,
        -2.50000e-03,   2.50000e-03,   2.50000e-05,
        -2.50000e-03,   7.50000e-03,   2.50000e-05,
         2.50000e-03,  -7.50000e-03,   2.50000e-05,
         2.50000e-03,  -2.50000e-03,   2.50000e-05,
         2.50000e-03,   2.50000e-03,   2.50000e-05,
         2.50000e-03,   7.50000e-03,   2.50000e-05,
         7.50000e-03,  -7.50000e-03,   2.50000e-05,
         7.50000e-03,  -2.50000e-03,   2.50000e-05,
         7.50000e-03,   2.50000e-03,   2.50000e-05,
         7.50000e-03,   7.50000e-03,   2.50000e-05,
         1.25000e-02,  -7.50000e-03,   2.50000e-05,
         1.25000e-02,  -2.50000e-03,   2.50000e-05,
         1.25000e-02,   2.50000e-03,   2.50000e-05,
         1.25000e-02,   7.50000e-03,   2.50000e-05,
         1.75000e-02,  -7.50000e-03,   2.50000e-05,
         1.75000e-02,  -2.50000e-03,   2.50000e-05,
         1.75000e-02,   2.50000e-03,   2.50000e-05,
         1.75000e-02,   7.50000e-03,   2.50000e-05,
# Points particuliers : 4
        -2.00000e-02,  -1.00000e-02,   0.00000e+00,
        -2.00000e-02,   1.00000e-02,   0.00000e+00,
         2.00000e-02,   1.00000e-02,   0.00000e+00,
         2.00000e-02,  -1.00000e-02,   0.00000e+00,
           ), ),
),

ORIENTATION=(
# Pour les poutres
   _F(GROUP_MA= 'S002', CARA= 'ANGL_VRIL',
      VALE= 9.000000e+01 ),
   _F(GROUP_MA= 'S001', CARA= 'ANGL_VRIL',
      VALE= 9.000000e+01 ),
  ),
)


# ----------------------------------------------------------------------
# --------------- DEFINITION DES CHARGEMENTS VARIABLES -----------------

# fonction de chargement :
FCHG000X = DEFI_FONCTION(
       NOM_PARA= 'INST',  VALE= (
     0.0,      0.0,
     1.0,  -1000.0,
     2.0,  -2000.0,
    ), PROL_GAUCHE= 'CONSTANT',
       PROL_DROITE= 'CONSTANT')

# fonction de chargement : constant. Valeur maxi : 0.000000e+00
FCHG0002 = DEFI_FONCTION(
       NOM_PARA= 'INST',  VALE= (
     0.0000000e+00,  0.0000000e+00,
     1.0000000e+00,  0.0000000e+00,
    ), PROL_GAUCHE= 'CONSTANT',
       PROL_DROITE= 'CONSTANT')

TEMPS = DEFI_LIST_REEL(
   DEBUT = 0.000000e+00,
   INTERVALLE= _F(JUSQU_A= 2.0, PAS=1.0) )

# ----------------------------------------------------------------------
# ----------------------- DEPLACEMENTS ---------------------------------
DEPLT = AFFE_CHAR_MECA_F(
   MODELE= MO,
   DDL_IMPO=(
      _F( NOEUD= ('G00202',),
          DX=FCHG0002, DY=FCHG0002, DZ=FCHG0002, DRX=FCHG0002 ),
      _F( NOEUD= ('G00101',),
          DY=FCHG0002, DZ=FCHG0002, DRX=FCHG0002 ),
))

# ----------------------------------------------------------------------
# --------------------------- EFFORTS ----------------------------------
FORCT = AFFE_CHAR_MECA_F(
   MODELE= MO,
   FORCE_NODALE=(
      _F( NOEUD= ('G00101',),
          FX=FCHG000X ) ) )

# **********************************************************************
#                  C A L C U L   N O N   L I N E A I R E
# **********************************************************************

STNL = STAT_NON_LINE(
   MODELE    = MO,
   CHAM_MATER= CHMAT,
   CARA_ELEM = CAREL,
   EXCIT=(
     _F(CHARGE = DEPLT ),
     _F(CHARGE = FORCT ),
   ),
   INCREMENT= _F(LIST_INST = TEMPS),
   NEWTON= _F(MATRICE = 'TANGENTE', REAC_ITER= 1),
   COMP_INCR=(
   _F(RELATION= 'VMIS_ISOT_LINE', 
      DEFORMATION= 'PETIT',
      GROUP_MA=('S002','S001',)),
   ),
)


FL = [None]*3
for i in range(1,3):
  print "Nume ordre   %d " % i
  inst = i * 1.0;

# Matrice elementaire de rigidite
  DETRUIRE( CONCEPT= _F( NOM= 'MELRI' ) )
  MELRI=CALC_MATR_ELEM(
     OPTION='RIGI_MECA',
     MODELE=MO,
     CHAM_MATER=CHMAT,
     CARA_ELEM=CAREL,
     CHARGE=DEPLT,
     INST= inst )

# Numerotation des equations du systeme
  DETRUIRE( CONCEPT= _F( NOM= 'NUMDDL' ) )
  NUMDDL=NUME_DDL(MATR_RIGI=MELRI,)

# Matrice assemblee de rigidite
  DETRUIRE( CONCEPT= _F( NOM= 'MASRI' ) )
  MASRI=ASSE_MATRICE(
    MATR_ELEM=MELRI,
    NUME_DDL=NUMDDL,)

# Factorisation de la matrice assemblee de rigidite
  DETRUIRE( CONCEPT= _F( NOM= 'MASRIFA' ) )
  MASRIFA=FACT_LDLT(MATR_ASSE=MASRI,)

# Prise en compte de la precontrainte au niveau elementaire
  DETRUIRE( CONCEPT= _F( NOM= 'VASFO' ) )
  VASFO=CREA_CHAMP(
    TYPE_CHAM='ELGA_SIEF_R',
    OPERATION='EXTR',
    RESULTAT=STNL,
    NOM_CHAM='SIEF_ELGA',
    NUME_ORDRE= i )

# Matrice elementaire de rigidite geometrique
  DETRUIRE( CONCEPT= _F( NOM= 'MELGEO' ) )
  MELGEO=CALC_MATR_ELEM(
    OPTION='RIGI_GEOM',
    MODELE=MO,
    CARA_ELEM=CAREL,
    SIEF_ELGA=VASFO,)

# Matrice assemblee de rigidite geometrique
  DETRUIRE( CONCEPT= _F( NOM= 'MASGEO' ) )
  MASGEO=ASSE_MATRICE(
    MATR_ELEM=MELGEO,
    NUME_DDL=NUMDDL,)

# Calcul modal avec precontrainte
# Creation du nom du concept de flambement
  FL[ i ] = CO('FL_%d' % i )
  DETRUIRE( CONCEPT= _F( NOM= FL[ i ] ) )
  FL[ i ]=MODE_ITER_SIMULT(
    MATR_A=MASRI,
    MATR_B=MASGEO,
    TYPE_RESU='MODE_FLAMB',
    CALC_FREQ=_F(OPTION='PLUS_PETITE',
                 NMAX_FREQ= 6),
    VERI_MODE=_F(STOP_ERREUR='NON',),)

  FL[ i ]=NORM_MODE(
    reuse =FL[ i ],
    MODE  =FL[ i ],
    NORME ='TRAN',)


TEST_RESU( RESU=(
_F( RESULTAT = FL[2],  NUME_MODE = 6, PARA = 'CHAR_CRIT',
    REFERENCE='ANALYTIQUE',
    VALE =  -3.070545, PRECISION = 2.0E-03),
_F( RESULTAT = FL[2],  NUME_MODE = 5, PARA = 'CHAR_CRIT',
    REFERENCE='ANALYTIQUE',
    VALE = -12.282175, PRECISION = 2.0E-03),
_F( RESULTAT = FL[2],  NUME_MODE = 3, PARA = 'CHAR_CRIT',
    REFERENCE='ANALYTIQUE',
    VALE = -27.634895, PRECISION = 2.0E-03),
_F( RESULTAT = FL[2],  NUME_MODE = 2, PARA = 'CHAR_CRIT',
    REFERENCE='ANALYTIQUE',
    VALE = -49.128705, PRECISION = 2.0E-03),

_F( RESULTAT = FL[1],  NUME_MODE = 6, PARA = 'CHAR_CRIT',
    REFERENCE='ANALYTIQUE',
    VALE =  -6.14109, PRECISION  = 2.0E-03),
_F( RESULTAT = FL[1],  NUME_MODE = 5, PARA = 'CHAR_CRIT',
    REFERENCE='ANALYTIQUE',
    VALE = -24.56435, PRECISION  = 2.0E-03),
_F( RESULTAT = FL[1],  NUME_MODE = 3, PARA = 'CHAR_CRIT',
    REFERENCE='ANALYTIQUE',
    VALE = -55.26979, PRECISION  = 2.0E-03),
_F( RESULTAT = FL[1],  NUME_MODE = 2, PARA = 'CHAR_CRIT',
    REFERENCE='ANALYTIQUE',
    VALE = -98.25741, PRECISION  = 2.0E-03),
) )


FIN()
