# MODIF  DATE 16/10/2012   AUTEUR ALARCON A.ALARCON 
# TITRE ROTOR TOURNANT SUIVANT UNE LOI DE VITESSE DE ROTATION LINEAIRE
#            CONFIGURATION MANAGEMENT OF EDF VERSION
# ======================================================================
# COPYRIGHT (C) 1991 - 2012  EDF R&D                  WWW.CODE-ASTER.ORG
# THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY  
# IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY  
# THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR     
# (AT YOUR OPTION) ANY LATER VERSION.                                                    
#                                                                       
# THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT   
# WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF            
# MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU      
# GENERAL PUBLIC LICENSE FOR MORE DETAILS.                              
#                                                                       
# YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE     
# ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,         
#    1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.        
# ======================================================================
# sdll144a.para = tps_job 120 mem_job 512Mo ncpus 1 liste_test R
# RESPONSABLE TORKHANI M.TORKHANI
#

DEBUT( CODE=_F(NOM='SDLL144A', NIV_PUB_WEB='INTERNET'),
       PAR_LOT='NON')

import numpy as NP
import numpy.linalg as LA
import os

MAIL=LIRE_MAILLAGE();

MODELE=AFFE_MODELE(MAILLAGE=MAIL,
                   AFFE=(_F(GROUP_MA='ROTOR',
                            PHENOMENE='MECANIQUE',
                            MODELISATION='POU_D_T',),
                         _F(GROUP_MA=('PALIER_E','DISQUES',),
                            PHENOMENE='MECANIQUE',
                            MODELISATION='DIS_TR',),),);

ACIER=DEFI_MATERIAU(ELAS=_F(E=2.0E11,
                            NU=0.3,
                            RHO=7800.0,),);

CHMAT=AFFE_MATERIAU(MAILLAGE=MAIL,
                    AFFE=_F(GROUP_MA='ROTOR',
                            MATER=ACIER,),);

CARELEM=AFFE_CARA_ELEM(MODELE=MODELE,
                       POUTRE=_F(GROUP_MA='ROTOR',
                                 SECTION='CERCLE',
                                 CARA='R',
                                 VALE=.01,),
                       DISCRET=(
                                   _F(GROUP_MA='DISQUES',
                                     REPERE='LOCAL',
                                     CARA='M_TR_D_N',
                                     VALE=(16.470,0.1861,0.09427,0.09427,0.,0.,0.,0.,0.,0.),),
                                   _F(GROUP_MA='PALIER_E',
                                     CARA='K_TR_D_N',
                                     SYME='OUI',
                                     VALE=(2.0E5,5.0E5,0.,0.,0.,0.),
                                  ),
                                   _F(GROUP_MA='PALIER_E',
                                     CARA='A_TR_D_N',
                                     SYME='OUI',
                                     VALE=(1.0E2,1.0E2,0.,0.,0.,0.),
                                  ),
                                  ),
                        ORIENTATION=_F(GROUP_MA=('DISQUES'),
                                      CARA='ANGL_NAUT',
                                      VALE=(0.,-90.,0.,),),);

CARELEM2=AFFE_CARA_ELEM(MODELE=MODELE,
                       POUTRE=_F(GROUP_MA='ROTOR',
                                 SECTION='CERCLE',
                                 CARA='R',
                                 VALE=.01,),
                       DISCRET=(_F(GROUP_MA='DISQUES',
                                     REPERE='LOCAL',
                                     CARA='M_TR_D_N',
                                     VALE=(16.470,0.1861,0.09427,0.09427,0.,0.,0.,0.,0.,0.),),
                                   _F(GROUP_MA='PALIER_E',
                                      CARA='M_TR_N',
                                      SYME='NON',
                                      VALE = ( 0.,   0.,   0.,   0.,   0.,   0.,  
                                               0.,   0.,   0.,   0.,   0.,   0.,
                                               0.,   0.,   0.,   0.,   0.,   0.,   
                                               0.,   0.,   0.,   0.,   0.,   0.,   
                                               0.,   0.,   0.,   0.,   0.,   0.,   
                                               0.,   0.,   0.,   0.,   0.,   0.,),),
                                   _F(GROUP_MA='PALIER_E',
                                      CARA='K_TR_N',
                                      SYME='NON',
                                      VALE = ( 2.0E5,   0.,      0.,   0.,   0.,   0.,  
                                               0.,      5.0E5,   0.,   0.,   0.,   0.,
                                               0.,   0.,   0.,   0.,   0.,   0.,   
                                               0.,   0.,   0.,   0.,   0.,   0.,   
                                               0.,   0.,   0.,   0.,   0.,   0.,   
                                               0.,   0.,   0.,   0.,   0.,   0.,),),
                                   _F(GROUP_MA='PALIER_E',
                                      CARA='A_TR_N',
                                      SYME='NON',
                                      VALE = ( 4.0E1,   0.,      0.,   0.,   0.,   0.,  
                                               0.,      1.0E2,   0.,   0.,   0.,   0.,
                                               0.,   0.,   0.,   0.,   0.,   0.,   
                                               0.,   0.,   0.,   0.,   0.,   0.,   
                                               0.,   0.,   0.,   0.,   0.,   0.,   
                                               0.,   0.,   0.,   0.,   0.,   0.,),),
                                       ),
                    ORIENTATION=_F(GROUP_MA=('DISQUES'),
                               CARA='ANGL_NAUT',
                               VALE=(0.,-90.,0.,),),);

BLOQUAGE=AFFE_CHAR_MECA(MODELE=MODELE,
                        DDL_IMPO=(_F(TOUT='OUI',
                                     DZ=0.0,DRZ=0,),
                                  _F(GROUP_NO=('PALIER_A','PALIER_B',),
                                     DX=0.0,DY=0,),
                                     ),);

balou = 0.15 * 1e-04;

bal_FX=AFFE_CHAR_MECA(MODELE=MODELE,
                      FORCE_NODALE=_F(GROUP_NO='N_DIS2',
                                      FX=(balou),),);

bal_FY=AFFE_CHAR_MECA(MODELE=MODELE,
                      FORCE_NODALE=_F(GROUP_NO='N_DIS2',
                                      FY=(balou),),);

ASSEMBLAGE(MODELE=MODELE,
                CHAM_MATER=CHMAT,
                CARA_ELEM=CARELEM,
                CHARGE=BLOQUAGE,
                NUME_DDL=CO('NUMEDDL'),
                MATR_ASSE=(_F(MATRICE=CO('RIGIDITE'),
                              OPTION='RIGI_MECA',),
                           _F(MATRICE=CO('MASSE'),
                              OPTION='MASS_MECA',),
                           _F(MATRICE=CO('GYRO'),
                              OPTION='MECA_GYRO',),
                           _F(MATRICE=CO('AMOR'),
                              OPTION='AMOR_MECA',),),);

MODES=MODE_ITER_SIMULT(MATR_RIGI=RIGIDITE,
                       MATR_MASS=MASSE,
                       CALC_FREQ=_F(OPTION='BANDE',
                                    FREQ=(0.,1000.,),),);

ASSEMBLAGE(MODELE=MODELE,
                CHAM_MATER=CHMAT,
                CARA_ELEM=CARELEM2,
                CHARGE=BLOQUAGE,
                NUME_DDL=CO('NUMEDDL2'),
                MATR_ASSE=(_F(MATRICE=CO('RIGIDIT2'),
                              OPTION='RIGI_MECA',),
                           _F(MATRICE=CO('MASSE2'),
                              OPTION='MASS_MECA',),
                           _F(MATRICE=CO('GYRO2'),
                              OPTION='MECA_GYRO',),
                           _F(MATRICE=CO('RIGY2'),
                              OPTION='RIGI_GYRO',),
                           _F(MATRICE=CO('AMOR2'),
                              OPTION='AMOR_MECA',),),
                VECT_ASSE=(_F(VECTEUR=CO("bal_Yass"),
                              OPTION='CHAR_MECA',
                              CHARGE=bal_FY),
                           _F(VECTEUR=CO("bal_Xass"),
                              OPTION='CHAR_MECA',
                              CHARGE=bal_FX),
                           ),
                );                                  

tours=NP.array([0.0,5000.0])

NTRIMdeb = tours[0];

OMdeb = 2 * pi * NTRIMdeb / 60.0;

NTRIMfin = tours[1];

OMfin = 2 * pi * NTRIMfin / 60.0;

PHIdeb = 0;

tdeb = 0.0;
tfin = 12.0;

pdtf = 5e-05;

A = (OMdeb*tfin-OMfin*tdeb)/(tfin-tdeb);

B = (OMdeb-OMfin)/(tdeb-tfin);

C = PHIdeb - A*tdeb - 0.5*B*(tdeb**2);

PHI=FORMULE(VALE='A*INST + 0.5*B*(INST**2) + C',
            NOM_PARA='INST',);

OM=FORMULE(VALE='A+B*INST',
           NOM_PARA='INST',);

ACC=FORMULE(VALE='B',
            NOM_PARA='INST',);


forx = FORMULE(VALE='(OM(INST) ** 2) * cos(PHI(INST)) + ACC(INST) * sin(PHI(INST))',
                NOM_PARA='INST',);

fory = FORMULE(VALE='(OM(INST) ** 2) * sin(PHI(INST)) - ACC(INST) * cos(PHI(INST))',
                NOM_PARA='INST',);

PROJ_BASE(BASE=MODES,
                STOCKAGE='PLEIN',
                MATR_ASSE_GENE=(_F(MATRICE=CO('MAGE'),
                                   MATR_ASSE=MASSE2,),
                                _F(MATRICE=CO('RIGE'),
                                   MATR_ASSE=RIGIDIT2,),
                                _F(MATRICE=CO('AMGE'),
                                   MATR_ASSE=AMOR2,),
                                _F(MATRICE=CO('GYGE'),
                                   MATR_ASSE=GYRO2,),
                                _F(MATRICE=CO('RIGY'),
                                   MATR_ASSE=RIGY2,),
                                    ),
                VECT_ASSE_GENE=(_F(VECTEUR=CO('BXGE'),
                                   VECT_ASSE=bal_Xass,),
                                _F(VECTEUR=CO('BYGE'),
                                   VECT_ASSE=bal_Yass,),),);


TRANGEN=DYNA_VIBRA(TYPE_CALCUL='TRAN',BASE_CALCUL='GENE',
                        SCHEMA_TEMPS=_F(SCHEMA='NEWMARK',),
                        MATR_MASS=MAGE,
                        MATR_RIGI=RIGE,
                        MATR_AMOR=AMGE,
                        VITESSE_VARIABLE='OUI',
                        MATR_GYRO=GYGE,
                        MATR_RIGY=RIGY,
                        VITE_ROTA=OM,
                        ACCE_ROTA=ACC,
                        INCREMENT=_F(INST_FIN=0.5*tfin,
                                     PAS=pdtf,
                                     COEF_MULT_PAS=1.1,
                                     COEF_DIVI_PAS=1.3,
                                     PAS_MAXI=(pdtf*100.),
                                     PAS_MINI=(pdtf/100.),
                                     VERI_PAS='NON',
                                     ),
                        EXCIT=(_F(VECT_ASSE_GENE=BXGE,
                                  FONC_MULT=forx,),
                               _F(VECT_ASSE_GENE=BYGE,
                                  FONC_MULT=fory,),),);

TRANGEN=DYNA_VIBRA(reuse=TRANGEN,
                        TYPE_CALCUL='TRAN',BASE_CALCUL='GENE',
                        SCHEMA_TEMPS=_F(SCHEMA='NEWMARK',),
                        MATR_MASS=MAGE,
                        MATR_RIGI=RIGE,
                        MATR_AMOR=AMGE,
                        VITESSE_VARIABLE='OUI',
                        MATR_GYRO=GYGE,
                        MATR_RIGY=RIGY,
                        VITE_ROTA=OM,
                        ACCE_ROTA=ACC,
                        ETAT_INIT=_F(RESULTAT = TRANGEN),                        
                        INCREMENT=_F(INST_FIN=tfin,
                                     PAS=pdtf,
                                     COEF_MULT_PAS=1.1,
                                     COEF_DIVI_PAS=1.3,
                                     PAS_MAXI=(pdtf*100.),
                                     PAS_MINI=(pdtf/100.),
                                     VERI_PAS='NON',
                                     ),
                        EXCIT=(_F(VECT_ASSE_GENE=BXGE,
                                  FONC_MULT=forx,),
                               _F(VECT_ASSE_GENE=BYGE,
                                  FONC_MULT=fory,),),);

DX_GED2=RECU_FONCTION(RESU_GENE=TRANGEN,
                      NOM_CHAM='DEPL',
                      NOM_CMP='DX',
                      GROUP_NO='N_DIS2',
                      INTERPOL='LIN',);

DX2_GED2=CALC_FONCTION(PUISSANCE=_F(FONCTION=DX_GED2,
                                    EXPOSANT=2),)

DY_GED2=RECU_FONCTION(RESU_GENE=TRANGEN,
                      NOM_CHAM='DEPL',
                      NOM_CMP='DY',
                      GROUP_NO='N_DIS2',
                      INTERPOL='LIN',);

DY2_GED2=CALC_FONCTION(PUISSANCE=_F(FONCTION=DY_GED2,
                                    EXPOSANT=2),)

MOD_GED2=CALC_FONCTION(COMB=(_F(FONCTION=DX2_GED2,COEF=1.0),
                             _F(FONCTION=DY2_GED2,COEF=1.0),), )

TEST_FONCTION(VALEUR=_F(VALE_CALC=2.65696801415e-09,
                        VALE_REFE=2.5806E-09,
                        VALE_PARA=7.87235,
                        REFERENCE='SOURCE_EXTERNE',
                        PRECISION=0.050000000000000003,
                        FONCTION=MOD_GED2,),
              )

TEST_FONCTION(VALEUR=_F(VALE_CALC=2.6569800000000001E-09,
                        TOLE_MACHINE=1.0000000000000001E-05,
                        VALE_PARA=7.87235,
                        FONCTION=MOD_GED2,
                        ),
              )

FIN();
