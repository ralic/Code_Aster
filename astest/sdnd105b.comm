# TITRE CHOC DE DEUX MASSES AU COMPORTEMENT FLAMBAGE PLASTIQUE
# ======================================================================
# COPYRIGHT (C) 1991 - 2013  EDF R&D                  WWW.CODE-ASTER.ORG
# THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY
# IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY
# THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR
# (AT YOUR OPTION) ANY LATER VERSION.
#
# THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT
# WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF
# MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU
# GENERAL PUBLIC LICENSE FOR MORE DETAILS.
#
# YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE
# ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,
#    1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.
# ======================================================================
# ----------------------------------------------------------------------
#

DEBUT( CODE=_F(NIV_PUB_WEB='INTERNET'),DEBUG=_F(SDVERI='OUI'))

MAILLAGE=LIRE_MAILLAGE( )

MAILLAGE=DEFI_GROUP(reuse=MAILLAGE,
                    MAILLAGE=MAILLAGE,
                    CREA_GROUP_NO=_F( NOM='GROUP_NO_GN2',
                                      NOEUD=('N02',),),);
MAILLAGE=DEFI_GROUP(reuse=MAILLAGE,
                    MAILLAGE=MAILLAGE,
                    CREA_GROUP_NO=_F( NOM='GROUP_NO_GN3',
                                      NOEUD=('N03',),),);

MODELE=AFFE_MODELE(  MAILLAGE=MAILLAGE,AFFE=(
                  _F(  PHENOMENE = 'MECANIQUE', MODELISATION = 'DIS_TR',
                         GROUP_MA = 'GROUP_MA_STRUC'),
                       _F(  PHENOMENE = 'MECANIQUE', MODELISATION = 'DIS_TR',
                         GROUP_NO = 'GROUP_NO_AUTRE'))
                       )

CON_LIM=AFFE_CHAR_MECA( MODELE=MODELE,DDL_IMPO=(
                              _F(  GROUP_NO = 'GROUP_NO_ENCASTRE',
                                         DX = 0., DY = 0., DZ = 0.,
                                         DRX = 0., DRY = 0., DRZ = 0.),
                                       _F(  GROUP_NO = 'GROUP_NO_AUTRE',
                                                  DY = 0., DZ = 0.,
                                         DRX = 0., DRY = 0., DRZ = 0.))
                           )

CARA_ELE=AFFE_CARA_ELEM(  MODELE=MODELE,DISCRET=(
                       _F(  GROUP_NO = 'GROUP_NO_AUTRE',
                                 CARA = 'K_TR_N',
                                  VALE = ( 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
                                          0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
                                          0.,)),
                      _F(  GROUP_NO = 'GROUP_NO_AUTRE',
                                 CARA = 'M_TR_N',
                                 VALE = ( 1., 0., 1., 0., 0., 1., 0.,
                                         0., 0., 0., 0., 0., 0., 0.,
                                         0., 0., 0., 0., 0., 0., 0.,)),
                               _F(  GROUP_MA = 'GROUP_MA_STRUC',  CARA = 'K_TR_D_L',
                                 VALE = ( 0.0000001, 0., 0., 0., 0., 0., ),
                                 REPERE = 'GLOBAL'))                )

RIGI_ELE=CALC_MATR_ELEM(  MODELE=MODELE,  OPTION='RIGI_MECA',
                              CARA_ELEM=CARA_ELE,  CHARGE=CON_LIM   )

MASS_ELE=CALC_MATR_ELEM( MODELE=MODELE,  OPTION='MASS_MECA_DIAG',
                              CARA_ELEM=CARA_ELE,  CHARGE=CON_LIM   )

#

NUMEDDL=NUME_DDL(  MATR_RIGI=RIGI_ELE,   METHODE='LDLT',
                        RENUM='SANS')

#

RIGIDITE=ASSE_MATRICE(  MATR_ELEM=RIGI_ELE,  NUME_DDL=NUMEDDL  )

MASSE=ASSE_MATRICE(  MATR_ELEM=MASS_ELE,  NUME_DDL=NUMEDDL  )

#

MODE_MEC=MODE_ITER_SIMULT(  MATR_RIGI=RIGIDITE,  MATR_MASS=MASSE,
              CALC_FREQ=_F(  OPTION = 'PLUS_PETITE',  NMAX_FREQ = 2)    )


#
#-----------------------------------------------------------------------


PROJ_BASE(  BASE=MODE_MEC,
            STOCKAGE='DIAG',
            MATR_ASSE_GENE=(
               _F(  MATRICE = CO("MASS_GEN"),
                                MATR_ASSE = MASSE),
               _F(  MATRICE = CO("RIGI_GEN"),
                                MATR_ASSE = RIGIDITE))
                                    )

#

V02=2.

V03=-2.

VIT_INI1=CREA_CHAMP( OPERATION='AFFE', TYPE_CHAM='NOEU_DEPL_R',
              MAILLAGE=MAILLAGE,AFFE=(
               _F(  TOUT = 'OUI', NOM_CMP = 'DX', VALE = 0.),
               _F(  TOUT = 'OUI', NOM_CMP = 'DY', VALE = 0.),
               _F(  TOUT = 'OUI', NOM_CMP = 'DZ', VALE = 0.),
               _F(  TOUT = 'OUI', NOM_CMP = 'DRX', VALE = 0.),
               _F(  TOUT = 'OUI', NOM_CMP = 'DRY', VALE = 0.),
               _F(  TOUT = 'OUI', NOM_CMP = 'DRZ', VALE = 0.),
               _F(  NOEUD = 'N02',  NOM_CMP = 'DX', VALE = V02),
               _F(  NOEUD = 'N03',  NOM_CMP = 'DX', VALE = V03))
                  )

# POUR TESTER LES MOTS CLES NUME_DDL ET CHAM_NO DE CREA_CHAMP :

VIT_INI2=CREA_CHAMP( OPERATION='ASSE',   TYPE_CHAM='NOEU_DEPL_R',
                       MAILLAGE=MAILLAGE,    NUME_DDL=NUMEDDL,
                       ASSE=_F(  TOUT = 'OUI', CHAM_GD = VIT_INI1))

VIT_INIT=CREA_CHAMP( OPERATION='ASSE',   TYPE_CHAM='NOEU_DEPL_R',
                       MAILLAGE=MAILLAGE,    CHAM_NO=VIT_INI2,
                       ASSE=_F(  TOUT = 'OUI', CHAM_GD = VIT_INI1))

NUMEGE=NUME_DDL_GENE(   BASE=MODE_MEC,
                          STOCKAGE='DIAG' )

#


VIT_GENE=PROJ_VECT_BASE(  BASE=MODE_MEC,
                              VECT_ASSE=VIT_INIT,
                              TYPE_VECT='VITE',
                             NUME_DDL_GENE=NUMEGE)

#

BI_PLANY=DEFI_OBSTACLE(TYPE='BI_PLAN_Y')

#


TRAN_GEN=DYNA_VIBRA(TYPE_CALCUL='TRAN',BASE_CALCUL='GENE',
                      MATR_MASS=MASS_GEN,   MATR_RIGI=RIGI_GEN,
                      SCHEMA_TEMPS=_F(SCHEMA='EULER',),
                      ETAT_INIT=_F(  VITE = VIT_GENE),

                      FLAMBAGE=_F(  GROUP_NO_1 = 'GROUP_NO_GN2',
                                 GROUP_NO_2 = 'GROUP_NO_GN3',
                                 OBSTACLE = BI_PLANY,
                                 NORM_OBST = (0., 1., 0.,),
                                 DIST_1 = 5.,
                                 DIST_2 = 5.,
                                 RIGI_NOR = 0.5,
                                 FNOR_CRIT = 1.,
                                 FNOR_POST_FL = 0.5,
                                 RIGI_NOR_POST_FL = 0.25),

                      INCREMENT=_F(
                                  INST_INIT = 0.,   INST_FIN = 3.,
                                  PAS = 0.001)
                            )

TRAN_GEN=DYNA_VIBRA(TYPE_CALCUL='TRAN',BASE_CALCUL='GENE',
                      reuse=TRAN_GEN,  MATR_MASS=MASS_GEN,   MATR_RIGI=RIGI_GEN,
                      SCHEMA_TEMPS=_F(SCHEMA='ADAPT_ORDRE2',),
                      ETAT_INIT=_F(  RESULTAT = TRAN_GEN,
                                  INST_INIT = 3.),

                      FLAMBAGE=_F(  NOEUD_1 = 'N02',
                                 NOEUD_2 = 'N03',
                                 OBSTACLE = BI_PLANY,
                                 NORM_OBST = (0., 1., 0.,),
                                 DIST_1 = 5.,
                                 DIST_2 = 5.,
                                 RIGI_NOR = 0.5,
                                 FNOR_CRIT = 1.,
                                 FNOR_POST_FL = 0.5,
                                 RIGI_NOR_POST_FL = 0.25,
                                 ANGL_VRIL = 0.,),

                      INCREMENT=_F(
                                 INST_FIN = 12.,  PAS = 0.001,PAS_MAXI = 0.005)
                            )


TABLE=POST_DYNA_MODA_T(   RESU_GENE=TRAN_GEN,
                              CHOC=_F(  OPTION = 'IMPACT')
                          )

# references
tfl = pi/6
dp = 3.
t0 = pi/6 +2*sqrt(3.) +(pi+6)/sqrt(2.)

TEST_TABLE(REFERENCE='ANALYTIQUE',
           PRECISION=3.0000000000000001E-3,
           VALE_CALC=0.524000000,
           VALE_REFE=0.52359877559829882,
           NOM_PARA='INST_FLAMB',
           TABLE=TABLE,
           FILTRE=(_F(NOM_PARA='CALCUL',
                      VALE_K='FLAMBAGE',),
                   _F(NOM_PARA='NOEUD',
                      VALE_K='N02',),
                   ),
           )

TEST_TABLE(REFERENCE='ANALYTIQUE',
           PRECISION=3.00E-3,
           VALE_CALC=2.998684,
           VALE_REFE=3.0,
           NOM_PARA='ECRAS_RESI',
           TABLE=TABLE,
           FILTRE=(_F(NOM_PARA='CALCUL',
                      VALE_K='FLAMBAGE',),
                   _F(NOM_PARA='NOEUD',
                      VALE_K='N03',),
                   ),
           )

TRAN=REST_GENE_PHYS(   RESU_GENE=TRAN_GEN,
                           NOM_CHAM='DEPL',
                       )

#IMPR_RESU(RESU=_F(RESULTAT=TRAN))
TEST_RESU(RESU=_F(INST=1.04505447028502E+01,
                  REFERENCE='ANALYTIQUE',
                  RESULTAT=TRAN,
                  NOM_CHAM='DEPL',
                  NOEUD='N02',
                  NOM_CMP='DX',
                  VALE_CALC=-7.32494377E-04,
                  VALE_REFE=0.0,
                  CRITERE=('ABSOLU', 'RELATIF'),
                  PRECISION=3.00E-3,),
          )

FIN()
#
