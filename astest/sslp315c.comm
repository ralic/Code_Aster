# MODIF  DATE 10/08/2010   AUTEUR GENIAUT S.GENIAUT 
# TITRE PROPAGATION D'UNE FISSURE XFEM EN 2D DANS UNE PLAQUE TROUEE EN FLEXION 3 POINTS
# sslp315c.para = tps_job 250 mem_job 512Mo liste_test S
#            CONFIGURATION MANAGEMENT OF EDF VERSION
# ======================================================================
# COPYRIGHT (C) 1991 - 2009  EDF R&D                  WWW.CODE-ASTER.ORG
# THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY  
# IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY  
# THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR     
# (AT YOUR OPTION) ANY LATER VERSION.                                                    
#                                                                       
# THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT   
# WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF            
# MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU      
# GENERAL PUBLIC LICENSE FOR MORE DETAILS.                              
#                                                                       
# YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE     
# ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,         
#    1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.        
# ======================================================================
# RESPONSABLE GENIAUT S.GENIAUT

DEBUT(CODE=_F(NOM='SSLP315C', NIV_PUB_WEB='INTERNET'),
      DEBUG=_F(SDVERI='OUI'),)

# *********************************************
# MAILLAGE 
# *********************************************

poutre=LIRE_MAILLAGE(FORMAT='MED',
                     INFO_MED=1,);

# *********************************************
# MATERIAU
# *********************************************

E=200000.0E6
nu=0.3

acier=DEFI_MATERIAU(ELAS=_F(E=E,NU=nu,),);

champma=AFFE_MATERIAU(MAILLAGE=poutre,
                      AFFE=_F(GROUP_MA='All',
                              MATER=acier,
                              ),);

# *********************************************
# MODELE
# *********************************************

mod=AFFE_MODELE(MAILLAGE=poutre,
                AFFE=(_F(GROUP_MA='All',
                         PHENOMENE='MECANIQUE',
                         MODELISATION='D_PLAN',),),);

# *********************************************
# CHARGEMENTS ET CONDITION AUX LIMITES
# *********************************************

cauxl=AFFE_CHAR_MECA(MODELE=mod,
                     DDL_IMPO=(_F(GROUP_NO='VincSx',DX=0.,DY=0.,),
                               _F(GROUP_NO='VincDx',DY=0.,),),
                     FORCE_NODALE=_F(GROUP_NO='Forza',FY=-1000.,)
                     );

# *********************************************
# DEFINITION DE LA FISSURE DANS LE MODELE
# *********************************************

# NOMBRE DE PROPAGATIONS
NPS = 4
fiss = [None]*NPS

# COORD DU FOND DE FISSURE
XFiss = 40.0
YFiss = 15.0

# DEFINITION DES LEVEL SETS
LN = FORMULE(VALE='X-XFiss',
             NOM_PARA=('X'));

LT = FORMULE(VALE='Y-YFiss',
             NOM_PARA=('Y'));

# DEFINITION DE LA FISSURE INITIALE
fiss[0] = DEFI_FISS_XFEM(MODELE=mod,
                         DEFI_FISS=_F(FONC_LT=LT,
                                      FONC_LN=LN,),
                         GROUP_MA_ENRI='All',
                         );

# *********************************************
# GRILLE AUXILIAIRE POUR LES LEVEL SETS
# *********************************************

mailvs=LIRE_MAILLAGE(FORMAT='MED',
                     INFO_MED=1,
                     UNITE=41,);

modlvs=AFFE_MODELE(MAILLAGE=mailvs,
                   AFFE=(_F(GROUP_MA='All',
                            PHENOMENE='MECANIQUE',
                            MODELISATION='D_PLAN',),),);

fislvt = DEFI_FISS_XFEM(MODELE=modlvs,
                        DEFI_FISS=_F(FONC_LT=LT,
                                     FONC_LN=LN,),
                        GROUP_MA_ENRI='All',
                         );

modXlvt=MODI_MODELE_XFEM(MODELE_IN=modlvs,
                         FISSURE=fislvt,);

# *********************************************
# PROPAGATION DE LA FISSURE
# *********************************************

ModX = [None]*NPS
ChgX = [None]*NPS
ResX = [None]*NPS
SIF = [None]*NPS
LSN = [None]*NPS
LST = [None]*NPS

RI = 0.5*2
RS = 0.5*4

# LEVEL SETS AU DEBUT DE LA PROPAGATION
LSN[0]=CREA_CHAMP(TYPE_CHAM='NOEU_NEUT_R',
                  OPERATION='EXTR',
                  FISSURE=fiss[0],
                  NOM_CHAM='LNNO',);
LST[0]=CREA_CHAMP(TYPE_CHAM='NOEU_NEUT_R',
                  OPERATION='EXTR',
                  FISSURE=fiss[0],
                  NOM_CHAM='LTNO',);
DEFI_FICHIER(UNITE=30,);
IMPR_RESU(FORMAT='MED',
          UNITE=30,
          RESU=_F(CHAM_GD=LSN[0],),);
IMPR_RESU(FORMAT='MED',
          UNITE=30,
          RESU=_F(CHAM_GD=LST[0],),);

timestep=DEFI_LIST_REEL(DEBUT=0.0,INTERVALLE=_F(JUSQU_A=1.0,NOMBRE=1,),);

# PROPAGATION
for i in range(0,NPS) :

    ModX[i]=MODI_MODELE_XFEM(MODELE_IN=mod,
                             FISSURE=fiss[i],);

    ChgX[i]=AFFE_CHAR_MECA(MODELE=ModX[i],
                           LIAISON_XFEM='OUI',);

    ResX[i]=STAT_NON_LINE(MODELE=ModX[i],
                          CHAM_MATER=champma,
                          EXCIT=(_F(CHARGE=cauxl,),
                                 _F(CHARGE=ChgX[i],),),
                     COMP_ELAS=_F(RELATION='ELAS',
                                  TOUT='OUI',),
                     INCREMENT=_F(LIST_INST=timestep,
                                  INST_FIN=1,),
                     NEWTON=_F(REAC_ITER=1,),
                     INFO=1,
                     ARCHIVAGE=_F(CHAM_EXCLU='VARI_ELGA',),);

    SIF[i]=CALC_G(OPTION='CALC_K_G',
                  THETA=_F(FISSURE=fiss[i],
                           R_INF=RI,
                           R_SUP=RS,),
                  RESULTAT=ResX[i],
                  COMP_ELAS=_F(RELATION='ELAS',),
                  INFO=2,);

    IMPR_TABLE(TABLE=SIF[i],);

    if ( i != NPS-1 ) :
      fiss[i+1]=CO('fiss_%d'%(i+1))
      PROPA_FISS(MODELE=ModX[i],
                 FISSURE=_F(FISS_ACTUELLE=fiss[i],
                            FISS_PROPAGEE=fiss[i+1],
                            GRILLE_AUX=modXlvt,
                            TABLE=SIF[i],),
                 METHODE_PROPA='UPWIND',
                 DA_MAX=2,
                 LOI_PROPA=_F(LOI='PARIS',
                              C=1.,
                              M=1.,
                              N=0.,
                              MATER=acier),
                 COMP_LINE=_F(COEF_MULT_MINI=0.,
                              COEF_MULT_MAXI=1.,),
                 RAYON=RS,
                 INFO=0,);

#     LEVEL SET AU PAS DE PROPAGATION COURANT
      LSN[i+1]=CREA_CHAMP(TYPE_CHAM='NOEU_NEUT_R',
                          OPERATION='EXTR',
                          FISSURE=fiss[i+1],
                          NOM_CHAM='LNNO',);
      LST[i+1]=CREA_CHAMP(TYPE_CHAM='NOEU_NEUT_R',
                          OPERATION='EXTR',
                          FISSURE=fiss[i+1],
                          NOM_CHAM='LTNO',);

      IMPR_RESU(FORMAT='MED',
                UNITE=30,
                RESU=_F(CHAM_GD=LSN[i+1],),);
      IMPR_RESU(FORMAT='MED',
                UNITE=30,
                RESU=_F(CHAM_GD=LST[i+1],),);

# *********************************************
# VERIFICATION DE LA POSITION DU FOND DE FISSURE
# *********************************************

# LES COORDONNES DU FOND DE FISSURE ONT ETE CALCULEES
# PAR LA METHODE PAR PROJECTION (SSLP315B):
# X=4.197468E+01
# Y=2.066568E+01
# ON PEUT SELECTIONNER LES NOEUDS DE L'ELEMENT DANS LEQUEL LE
# FOND DU FISSURE SE TROUVE:
# NOEUD 1= N1027
# NOEUD 2= N1492
# NOEUD 3= N298
# ON PEUT DONC CALCULER LA VALEUR DES LEVEL SETS POUR CES NOEUDS:

TABLSN= POST_RELEVE_T(ACTION=_F(INTITULE='Test LSN',
                                NOEUD=('N304','N1040','N1512'),
                                CHAM_GD=LSN[i],
                                TOUT_CMP='OUI',
                                OPERATION='EXTRACTION',),);

TABLST= POST_RELEVE_T(ACTION=_F(INTITULE='Test LST',
                                NOEUD=('N304','N1040','N1512'),
                                CHAM_GD=LST[i],
                                TOUT_CMP='OUI',
                                OPERATION='EXTRACTION',),);

IMPR_TABLE(TABLE=TABLSN,);
IMPR_TABLE(TABLE=TABLST,);

# ON PEUT ENFIN VERIFIER QUE LE FOND DE FISSURE CALCULE PAR PROPA_FISS
# EST DANS L'ELEMENT EN VERIFIENT QUE LA VALEUR DES LEVEL SETS EST
# INFERIEURE A LA DISTANCE MAXIMALE ENTRE LES TROIS NOEUDS (EGAL A 2.0)

DISTMAX=2.0

TEST_TABLE(TABLE=TABLSN,
           REFERENCE='NON_REGRESSION',
           NOM_PARA='X1',
           PRECISION=DISTMAX,
           TYPE_TEST='MAX',
           CRITERE='ABSOLU',
           VALE= 0.0,
           VALE_ABS='OUI',)

TEST_TABLE(TABLE=TABLSN,
           REFERENCE='NON_REGRESSION',
           NOM_PARA='X1',
           PRECISION=DISTMAX,
           TYPE_TEST='MIN',
           CRITERE='ABSOLU',
           VALE= 0.0,
           VALE_ABS='OUI',)

TEST_TABLE(TABLE=TABLST,
           REFERENCE='NON_REGRESSION',
           NOM_PARA='X1',
           PRECISION=DISTMAX,
           TYPE_TEST='MAX',
           CRITERE='ABSOLU',
           VALE= 0.0,
           VALE_ABS='OUI',)

TEST_TABLE(TABLE=TABLST,
           REFERENCE='NON_REGRESSION',
           NOM_PARA='X1',
           PRECISION=DISTMAX,
           TYPE_TEST='MIN',
           CRITERE='ABSOLU',
           VALE= 0.0,
           VALE_ABS='OUI',)

# *********************************************
# EDITION DES FICHIERS MED POUR LA CONFIGURATION FISSURE
# *********************************************

MAXF = [None]*NPS
MOVI = [None]*NPS
DEPL = [None]*NPS

DEFI_FICHIER(UNITE=31,);

for i in range(0,NPS-1) :
   MAXF[i]=POST_MAIL_XFEM(MODELE=ModX[i]);

   MOVI[i]=AFFE_MODELE(MAILLAGE=MAXF[i],
                         AFFE=_F(TOUT='OUI',
                                 PHENOMENE='MECANIQUE',
                                 MODELISATION='D_PLAN',),) 

   DEPL[i]=POST_CHAM_XFEM(
                          MODELE_VISU   = MOVI[i],
                          RESULTAT=ResX[i],
                          );

   IMPR_RESU(FORMAT='MED',
             UNITE=31,
             RESU=_F(RESULTAT=DEPL[i],),);


FIN();
 
