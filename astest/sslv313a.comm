# MODIF  DATE 03/05/2011   AUTEUR GENIAUT S.GENIAUT 
# TITRE TUBE SOUS PRESSION FISSURE - VALIDATION DE LA METHODE X-FEM
#            CONFIGURATION MANAGEMENT OF EDF VERSION
# ======================================================================
# COPYRIGHT (C) 1991 - 2011  EDF R&D                  WWW.CODE-ASTER.ORG
# THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY  
# IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY  
# THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR     
# (AT YOUR OPTION) ANY LATER VERSION.                                                    
#                                                                       
# THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT   
# WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF            
# MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU      
# GENERAL PUBLIC LICENSE FOR MORE DETAILS.                              
#                                                                       
# YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE     
# ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,         
#    1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.        
# ======================================================================
# MODELISATION A : FISSURE MAILLEE

DEBUT(CODE=_F( NOM = 'SSLV313A',NIV_PUB_WEB='INTERNET'))

MA=LIRE_MAILLAGE(VERI_MAIL=_F(VERIF='OUI'),)

MA=DEFI_GROUP( reuse=MA,   MAILLAGE=MA,
                     CREA_GROUP_NO=
             (_F(GROUP_MA = ('FACE1', 'FACE2','FOND','SINT','HAUT','LEV_SUP','LEV_INF'),),
              _F(INTERSEC = ('SINT', 'HAUT'),NOM='LH'),
              _F(INTERSEC = ('SINT', 'FACE1'),NOM='LPOST'),
              ),
                 )

MO=AFFE_MODELE(  MAILLAGE=MA,
                      AFFE=_F(  GROUP_MA= 'STRUCT',
                             PHENOMENE = 'MECANIQUE',
                             MODELISATION = '3D') )

MA=MODI_MAILLAGE(reuse =MA,
                 MAILLAGE=MA,
                 ORIE_PEAU_3D=_F(GROUP_MA=('LEV_SUP','LEV_INF','FACE1','FACE2','SINT','BAS'),),
                 );

MAT=DEFI_MATERIAU(ELAS=_F(  E = 2.E11,
                             NU = 0.3,
                             ALPHA = 0.) )

CHMAT=AFFE_MATERIAU(  MAILLAGE=MA,
                       AFFE=_F(  TOUT = 'OUI',
                              MATER = MAT) )

SYMETR1=AFFE_CHAR_MECA(MODELE=MO,
                       DDL_IMPO=(_F(GROUP_NO='LH',
                                   DY=0.0,),
                              _F(GROUP_NO='FACE1',
                                    DZ=0.0,),),
                       FACE_IMPO=_F(GROUP_MA=('FACE2',),
                                    DNOR=0.0,),
                                    );


PRESSION=AFFE_CHAR_MECA(    MODELE=MO,PRES_REP=(
        _F(  GROUP_MA = 'LEV_SUP', PRES = 1.E6),
        _F(  GROUP_MA = 'LEV_INF', PRES = 1.E6),
        _F(  GROUP_MA = 'SINT', PRES = 1.E6),)
                     )

                         
CHAMDEPL=MECA_STATIQUE(MODELE=MO,
                       CHAM_MATER=CHMAT,
                       EXCIT=(_F(CHARGE=PRESSION,),
                              _F(CHARGE=SYMETR1,),),);

# POST-TRAITEMENT
FISS=DEFI_FOND_FISS(    MAILLAGE=MA,
                          FOND_FISS=_F(  GROUP_MA = 'FOND', ),
                          LEVRE_SUP=_F(  GROUP_MA = 'LEV_SUP'),
                          LEVRE_INF=_F(  GROUP_MA = 'LEV_INF'),
                          DTAN_ORIG=(  0.,  1.,  0., ),
                          DTAN_EXTR=(  0.,  1., 0., )
                       )

FFX=DEFI_FISS_XFEM(MODELE=MO,
                   DEFI_FISS=_F(GROUP_MA_FISS='LEV_SUP',
                                GROUP_MA_FOND='FOND',),
                   ORIE_FOND=_F(PFON_INI=(1., -0.3, 0.),
                                VECT_ORIE=(0.0,1.0,0.0,),
                                POINT_ORIG=(0, 0., 0.,),),
                   INFO=1,);

RSUP=1.5e-3
RINF=4e-4

GLOC1=CALC_G(           RESULTAT=CHAMDEPL,
                        NUME_ORDRE = 1,
                        LISSAGE=_F(LISSAGE_THETA='LAGRANGE',
                          LISSAGE_G='LAGRANGE'),
                        THETA=_F(FOND_FISS=FISS,
                                 R_SUP=RSUP,
                                 R_INF=RINF,),
                    )
IMPR_TABLE(TABLE=GLOC1);
TEST_TABLE( TABLE=GLOC1,
            NOM_PARA='G',
            FILTRE=_F(  NOM_PARA = 'NOEUD',  
                            VALE_K = 'N565',      ),
            REFERENCE='NON_REGRESSION',
            VALE=  6.26620E+00,
            PRECISION=0.001      )

KGLOC1=CALC_G(           RESULTAT=CHAMDEPL,
                        NUME_ORDRE = 1,
                        OPTION='CALC_K_G',
                        LISSAGE=_F(LISSAGE_THETA='LAGRANGE',
                                   LISSAGE_G='LAGRANGE'),
                        THETA=_F(FISSURE=FFX,
                                 R_SUP=RSUP,
                                 R_INF=RINF,),
                    )
IMPR_TABLE(TABLE=KGLOC1);
TEST_TABLE( TABLE=KGLOC1,
            NOM_PARA='K1',
            FILTRE=_F(  NOM_PARA = 'NUM_PT',  
                            VALE_I = 1,      ),
            REFERENCE='NON_REGRESSION',
            VALE= 1.12448E+06,
            PRECISION=0.001      )

RSUP2=6e-3
RINF2=2e-3

GLOC2=CALC_G(           RESULTAT=CHAMDEPL,
                        NUME_ORDRE = 1,
                        LISSAGE=_F(LISSAGE_THETA='LAGRANGE',
                          LISSAGE_G='LAGRANGE'),
                        THETA=_F(FOND_FISS=FISS,
                                 R_SUP=RSUP2,
                                 R_INF=RINF2,),
                    )
IMPR_TABLE(TABLE=GLOC2);
TEST_TABLE( TABLE=GLOC2,
            NOM_PARA='G',
            FILTRE=_F(  NOM_PARA = 'NOEUD',  
                            VALE_K = 'N565',      ),
            REFERENCE='NON_REGRESSION',
            VALE=  6.26978E+00,
            PRECISION=0.001      )

KGLOC2=CALC_G(           RESULTAT=CHAMDEPL,
                        NUME_ORDRE = 1,
                        OPTION='CALC_K_G',
                        LISSAGE=_F(LISSAGE_THETA='LAGRANGE',
                                   LISSAGE_G='LAGRANGE'),
                        THETA=_F(FISSURE=FFX,
                                 R_SUP=RSUP2,
                                 R_INF=RINF2,),
                    )
IMPR_TABLE(TABLE=KGLOC2);
TEST_TABLE( TABLE=KGLOC2,
            NOM_PARA='K1',
            FILTRE=_F(  NOM_PARA = 'NUM_PT',  
                            VALE_I = 1,      ),
            REFERENCE='NON_REGRESSION',
            VALE= 1.07407E+06,
            PRECISION=0.001      )

# Calcul avec POST_K1_K2_K3 : la fissure est non-plane, 
# on ne peut pas calculer automatiquement pour tous les noeuds du fond de fissure

MA=DEFI_GROUP( reuse=MA,   MAILLAGE=MA,
                     CREA_GROUP_NO=
             (_F(INTERSEC = ('LEV_SUP', 'FACE1'),NOM='LSUP1'),
              _F(INTERSEC = ('LEV_INF', 'FACE1'),NOM='LINF1'),
              _F(OPTION='SEGM_DROI_ORDO', GROUP_NO='LSUP1',NOEUD_ORIG='N565',NOEUD_EXTR='N7879',
                  NOM='LSUP11',PRECISION=0.1,CRITERE='RELATIF'),
              _F(OPTION='SEGM_DROI_ORDO', GROUP_NO='LINF1',NOEUD_ORIG='N565',NOEUD_EXTR='N14802',
                  NOM='LINF11',PRECISION=0.1,CRITERE='RELATIF'),
              _F(INTERSEC = ('LEV_SUP', 'FACE2'),NOM='LSUP2'),
              _F(INTERSEC = ('LEV_INF', 'FACE2'),NOM='LINF2'),
              _F(OPTION='SEGM_DROI_ORDO', GROUP_NO='LSUP2',NOEUD_ORIG='N11220',NOEUD_EXTR='N12606',
                  NOM='LSUP22',PRECISION=0.1,CRITERE='RELATIF'),
              _F(OPTION='SEGM_DROI_ORDO', GROUP_NO='LINF2',NOEUD_ORIG='N11220',NOEUD_EXTR='N12951',
                  NOM='LINF22',PRECISION=0.1,CRITERE='RELATIF'),
              ),);
                 
TSUP1=POST_RELEVE_T(ACTION=_F(     GROUP_NO='LSUP11',
                                    INTITULE='depl sup',
                                    NOM_CHAM='DEPL',TOUT_CMP='OUI',
                                    RESULTAT=CHAMDEPL,
                                    OPERATION='EXTRACTION',) ,) ;
TINF1=POST_RELEVE_T(ACTION=_F(     GROUP_NO='LINF11',
                                    INTITULE='depl inf',
                                    NOM_CHAM='DEPL',TOUT_CMP='OUI',
                                    RESULTAT=CHAMDEPL,
                                    OPERATION='EXTRACTION',) ,) ;
TABL_KA=POST_K1_K2_K3(MODELISATION='3D',
                      MATER=MAT,
                      TABL_DEPL_SUP = TSUP1,
                      TABL_DEPL_INF = TINF1,
                      ABSC_CURV_MAXI = RSUP,
                      VECT_K1        = ( 1., 0., 0., ),
                      )

IMPR_TABLE(TABLE=TABL_KA)

TEST_TABLE(TABLE=TABL_KA,
           NOM_PARA='K1',
           REFERENCE='NON_REGRESSION',
           VALE=1.1539117200315E+06,
           PRECISION=0.001      )
                
TSUP2=POST_RELEVE_T(ACTION=_F(     GROUP_NO='LSUP22',
                                    INTITULE='depl sup',
                                    NOM_CHAM='DEPL',TOUT_CMP='OUI',
                                    RESULTAT=CHAMDEPL,
                                    OPERATION='EXTRACTION',) ,) ;
TINF2=POST_RELEVE_T(ACTION=_F(     GROUP_NO='LINF22',
                                    INTITULE='depl inf',
                                    NOM_CHAM='DEPL',TOUT_CMP='OUI',
                                    RESULTAT=CHAMDEPL,
                                    OPERATION='EXTRACTION',) ,) ;
K1x = cos(10.*3.14159/180.)                                    
K1z = sin(10.*3.14159/180.)
TABL_KB=POST_K1_K2_K3(  MODELISATION='3D',
              MATER=MAT,
              TABL_DEPL_SUP = TSUP2,
              TABL_DEPL_INF = TINF2,
              ABSC_CURV_MAXI = RSUP,
              VECT_K1        = ( K1x, 0., K1z, ),
           )
IMPR_TABLE(TABLE=TABL_KB)
TEST_TABLE( TABLE=TABL_KB,
            NOM_PARA='K1',
            REFERENCE='NON_REGRESSION',
            VALE= 1.0844343992327E+06,
            PRECISION=0.001      )

TABL_KA2=POST_K1_K2_K3(  MODELISATION='3D',
              MATER=MAT,
              TABL_DEPL_SUP = TSUP1,
              TABL_DEPL_INF = TINF1,
              ABSC_CURV_MAXI = RSUP2,
              VECT_K1        = ( 1., 0., 0., ),
           )
IMPR_TABLE(TABLE=TABL_KA2)
TEST_TABLE( TABLE=TABL_KA2,
            NOM_PARA='K1',
            REFERENCE='NON_REGRESSION',
            VALE=  1.1686361094376E+06,
            PRECISION=0.001      )
TABL_KB2=POST_K1_K2_K3(  MODELISATION='3D',
              MATER=MAT,
              TABL_DEPL_SUP = TSUP2,
              TABL_DEPL_INF = TINF2,
              ABSC_CURV_MAXI = RSUP2,
              VECT_K1        = ( K1x, 0., K1z, ),
           )
IMPR_TABLE(TABLE=TABL_KB2)
TEST_TABLE( TABLE=TABL_KB2,
            NOM_PARA='K1',
            REFERENCE='NON_REGRESSION',
            VALE=1.0982590529559E+06,
            PRECISION=0.001      )            

FIN()

