# MODIF  DATE 21/02/2011   AUTEUR ABBAS M.ABBAS 
# TITRE CALCUL DU CRITERE ENERGETIQUE GP EN 3D
# ssnp131b.para = tps_job 500 mem_job 700Mo ncpus 1 liste_test S
#            CONFIGURATION MANAGEMENT OF EDF VERSION
# ======================================================================
# COPYRIGHT (C) 1991 - 2011  EDF R&D                  WWW.CODE-ASTER.ORG
# THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY  
# IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY  
# THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR     
# (AT YOUR OPTION) ANY LATER VERSION.                                                    
#                                                                       
# THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT   
# WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF            
# MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU      
# GENERAL PUBLIC LICENSE FOR MORE DETAILS.                              
#                                                                       
# YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE     
# ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,         
#    1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.        
# ======================================================================

DEBUT(CODE=_F(NOM='SSNP131B',
              NIV_PUB_WEB='INTERNET',
              VISU_EFICAS='NON',),MEMOIRE=_F(DYNAMIQUE=400),);

# IDENTIFICATION DU GP CRITIQUE A RUPTURE (D'APRES TENACITES KJ CRIT. EXP.)
# A TEMPERATURE CONSTANTE (35 DEGRES) SUR UNE EPROUVETTE CT
#
#    * CARACTERISTIQUES MECANIQUES :
#
#       LE MODULE D'YOUNG EVOLUE  AVEC LA  TEMPERATURE
#       ALORS QUE LE COEFFICIENT DE POISSON EST CONSIDERE
#       CONSTANT.
#
#    * GOUPILLE MAILLEE AFIN DE MIEUX REPRESENTER L'APPLICATION 
#      DU CHARGEMENT (ICI FORCE IMPOSEE)
#
#    * CONDITIONS AUX LIMITES (1/2 DE L'EPROUVETTE MAILLE) :
#
#      - DEPLACEMENT BLOQUE SUIVANT DY SUR LE LIGAMENT
#      - DEPLACEMENT IMPOSE MONOTONE CROISSANT AU CENTRE DE LA GOUPILLE
#        (DONNEE EN NEWTON CAR N/MM2 = MPA)

MA=LIRE_MAILLAGE(FORMAT='MED',);
TPCAL = 35.0;


#----------------------------------------------------------------------
#----------------  AFFECTATION MODELE MECANIQUE    --------------------
#----------------------------------------------------------------------

MOD=AFFE_MODELE(MAILLAGE=MA,
                AFFE=_F(GROUP_MA=('VEPRO','VGOUP','FACBE',),
                        PHENOMENE='MECANIQUE',
                        MODELISATION='3D',),);

#----------------------------------------------------------------------
#---------------- DONNEES MECANIQUES ACIER  -------------------
#----------------------------------------------------------------------

E_T=DEFI_FONCTION(NOM_PARA='TEMP',VALE=(23.0,220200.0,
                        100.0,214100.0,
                        180.0,206500.0,
                        300.0,205000.0,
                        ),);

ALPHA_T=DEFI_FONCTION(NOM_PARA='TEMP',VALE=(0.000E+00,1.140E-05,
                            1.000E+01,1.150E-05,
                            2.000E+01,1.156E-05,
                            3.000E+01,1.160E-05,
                            4.000E+01,1.170E-05,
                            5.000E+01,1.180E-05,
                            6.000E+01,1.190E-05,
                            7.000E+01,1.190E-05,
                            8.000E+01,1.200E-05,
                            9.000E+01,1.210E-05,
                            1.000E+02,1.210E-05,
                            1.100E+02,1.220E-05,
                            1.200E+02,1.220E-05,
                            1.300E+02,1.230E-05,
                            1.400E+02,1.230E-05,
                            1.500E+02,1.240E-05,
                            1.600E+02,1.250E-05,
                            1.700E+02,1.250E-05,
                            1.800E+02,1.260E-05,
                            1.900E+02,1.260E-05,
                            2.000E+02,1.270E-05,
                            2.100E+02,1.270E-05,
                            2.200E+02,1.280E-05,
                            2.300E+02,1.280E-05,
                            2.400E+02,1.290E-05,
                            2.500E+02,1.290E-05,
                            ),PROL_DROITE='LINEAIRE',PROL_GAUCHE='LINEAIRE',);

NU_T=DEFI_CONSTANTE(NOM_RESU='TEMP',
                    VALE=0.3,);

#----------------------------------------------------------------------
# DEFINITION DE LA COURBE DE TRACTION 
#----------------------------------------------------------------------
#-- DEFINITION DE LA NAPPE (EPSI, SI, TEMP)
# ECROUISSAGE ISOTROPE NON LINEAIRE 

CT_23=DEFI_FONCTION(NOM_PARA='EPSI',VALE=(0.00434654,855.9222268,
                          0.006014974,910.4599555,
                          0.007862112,931.797171,
                          0.010757925,949.0551424,
                          0.014221395,961.578204,
                          0.017791783,971.9294353,
                          0.022185081,984.4905114,
                          0.028276427,1001.471414,
                          0.035811061,1019.316952,
                          0.04373072,1035.194221,
                          0.051452332,1048.650972,
                          0.058982804,1060.757,
                          0.066852716,1070.207138,
                          ),PROL_DROITE='CONSTANT',PROL_GAUCHE='LINEAIRE',);

CT_100=DEFI_FONCTION(NOM_PARA='EPSI',VALE=(0.003439678,740.6632663,
                           0.004628373,842.148772,
                           0.00607988,876.3117064,
                           0.007654628,895.2063119,
                           0.010417548,911.0718694,
                           0.014178015,925.022448,
                           0.017543214,935.2135771,
                           0.021942493,945.6948965,
                           0.027416704,960.732311,
                           0.033866984,975.8041996,
                           0.040205805,988.2450325,
                           0.046616375,1000.143035,
                           0.052903597,1010.004051,
                           0.058235889,1017.5664,
                           ),PROL_DROITE='CONSTANT',PROL_GAUCHE='LINEAIRE',);

CT_180=DEFI_FONCTION(NOM_PARA='EPSI',VALE=(0.003517805,757.4699504,
                           0.004684809,824.0113073,
                           0.006144782,860.2699635,
                           0.008034933,882.1596942,
                           0.01091719,897.2825266,
                           0.014242098,911.895256,
                           0.017244456,922.2778349,
                           0.020804086,931.4681604,
                           0.025396755,943.0898357,
                           0.030522415,954.7613776,
                           0.036394608,968.8987176,
                           0.043101634,980.6600888,
                           0.049733529,992.3982518,
                           0.057071966,1002.619204,
                           ),PROL_DROITE='CONSTANT',PROL_GAUCHE='LINEAIRE',);

CT_300=DEFI_FONCTION(NOM_PARA='EPSI',VALE=(0.003899686,752.4084432,
                           0.006058212,839.0678844,
                           0.007710795,866.9491608,
                           0.010249296,885.5196,
                           0.014199705,901.713589,
                           0.018138498,912.4207501,
                           0.023019995,928.0189803,
                           0.028623413,936.8352848,
                           0.034338623,948.5593249,
                           0.040005021,958.5707197,
                           0.045730249,965.278307,
                           0.051311744,970.2389532,
                           0.056285811,977.4996,
                           ),PROL_DROITE='CONSTANT',PROL_GAUCHE='LINEAIRE',);

SIG=DEFI_NAPPE(NOM_PARA='TEMP',
               PARA=(23.0,100.0,180.0,300.0,),
               FONCTION=(CT_23,CT_100,CT_180,CT_300,),
               PROL_DROITE='LINEAIRE',
               PROL_GAUCHE='LINEAIRE',);

ACIER=DEFI_MATERIAU(ELAS_FO=_F(E=E_T,
                               NU=NU_T,
                               TEMP_DEF_ALPHA=TPCAL,
                               ALPHA=ALPHA_T,),
                    TRACTION=_F(SIGM=SIG,),);

#----------------------------------------------------------------------
#---------------- DONNEES MECANIQUES GOUPILLE  -------------------
#----------------------------------------------------------------------
#-- GOUPILLE ELASTIQUE "RIGIDE"

MATGOUP=DEFI_MATERIAU(ELAS=_F(E=2.E6,
                              NU=0.3,
                              ALPHA=0.,),
                      ECRO_LINE=_F(D_SIGM_EPSI=200000.,
                                   SY=200000.,),);

#----------------------------------------------------------------------
#--------- TEMPERATURE IMPOSEE
#----------------------------------------------------------------------

T_T=DEFI_FONCTION(NOM_PARA='INST',VALE=(0.0,TPCAL,
                        50.0,TPCAL,
                        150.0,TPCAL,
                        ),PROL_GAUCHE='CONSTANT',);

TEMP_T=CREA_CHAMP(TYPE_CHAM='NOEU_TEMP_F',
                  OPERATION='AFFE',
                  MAILLAGE=MA,
                  AFFE=_F(TOUT='OUI',
                          NOM_CMP='TEMP',
                          VALE_F=T_T,),);

#----------------------------------------------------------------------
# DEFINITION D UNE RAMPE ET D UNE LISTE D INSTANTS 
# ----------------------------------------------------------------------

RAMPD=DEFI_FONCTION(NOM_PARA='INST',VALE=(0.0,0.0,
                          100.,0.25,
                          ),PROL_DROITE='LINEAIRE',PROL_GAUCHE='LINEAIRE',);

L_INST=DEFI_LIST_REEL(DEBUT=0.0,
                      INTERVALLE=_F(JUSQU_A=100.0,
                                    NOMBRE=50,),);

RESU_T=CREA_RESU(OPERATION='AFFE',
                 TYPE_RESU='EVOL_THER',
                 NOM_CHAM='TEMP',
                 AFFE=_F(CHAM_GD=TEMP_T,
                         LIST_INST=L_INST,),);

#----------------------------------------------------------------------
# AFFECTATION DES PROPRIETES MECANIQUES
# ----------------------------------------------------------------------

CHMAT=AFFE_MATERIAU(MAILLAGE=MA,
                    AFFE=(_F(GROUP_MA='VEPRO',
                             MATER=ACIER,),
                          _F(GROUP_MA='VGOUP',
                             MATER=MATGOUP,),),
                    AFFE_VARC=_F(TOUT='OUI',
                                 EVOL=RESU_T,
                                 NOM_VARC='TEMP',
                                 VALE_REF=TPCAL,),);

#----------------------------------------------------------------------
# CHARGEMENT ET CONDITIONS LIMITES
# ----------------------------------------------------------------------

COND_LIM=AFFE_CHAR_MECA(MODELE=MOD,
                        LIAISON_UNIF=_F(GROUP_MA='STOT_OPP',
                                        DDL='DZ',),);

COND_LI2=AFFE_CHAR_CINE(MODELE=MOD,
                        MECA_IMPO=(_F(GROUP_MA='FACBE',
                                     DY=0.0,),
                                  _F(GROUP_MA='LGOUP',
                                     DX=0.0,
                                     DZ=0.0,),
                                  _F(GROUP_MA='STOT',
                                     DZ=0.0,),),);

CHAD=AFFE_CHAR_CINE_F(MODELE=MOD,
                      MECA_IMPO=_F(GROUP_MA='LGOUP',
                                  DY=RAMPD,),);

#----------------------------------------------------------------------
#---------------  RESOLUTION   ------------------
#----------------------------------------------------------------------

RESV=STAT_NON_LINE(MODELE=MOD,
                   CHAM_MATER=CHMAT,
                   EXCIT=(_F(CHARGE=COND_LIM,),
                          _F(CHARGE=COND_LI2,),
                          _F(CHARGE=CHAD,),),
                   COMP_INCR=(_F(RELATION='VMIS_ISOT_TRAC',
                                 DEFORMATION='PETIT',
                                 GROUP_MA='VEPRO',),
                              _F(RELATION='VMIS_ISOT_LINE',
                                 DEFORMATION='PETIT',
                                 GROUP_MA='VGOUP',),),
                   INCREMENT=_F(LIST_INST=L_INST,
                                NUME_INST_INIT=4,
                                NUME_INST_FIN=5,),
                   NEWTON=_F(REAC_ITER=2,),
                   RECH_LINEAIRE=_F(ITER_LINE_MAXI=3,),
                   CONVERGENCE=_F(RESI_GLOB_RELA=1.E-8,
                                  ITER_GLOB_MAXI=50,),
                   SOLVEUR=_F(METHODE='MUMPS',
                              PCENT_PIVOT=30),);
                              
nbcop = 10;

# Script pour generer la liste des copeaux:
# =========================================

nbtranches = 2
l_copeaux1=[]
for i in range(1,nbcop+1):
  nom = "T1_C%i"%(i)
  l_copeaux1.append(nom)
print l_copeaux1


l_copeaux2=[]
for i in range(1,nbcop+1):
  nom = "T2_C%i"%(i)
  l_copeaux2.append(nom)
print l_copeaux2



# fin du script pour generer la liste
# ===================================

# conversion MPa.m^1/2 vers MPa.mm^1/2
conv = 31.6227766017;

kjc1 = (27.2 * conv);

kjc2 = (34.0 * conv);

kjc3 = (40.0 * conv);

# temperature de calcul
tcal = 35.0;

RESX = EXTR_RESU(RESULTAT=RESV,
                 ARCHIVAGE=_F(NUME_ORDRE=(
                 1,
                 ),),);

# definition du fond de fissure

FONFISS=DEFI_FOND_FISS(MAILLAGE=MA,
                       FOND_FISS=_F(GROUP_MA='FONDFISS',
                                    GROUP_NO_ORIG='PFON_0',),
                       NORMALE=(0.,-1.,0.,),);



tab=POST_GP(RESULTAT=RESX,
            RESU_THER=RESU_T,
            MODELE=MOD,
            MATER=ACIER,
            COMP_ELAS=_F(RELATION='ELAS_VMIS_TRAC',
                         DEFORMATION='PETIT',),
            EXCIT=(_F(CHARGE=COND_LIM,),
                   _F(CHARGE=COND_LI2,),
                   _F(CHARGE=CHAD,),),
            SYME_CHAR='SYME',
            DIRECTION = (1., 0., 0.),
            THETA_3D=(_F(GROUP_MA='FONDFISS',
                         R_INF=1,
                         R_SUP=2,),
                      _F(GROUP_MA='FONDFISS',
                         R_INF=2,
                         R_SUP=5,),
                      _F(GROUP_MA='FONDFISS',
                         R_INF=5,
                         R_SUP=10,),
                      _F(GROUP_MA='FONDFISS',
                         R_INF=10,
                         R_SUP=20,),
                         ),
            FOND_FISS=FONFISS,
            TRANCHE = (
                       _F(GROUP_MA=l_copeaux1,),
                       _F(GROUP_MA=l_copeaux2,),
                       ),
            PREDICTION=_F(GP_CRIT  =(0.673969,1.),
                              TEMP = (tcal,100),),
            TABL_GPMAX=CO('tabgpmax'),
            TABL_GP   =CO('tabgp'),
            LISSAGE=_F( LISSAGE_THETA='LEGENDRE',
                           DEGRE=1,),
            INFO=2,);
           
TEST_TABLE(TABLE=tabgpmax,
           FILTRE=(_F(NOM_PARA='NUME_TRANCHE',
                      VALE_I=1,),
                   _F(NOM_PARA='INST',
                      VALE=10.0,
                      PRECISION=1e-6,),
                   ),
           NOM_PARA='PREDICTION',
           VALE_I=0,
           PRECISION=1.E-10,
           REFERENCE='AUTRE_ASTER',);

TEST_TABLE(TABLE=tabgpmax,
           FILTRE=(_F(NOM_PARA='NUME_TRANCHE',
                     VALE_I=1,),
                   _F(NOM_PARA='INST',
                      VALE=10.,
                      PRECISION=1e-6,),  ),
           NOM_PARA='GPMAX',
           VALE=0.307405,
           CRITERE='RELATIF',
           PRECISION=0.0001,
           REFERENCE='AUTRE_ASTER',);


#tab=POST_GP(RESULTAT=RESU,
#            RESU_THER=RESU_T,
#            MODELE=MOD,
#            MATER=ACIER,
#            COMP_ELAS=_F(RELATION='ELAS_VMIS_TRAC',
#                         DEFORMATION='PETIT',),
#            EXCIT=(_F(CHARGE=COND_LIM,),
#                   _F(CHARGE=COND_LI2,),
#                   _F(CHARGE=CHAD,),),
#            SYME_CHAR='SYME',
#            DIRECTION = (1., 0., 0.),
#            THETA_3D=(_F(GROUP_MA='FONDFISS',
#                         R_INF=1,
#                         R_SUP=2,),
#                      _F(GROUP_MA='FONDFISS',
#                         R_INF=2,
#                         R_SUP=5,),
#                      _F(GROUP_MA='FONDFISS',
#                         R_INF=5,
#                         R_SUP=10,),
#                      _F(GROUP_MA='FONDFISS',
#                         R_INF=10,
#                         R_SUP=20,),
#                         ),
#            FOND_FISS=FONFISS,
#            TRANCHE = (
#                       _F(GROUP_MA=l_copeaux1,),
#                       _F(GROUP_MA=l_copeaux2,),
#                       ),
#            IDENTIFICATION=_F(KJ_CRIT=(kjc1),
#                              TEMP = (tcal),),
#            TABL_GPMAX=CO('tabident'),
##            TABL_GP     = CO('tabgp'),
#            LISSAGE=_F( LISSAGE_THETA='LEGENDRE',
#                           DEGRE=1,),
#            INFO=2,);##

#IMPR_TABLE(TABLE=tab,);

#IMPR_TABLE(TABLE=tabident,);

# IMPR_TABLE(TABLE=tabgp,);

#TEST_TABLE(TABLE=tabident,
#           FILTRE=_F(NOM_PARA='KJ_CRIT',
#                     VALE=kjc1,),
#          NOM_PARA='GPMAX',
#           VALE=0.30740456474220,
#           CRITERE='RELATIF',
#           PRECISION=0.0001,
#           REFERENCE='AUTRE_ASTER',);
#           
#TEST_TABLE(TABLE=tabident,
#           FILTRE=_F(NOM_PARA='KJ_CRIT',
#                     VALE=kjc1,),
#           NOM_PARA='KGPMAX',
#           VALE=272.147,
#           CRITERE='RELATIF',
#           PRECISION=0.0001,
#           REFERENCE='AUTRE_ASTER',);#

                              
FIN();

#

