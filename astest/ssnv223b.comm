# MODIF  DATE 11/06/2012   AUTEUR DELMAS J.DELMAS 
# TITRE VALIDATION DE LA LOI ENDO_SCALAIRE ET DU PILOTAGE PRED_ELAS POUR LA MODELISATION 3D_GRAD_VARI 
# ssnv223b.para = tps_job 70 mem_job 32Mo ncpus 1 liste_test R
#            CONFIGURATION MANAGEMENT OF EDF VERSION
# ======================================================================
# COPYRIGHT (C) 1991 - 2012  EDF R&D                  WWW.CODE-ASTER.ORG
# THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY  
# IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY  
# THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR     
# (AT YOUR OPTION) ANY LATER VERSION.                                                    
#                                                                       
# THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT   
# WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF            
# MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU      
# GENERAL PUBLIC LICENSE FOR MORE DETAILS.                              
#                                                                       
# YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE     
# ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,         
#    1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.        
# ======================================================================

DEBUT(CODE=_F(NOM='SSNV223B',NIV_PUB_WEB='INTERNET',VISU_EFICAS='NON'),
      PAR_LOT = 'OUI')

E       = 30000.
NU      = 0.2
ft      = 3.
Gf      = 0.1
D       = 50.
p       = 5.
fc      = 15.
tau     = 4.


wy   = 0.5*ft**2/E
k    = 0.75*Gf/D
m    = k/wy
C    = 0.375*Gf*D
pena = 1.E3 * k
comp = (fc-ft)*tau*(1+NU)*3**0.5/(2*ft*fc*(1-2*NU))
coef = (fc+ft)*tau*(1+NU)*3**0.5/(2*ft*fc*(1+NU))
volu = (coef**2-1)*2*(1+NU)/(1-2*NU)


# solution analytique pour a = 0.6
# --------------------------------

cS = E/2./( (1-2*NU)*comp + (1+NU)*(volu/2*(1-2*NU)/(1+NU)+1)**0.5 )**2
cT = comp * cS**0.5
cH = volu * cS * 0.5*(1+NU)/(1-2*NU)

a    = 0.6
Da   = m*(a-1)*(a+1+2*p*a)/( (1-a)**2 + m*a*(1+p*a) )**2
Geps = -k/Da
eps  = Geps**0.5 / (cT+(cH+cS)**0.5)


# Orientation en biais de la sollicitation

nx =  1/14**0.5
ny =  2/14**0.5
nz =  3/14**0.5


# -----------------------------------------------------
#                 MAILLAGE ET MODELE
# -----------------------------------------------------

MA  =  LIRE_MAILLAGE(FORMAT = 'MED')

MO = AFFE_MODELE(
  MAILLAGE = MA,
  AFFE     = _F(
    GROUP_MA     = 'MATIERE',
    PHENOMENE    = 'MECANIQUE',
    MODELISATION = '3D_GRAD_VARI'
    ),
  )


# -----------------------------------------------------
#                     MATERIAU
# -----------------------------------------------------

BETON = DEFI_MATERIAU(
  ELAS          = _F(E=E, NU=NU),
  ENDO_SCALAIRE = _F(K=k,M=m,P=p,C_VOLU=volu,C_COMP=comp),
  NON_LOCAL     = _F(C_GRAD_VARI = C, PENA_LAGR = pena),
  )

CHMAT = AFFE_MATERIAU(
  MAILLAGE = MA,
  AFFE = _F(
    GROUP_MA = 'MATIERE',
    MATER    =  BETON
    ),
  )


# -----------------------------------------------------
#                CHARGEMENT ET INSTANTS
# -----------------------------------------------------

dx = {}
dy = {}
dz = {}
for i in [0,1,2]:
  for j in [0,1,2]:
    for k in [0,1,2]:
      dx[i*100+j*10+k] = eps*(nx*i+ny*j+nz*k)*nx
      dy[i*100+j*10+k] = eps*(nx*i+ny*j+nz*k)*ny
      dz[i*100+j*10+k] = eps*(nx*i+ny*j+nz*k)*nz

      
TRACTION = AFFE_CHAR_MECA(
  MODELE = MO,
  DDL_IMPO = (
    _F(GROUP_NO='000',DX=dx[  0],DY=dy[  0],DZ=dz[  0]),
    _F(GROUP_NO='100',DX=dx[100],DY=dy[100],DZ=dz[100]),
    _F(GROUP_NO='200',DX=dx[200],DY=dy[200],DZ=dz[200]),
    _F(GROUP_NO='210',DX=dx[210],DY=dy[210],DZ=dz[210]),
    _F(GROUP_NO='220',DX=dx[220],DY=dy[220],DZ=dz[220]),
    _F(GROUP_NO='120',DX=dx[120],DY=dy[120],DZ=dz[120]),
    _F(GROUP_NO='020',DX=dx[ 20],DY=dy[ 20],DZ=dz[ 20]),
    _F(GROUP_NO='010',DX=dx[ 10],DY=dy[ 10],DZ=dz[ 10]),
    _F(GROUP_NO='001',DX=dx[  1],DY=dy[  1],DZ=dz[  1]),
    _F(GROUP_NO='201',DX=dx[201],DY=dy[201],DZ=dz[201]),
    _F(GROUP_NO='221',DX=dx[221],DY=dy[221],DZ=dz[221]),
    _F(GROUP_NO='021',DX=dx[ 21],DY=dy[ 21],DZ=dz[ 21]),
    _F(GROUP_NO='002',DX=dx[  2],DY=dy[  2],DZ=dz[  2]),
    _F(GROUP_NO='102',DX=dx[102],DY=dy[102],DZ=dz[102]),
    _F(GROUP_NO='202',DX=dx[202],DY=dy[202],DZ=dz[202]),
    _F(GROUP_NO='212',DX=dx[212],DY=dy[212],DZ=dz[212]),
    _F(GROUP_NO='222',DX=dx[222],DY=dy[222],DZ=dz[222]),
    _F(GROUP_NO='122',DX=dx[122],DY=dy[122],DZ=dz[122]),
    _F(GROUP_NO='022',DX=dx[ 22],DY=dy[ 22],DZ=dz[ 22]),
    _F(GROUP_NO='012',DX=dx[ 12],DY=dy[ 12],DZ=dz[ 12]),
    ),
  )


INSTANTS = DEFI_LIST_REEL(  
  DEBUT = 0,                
  INTERVALLE = (            
    _F(JUSQU_A = 100, NOMBRE = 100)
    )                       
  )                         
                            

EVOL = STAT_NON_LINE(
  MODELE     = MO,
  CHAM_MATER = CHMAT,
  EXCIT      = _F(CHARGE = TRACTION, TYPE_CHARGE = 'FIXE_PILO'),
  PILOTAGE   = _F(
    TYPE           = 'DEFORMATION',
    SELECTION      = 'MIXTE',
    COEF_MULT      =  1E4,
    ETA_PILO_R_MIN =   0,
    ETA_PILO_R_MAX =  10,
    ETA_PILO_MAX   =   1,
    PROJ_BORNES    = 'OUI',
    ),
  COMP_INCR = _F(RELATION  = 'ENDO_SCALAIRE'),
  INCREMENT = _F(LIST_INST = INSTANTS),
  NEWTON    = _F(MATRICE='TANGENTE', REAC_ITER = 1),
  CONVERGENCE = _F(
    SIGM_REFE      = ft,
    VARI_REFE      = 1.,
    LAGR_REFE      = k,
    RESI_REFE_RELA = 1.E-5,
    ITER_GLOB_MAXI = 15,
    ),
  SOLVEUR   = _F(
    METHODE     = 'MUMPS',
    PCENT_PIVOT = 200,
    ),
  ) 

tfin_pilo = 9.

# -----------------------------------------------------
#    EXTRAPOLATION DES VARIABLES INTERNES AUX NOEUDS
# -----------------------------------------------------

EVOL=CALC_CHAMP(reuse =EVOL,
                RESULTAT=EVOL,
                CONTRAINTE=('SIGM_ELGA','SIGM_ELNO','SIEF_ELNO'),
                VARI_INTERNE=('VARI_ELNO','VARI_NOEU',),);

# -----------------------------------------------------
#     EXTRACTION SUR LA FACE DROITE DU QUADGRANGLE
# -----------------------------------------------------

RESU = POST_RELEVE_T(
  ACTION = _F(
    INTITULE  = 'RESULTAT',
    OPERATION = 'EXTRACTION',
    RESULTAT  =  EVOL,
    NOM_CHAM  = 'VARI_NOEU',
    NOM_CMP   = 'V1',
    GROUP_NO  = ('200','210','220'),
    ),
  )

IMPR_TABLE(TABLE=RESU)

# -----------------------------------------------------
#      COMPARAISON AVEC LES VALEURS DE REFERENCE
# -----------------------------------------------------


TEST_TABLE(REFERENCE = 'ANALYTIQUE',
  VALE      = a,
  PRECISION = 1.E-3,
  TABLE     = RESU,
  NOM_PARA  = 'V1',
  FILTRE    = (
    _F(NOM_PARA='INST',  VALE=tfin_pilo),
    _F(NOM_PARA='COOR_Y',VALE=0),
    ),
  )

TEST_TABLE(REFERENCE = 'ANALYTIQUE',
  VALE      = a,
  PRECISION = 1.E-3,
  TABLE     = RESU,
  NOM_PARA  = 'V1',
  FILTRE    = (
    _F(NOM_PARA='INST',  VALE=tfin_pilo),
    _F(NOM_PARA='COOR_Y',VALE=1),
    ),
  )

TEST_TABLE(REFERENCE = 'ANALYTIQUE',
  VALE      = a,
  PRECISION = 1.E-3,
  TABLE     = RESU,
  NOM_PARA  = 'V1',
  FILTRE    = (
    _F(NOM_PARA='INST',  VALE=tfin_pilo),
    _F(NOM_PARA='COOR_Y',VALE=2),
    ),
  )

#ENGENDRE_TEST(CO=EVOL,);

TEST_RESU(RESU=( 
          _F( RESULTAT= EVOL    , NOM_CHAM= 'SIGM_ELGA', NUME_ORDRE=      0,
              REFERENCE= 'NON_REGRESSION', PRECISION= 1.E-10    ,
              CRITERE= 'ABSOLU', 
              TYPE_TEST= 'SOMM_ABS', VALE=  0.0000000000000E+00 ),
          _F( RESULTAT= EVOL    , NOM_CHAM= 'SIGM_ELGA', NUME_ORDRE=      1,
              REFERENCE= 'NON_REGRESSION', PRECISION= 1.E-10    ,
              TYPE_TEST= 'SOMM_ABS', VALE=  1.5419368272223E+01 ),
          _F( RESULTAT= EVOL    , NOM_CHAM= 'SIGM_ELGA', NUME_ORDRE=      2,
              REFERENCE= 'NON_REGRESSION', PRECISION= 1.E-10    ,
              TYPE_TEST= 'SOMM_ABS', VALE=  1.1393943470434E+01 ),
          _F( RESULTAT= EVOL    , NOM_CHAM= 'SIGM_ELGA', NUME_ORDRE=      3,
              REFERENCE= 'NON_REGRESSION', PRECISION= 1.E-10    ,
              TYPE_TEST= 'SOMM_ABS', VALE=  8.9813856706624E+00 ),
          _F( RESULTAT= EVOL    , NOM_CHAM= 'SIGM_ELGA', NUME_ORDRE=      4,
              REFERENCE= 'NON_REGRESSION', PRECISION= 1.E-10    ,
              TYPE_TEST= 'SOMM_ABS', VALE=  7.3266300946653E+00 ),
          _F( RESULTAT= EVOL    , NOM_CHAM= 'SIGM_ELGA', NUME_ORDRE=      5,
              REFERENCE= 'NON_REGRESSION', PRECISION= 1.E-10    ,
              TYPE_TEST= 'SOMM_ABS', VALE=  6.1083714351057E+00 ),
          _F( RESULTAT= EVOL    , NOM_CHAM= 'SIGM_ELGA', NUME_ORDRE=      6,
              REFERENCE= 'NON_REGRESSION', PRECISION= 1.E-10    ,
              TYPE_TEST= 'SOMM_ABS', VALE=  5.1725609464235E+00 ),
          _F( RESULTAT= EVOL    , NOM_CHAM= 'SIGM_ELGA', NUME_ORDRE=      7,
              REFERENCE= 'NON_REGRESSION', PRECISION= 1.E-10    ,
              TYPE_TEST= 'SOMM_ABS', VALE=  4.4296538039287E+00 ),
          _F( RESULTAT= EVOL    , NOM_CHAM= 'SIGM_ELGA', NUME_ORDRE=      8,
              REFERENCE= 'NON_REGRESSION', PRECISION= 1.E-10    ,
              TYPE_TEST= 'SOMM_ABS', VALE=  3.8283496672754E+00 ),
          _F( RESULTAT= EVOL    , NOM_CHAM= 'SIGM_ELGA', NUME_ORDRE=      9,
              REFERENCE= 'NON_REGRESSION', PRECISION= 1.E-10    ,
              TYPE_TEST= 'SOMM_ABS', VALE=  3.5168444268497E+00 ),
          _F( RESULTAT= EVOL    , NOM_CHAM= 'SIEF_ELNO', NUME_ORDRE=      0,
              REFERENCE= 'NON_REGRESSION', PRECISION= 1.E-10    ,
              CRITERE= 'ABSOLU', 
              TYPE_TEST= 'SOMM_ABS', VALE=  0.0000000000000E+00 ),
          _F( RESULTAT= EVOL    , NOM_CHAM= 'SIEF_ELNO', NUME_ORDRE=      1,
              REFERENCE= 'NON_REGRESSION', PRECISION= 1.E-10    ,
              TYPE_TEST= 'SOMM_ABS', VALE=  3.8548420688927E+01 ),
          _F( RESULTAT= EVOL    , NOM_CHAM= 'SIEF_ELNO', NUME_ORDRE=      2,
              REFERENCE= 'NON_REGRESSION', PRECISION= 1.E-10    ,
              TYPE_TEST= 'SOMM_ABS', VALE=  2.8484860189487E+01 ),
          _F( RESULTAT= EVOL    , NOM_CHAM= 'SIEF_ELNO', NUME_ORDRE=      3,
              REFERENCE= 'NON_REGRESSION', PRECISION= 1.E-10    ,
              TYPE_TEST= 'SOMM_ABS', VALE=  2.2453464272648E+01 ),
          _F( RESULTAT= EVOL    , NOM_CHAM= 'SIEF_ELNO', NUME_ORDRE=      4,
              REFERENCE= 'NON_REGRESSION', PRECISION= 1.E-10    ,
              TYPE_TEST= 'SOMM_ABS', VALE=  1.8316575251748E+01 ),
          _F( RESULTAT= EVOL    , NOM_CHAM= 'SIEF_ELNO', NUME_ORDRE=      5,
              REFERENCE= 'NON_REGRESSION', PRECISION= 1.E-10    ,
              TYPE_TEST= 'SOMM_ABS', VALE=  1.5270928591486E+01 ),
          _F( RESULTAT= EVOL    , NOM_CHAM= 'SIEF_ELNO', NUME_ORDRE=      6,
              REFERENCE= 'NON_REGRESSION', PRECISION= 1.E-10    ,
              TYPE_TEST= 'SOMM_ABS', VALE=  1.2931413005897E+01 ),
          _F( RESULTAT= EVOL    , NOM_CHAM= 'SIEF_ELNO', NUME_ORDRE=      7,
              REFERENCE= 'NON_REGRESSION', PRECISION= 1.E-10    ,
              TYPE_TEST= 'SOMM_ABS', VALE=  1.1074141224227E+01 ),
          _F( RESULTAT= EVOL    , NOM_CHAM= 'SIEF_ELNO', NUME_ORDRE=      8,
              REFERENCE= 'NON_REGRESSION', PRECISION= 1.E-10    ,
              TYPE_TEST= 'SOMM_ABS', VALE=  9.5708786903730E+00 ),
          _F( RESULTAT= EVOL    , NOM_CHAM= 'SIEF_ELNO', NUME_ORDRE=      9,
              REFERENCE= 'NON_REGRESSION', PRECISION= 1.E-10    ,
              TYPE_TEST= 'SOMM_ABS', VALE=  8.7923032904545E+00 ),
          _F( RESULTAT= EVOL    , NOM_CHAM= 'SIGM_ELNO', NUME_ORDRE=      0,
              REFERENCE= 'NON_REGRESSION', PRECISION= 1.E-10    ,
              CRITERE= 'ABSOLU', 
              TYPE_TEST= 'SOMM_ABS', VALE=  0.0000000000000E+00 ),
          _F( RESULTAT= EVOL    , NOM_CHAM= 'SIGM_ELNO', NUME_ORDRE=      1,
              REFERENCE= 'NON_REGRESSION', PRECISION= 1.E-10    ,
              TYPE_TEST= 'SOMM_ABS', VALE=  3.8548420680557E+01 ),
          _F( RESULTAT= EVOL    , NOM_CHAM= 'SIGM_ELNO', NUME_ORDRE=      2,
              REFERENCE= 'NON_REGRESSION', PRECISION= 1.E-10    ,
              TYPE_TEST= 'SOMM_ABS', VALE=  2.8484858676085E+01 ),
          _F( RESULTAT= EVOL    , NOM_CHAM= 'SIGM_ELNO', NUME_ORDRE=      3,
              REFERENCE= 'NON_REGRESSION', PRECISION= 1.E-10    ,
              TYPE_TEST= 'SOMM_ABS', VALE=  2.2453464176656E+01 ),
          _F( RESULTAT= EVOL    , NOM_CHAM= 'SIGM_ELNO', NUME_ORDRE=      4,
              REFERENCE= 'NON_REGRESSION', PRECISION= 1.E-10    ,
              TYPE_TEST= 'SOMM_ABS', VALE=  1.8316575236663E+01 ),
          _F( RESULTAT= EVOL    , NOM_CHAM= 'SIGM_ELNO', NUME_ORDRE=      5,
              REFERENCE= 'NON_REGRESSION', PRECISION= 1.E-10    ,
              TYPE_TEST= 'SOMM_ABS', VALE=  1.5270928587764E+01 ),
          _F( RESULTAT= EVOL    , NOM_CHAM= 'SIGM_ELNO', NUME_ORDRE=      6,
              REFERENCE= 'NON_REGRESSION', PRECISION= 1.E-10    ,
              TYPE_TEST= 'SOMM_ABS', VALE=  1.2931402366059E+01 ),
          _F( RESULTAT= EVOL    , NOM_CHAM= 'SIGM_ELNO', NUME_ORDRE=      7,
              REFERENCE= 'NON_REGRESSION', PRECISION= 1.E-10    ,
              TYPE_TEST= 'SOMM_ABS', VALE=  1.1074134509822E+01 ),
          _F( RESULTAT= EVOL    , NOM_CHAM= 'SIGM_ELNO', NUME_ORDRE=      8,
              REFERENCE= 'NON_REGRESSION', PRECISION= 1.E-10    ,
              TYPE_TEST= 'SOMM_ABS', VALE=  9.5708741681885E+00 ),
          _F( RESULTAT= EVOL    , NOM_CHAM= 'SIGM_ELNO', NUME_ORDRE=      9,
              REFERENCE= 'NON_REGRESSION', PRECISION= 1.E-10    ,
              TYPE_TEST= 'SOMM_ABS', VALE=  8.7921110671244E+00 ),
          ),)

FIN()
