# MODIF  DATE 09/11/2010   AUTEUR TORKHANI M.TORKHANI 
# RESPONSABLE TORKHANI M.TORKHANI
# TITRE DIAGRAMME DE CAMPBELL D'UNE LIGNE D'ARBRE SIMPLIFIEE
# sdll124a.para = tps_job 300 mem_job 128Mo ncpus 1 liste_test S
#            CONFIGURATION MANAGEMENT OF EDF VERSION
# ======================================================================
# COPYRIGHT (C) 1991 - 2009  EDF R&D                  WWW.CODE-ASTER.ORG
# THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY  
# IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY  
# THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR     
# (AT YOUR OPTION) ANY LATER VERSION.                                                    
#                                                                       
# THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT   
# WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF            
# MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU      
# GENERAL PUBLIC LICENSE FOR MORE DETAILS.                              
#                                                                       
# YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE     
# ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,         
#    1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.        
# ======================================================================
# CAS_TEST__:SDLL124A
#
import numpy as NP

DEBUT(CODE=_F(NOM='SDLL124A', NIV_PUB_WEB='INTERNET',VISU_EFICAS='NON'),
      DEBUG=_F(SDVERI='OUI'),);

mail=LIRE_MAILLAGE();

# ---------------------
# DEFINITION DU MATERIAU
# ---------------------
acier=DEFI_MATERIAU(ELAS=_F(E=2.e11,
                            NU=0.3,
                            RHO=7800,),);

# ---------------------
# AFFECTATION DU MODELE
# ---------------------
modele=AFFE_MODELE(MAILLAGE=mail,
                   AFFE=(_F(GROUP_MA='ROTOR',
                            PHENOMENE='MECANIQUE',
                            MODELISATION='POU_D_T',),
                         _F(GROUP_MA=('DISQ1','DISQ2','DISQ3','PALIER1','PALIER2'),
                            PHENOMENE='MECANIQUE',
                            MODELISATION='DIS_TR',),),);

# -----------------------
# AFFECTATION DU MATERIAU
# -----------------------
chmat=AFFE_MATERIAU(MAILLAGE=mail,
                    AFFE=_F(GROUP_MA='ROTOR',
                            MATER=acier,),);

# --------------------------------
# DEF DES SECTIONS et des RAIDEURS
# --------------------------------
cara=AFFE_CARA_ELEM(MODELE=modele,
                    POUTRE=_F(GROUP_MA='ROTOR',
                              SECTION='CERCLE',
                              CARA='R',
                              VALE=0.05,),
                    DISCRET=(_F(CARA='M_TR_D_N',
                                GROUP_MA='DISQ1',
                                VALE=(1.458013e+01,1.232021e-01, 
                                6.463858e-02,6.463858e-02,0,0,0,0,0,0,),),
                             _F(CARA='M_TR_D_N',
                                GROUP_MA='DISQ2',
                                VALE=(4.594579e+01,9.763481e-01, 
                                4.977461e-01,4.977461e-01,0,0,0,0,0,0,),),
                             _F(CARA='M_TR_D_N',
                                GROUP_MA='DISQ3',
                                VALE=(5.513495e+01,1.171618e+00, 
                                6.023493e-01,6.023493e-01,0,0,0,0,0,0,),),
                             _F(GROUP_MA='PALIER1',
                                   CARA='K_TR_D_N',
                                   VALE=(0.,5.000000E+07,7.000000E+07,0.,0.,0. ) ),
                             _F(GROUP_MA='PALIER1',
                                   CARA='A_TR_D_N',
                                   VALE=(0.,5.000000E+02,7.000000E+02,0.,0.,0.,),),
                             _F(GROUP_MA='PALIER2',
                                   CARA='K_TR_D_N',
                                   VALE=(0.,5.000000E+07,7.000000E+07,0.,0.,0. ) ),
                             _F(GROUP_MA='PALIER2',
                                   CARA='A_TR_D_N',
                                   VALE=(0.,5.000000E+02,7.000000E+02,0.,0.,0.,),),
                           )
                        );

# ------------------
# CONDITIONS AUX LIMITES
# ------------------
blocage=AFFE_CHAR_MECA(MODELE=modele,
                        DDL_IMPO=(_F(GROUP_NO=('PALIER1',),
                                     DX=0,
                                     ),))
                                    
# --------------------------------
#MATRICES ASSEMBLEES K, M
# --------------------------------
MACRO_MATR_ASSE(MODELE=modele,
                CHAM_MATER=chmat,
                CARA_ELEM=cara,
                          CHARGE=blocage,
                NUME_DDL=CO('NUMEDDL'),
                MATR_ASSE=(_F(MATRICE=CO('RIGIDITE'),
                              OPTION='RIGI_MECA',),
                           _F(MATRICE=CO('MASSE'),
                              OPTION='MASS_MECA',),
                           _F(MATRICE=CO('AMOR'),
                              OPTION='AMOR_MECA',),),);
                              
              

GYELEM=CALC_MATR_ELEM(OPTION='MECA_GYRO',
                      MODELE=modele,
                      CHAM_MATER=chmat,
                      CARA_ELEM=cara,);

GYASS=ASSE_MATRICE(MATR_ELEM=GYELEM,
                   NUME_DDL=NUMEDDL,);

DEBV=0.0;
FINV=30000;
PASV = 10000.0;
VIT=NP.arange(DEBV,FINV+1,PASV);
nbF=14;
nbF_camp=10;
nbV=len(VIT);

# --------------------------------------------------------------
# APPEL MACRO DE CALCUL DES FREQUENCES ET DES MODES EN ROTATION
# --------------------------------------------------------------

L_VITROT=[VIT[ii]*pi/30. for ii in range(nbV)];
Methode = 'QZ'
#Methode = 'SORENSEN'

l_mod=CALC_MODE_ROTATION(MATR_A =RIGIDITE,
                 MATR_B   =MASSE, 
                 MATR_AMOR=AMOR, 
                 MATR_GYRO =GYASS, 
                 VITE_ROTA =L_VITROT,
                 METHODE  =Methode,
                 CALC_FREQ=_F(OPTION='PLUS_PETITE',NMAX_FREQ=nbF),
                 VERI_MODE=_F(STOP_ERREUR='NON'));

IMPR_TABLE(TABLE=l_mod);

lmod=[None]*nbV
for ii in range(0,nbV):
   lmod[ii]=EXTR_TABLE(TYPE_RESU='MODE_MECA',
                       TABLE=l_mod,
                       NOM_PARA='NOM_SD',
                       FILTRE=_F(NOM_PARA='NUME_VITE',VALE_I=ii),);
   IMPR_RESU(FORMAT='RESULTAT',
             RESU=_F(RESULTAT=lmod[ii],
                     NOM_PARA=('NUME_MODE','FREQ','OMEGA2'),
                     FORM_TABL='OUI'),)

#VITESSE DE ROTATION OMEGA=0
TEST_RESU(RESU=(
          _F( RESULTAT = lmod[0], PARA = 'FREQ',
                CRITERE = 'RELATIF', PRECISION = 1.E-3,
                NUME_ORDRE = 1,  VALE = 6.06148E+01, REFERENCE='AUTRE_ASTER',),
          _F( RESULTAT = lmod[0], PARA = 'AMOR_REDUIT',
                CRITERE = 'RELATIF', PRECISION = 1.E-3,
                NUME_ORDRE = 1,  VALE = 5.0328E-04, REFERENCE='AUTRE_ASTER',),
          _F( RESULTAT = lmod[0], PARA = 'FREQ',
                CRITERE = 'RELATIF', PRECISION = 1.E-3,
                NUME_ORDRE = 2,  VALE = 6.3026E+01, REFERENCE='AUTRE_ASTER',),
          _F( RESULTAT = lmod[0], PARA = 'AMOR_REDUIT',
                CRITERE = 'RELATIF', PRECISION = 1.E-3,
                NUME_ORDRE = 2,  VALE = 3.9882E-04, REFERENCE='AUTRE_ASTER',),
          _F( RESULTAT = lmod[0], PARA = 'FREQ',
                CRITERE = 'RELATIF', PRECISION = 1.E-3,
                NUME_ORDRE = 3,  VALE = 1.6949E+02, REFERENCE='AUTRE_ASTER',),
          _F( RESULTAT = lmod[0], PARA = 'AMOR_REDUIT',
                CRITERE = 'RELATIF', PRECISION = 1.E-3,
                NUME_ORDRE = 3,  VALE = 3.1232E-03, REFERENCE='AUTRE_ASTER',),
          _F( RESULTAT = lmod[0], PARA = 'FREQ',
                CRITERE = 'RELATIF', PRECISION = 1.E-3,
                NUME_ORDRE = 4,  VALE = 1.85563E+02, REFERENCE='AUTRE_ASTER',),
          _F( RESULTAT = lmod[0], PARA = 'AMOR_REDUIT',
                CRITERE = 'RELATIF', PRECISION = 1.E-3,
                NUME_ORDRE = 4,  VALE = 2.8533E-03, REFERENCE='AUTRE_ASTER',),
            ),)

#VITESSE DE ROTATION OMEGA=30000
TEST_RESU(RESU=(
          _F( RESULTAT = lmod[3], PARA = 'FREQ',
                CRITERE = 'RELATIF', PRECISION = 1.E-3,
                NUME_ORDRE = 1,  VALE = 5.4112E+01, REFERENCE='AUTRE_ASTER',),
          _F( RESULTAT = lmod[3], PARA = 'AMOR_REDUIT',
                CRITERE = 'RELATIF', PRECISION = 1.3E-2,
                NUME_ORDRE = 1,  VALE = 2.6624E-04, REFERENCE='AUTRE_ASTER',),
          _F( RESULTAT = lmod[3], PARA = 'FREQ',
                CRITERE = 'RELATIF', PRECISION = 1.E-3,
                NUME_ORDRE = 2,  VALE = 6.8122E+01, REFERENCE='AUTRE_ASTER',),
          _F( RESULTAT = lmod[3], PARA = 'AMOR_REDUIT',
                CRITERE = 'RELATIF', PRECISION = 6.E-3,
                NUME_ORDRE = 2,  VALE = 6.5256E-04, REFERENCE='AUTRE_ASTER',),
          _F( RESULTAT = lmod[3], PARA = 'FREQ',
                CRITERE = 'RELATIF', PRECISION = 3.E-3,
                NUME_ORDRE = 3,  VALE = 1.5465E+02, REFERENCE='AUTRE_ASTER',),
          _F( RESULTAT = lmod[3], PARA = 'AMOR_REDUIT',
                CRITERE = 'RELATIF', PRECISION = 1.7E-2,
                NUME_ORDRE = 3,  VALE = 3.0442E-03, REFERENCE='AUTRE_ASTER',),
          _F( RESULTAT = lmod[3], PARA = 'FREQ',
                CRITERE = 'RELATIF', PRECISION = 2.E-3,
                NUME_ORDRE = 4,  VALE = 1.9600E+02, REFERENCE='AUTRE_ASTER',),
          _F( RESULTAT = lmod[3], PARA = 'AMOR_REDUIT',
                CRITERE = 'RELATIF', PRECISION = 1.8E-2,
                NUME_ORDRE = 4,  VALE = 2.7612E-03, REFERENCE='AUTRE_ASTER',),
            ),)

#TYPE DE PRECESSION (1 SOMME, 2 PLUS GRANDE ORBITE)
typ_prec =1
#TYPE DE SUIVI, (0 SANS_TRI, 1 TRI_PREC, 2 TRI_FORM_MOD)
typ_tri=2

# UNITES DES FICHIERS DE SORTIE DES TRACES
unit_fle = 29;
unit_tor = 28; 
uniy_lon = 27;
unit_tot = 26;
unit_int = 25;
nomfic   = 'intersec.txt'

L_S=[1.];
# ----------------------------------------------------------
# APPEL MACRO PERMETTANT DE TRACER LE DIAGRAMME DE CAMPBELL
# ----------------------------------------------------------
IMPR_DIAG_CAMPBELL(MAILLAGE   =mail, 
                 MODES      =l_mod,
                 NFREQ_CAMP =nbF_camp,
                 TYP_PREC   =typ_prec, 
                 TYP_TRI    =typ_tri,
                 UNIT_FLE   = unit_fle,
                 UNIT_TOR   = unit_tor, 
                 UNIT_LON   = uniy_lon, 
                 UNIT_TOT   = unit_tot,
                 UNIT_INT   = unit_int,
                 L_S        = L_S);

FIN();

