# MODIF  DATE 17/05/2004   AUTEUR CIBHHBC M.LOPES 
# TITRE VALIDATION DE L'OPERATEUR POST_RCCM KE_MIXTE FATIGUE B3200
#            CONFIGURATION MANAGEMENT OF EDF VERSION
# ======================================================================
# COPYRIGHT (C) 1991 - 2003  EDF R&D                  WWW.CODE-ASTER.ORG
# THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY  
# IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY  
# THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR     
# (AT YOUR OPTION) ANY LATER VERSION.                                                    
#                                                                       
# THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT   
# WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF            
# MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU      
# GENERAL PUBLIC LICENSE FOR MORE DETAILS.                              
#                                                                       
# YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE     
# ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,         
#    1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.        
# ======================================================================
# RESPONSABLE JMBHH01 J.M.PROIX

DEBUT( CODE=_F(  NOM = 'RCCM01B',NIV_PUB_WEB='INTERNET') )

MA=LIRE_MAILLAGE( )

MA=DEFI_GROUP(reuse=MA,  MAILLAGE=MA,
                  CREA_GROUP_NO=_F(  TOUT_GROUP_MA = 'OUI')  )

MO=AFFE_MODELE(  MAILLAGE=MA,
                  AFFE=_F(  TOUT = 'OUI',   PHENOMENE = 'MECANIQUE',
                         MODELISATION = 'C_PLAN')  )


COURFATA = FORMULE(REEL="""(REEL:SIGM) = 2.E6/SIGM """)

L_INST=DEFI_LIST_REEL(  DEBUT=1.,
                           INTERVALLE=_F(  JUSQU_A = 1000., PAS = 1.) )
                           
WOHLER2=CALC_FONC_INTERP( FONCTION=COURFATA, LIST_PARA=L_INST,INFO=2,
                          NOM_PARA = 'SIGM',PROL_DROITE='LINEAIRE',
                              PROL_GAUCHE='CONSTANT',
                               NOM_RESU='NADM'       )
                               
MAT=DEFI_MATERIAU(  ELAS=_F( E = 200000.,  NU = 0.3,  ALPHA = 1.0E-5),
                     FATIGUE=_F(  WOHLER = WOHLER2, E_REFE = 200000.),
                        RCCM=_F(  M_KE = 1.7,
                               N_KE = 0.3,
                               SM = 50.)
                               )


CHMAT=AFFE_MATERIAU(  MAILLAGE=MA, 
                        AFFE=_F( TOUT = 'OUI', MATER = MAT)  )

# DEPLACEMENT IMPOSE DY = A1*X+A2

A1=0.0E-3

A2=1.0E-3

DY1=( -1.0 * A1 ) + A2

DY2=( +1.0 * A1 ) + A2

DYCD=DEFI_FONCTION(   NOM_PARA='X',
                      VALE=( -1.0, DY1,  1.0, DY2, )  )

NUL=DEFI_CONSTANTE(    VALE=0. )

CHMEC=AFFE_CHAR_MECA_F(  MODELE=MO,
                         DDL_IMPO=( _F( GROUP_NO = 'CD', DY = DYCD),
                                    _F( GROUP_NO = 'AB', DY = NUL ),
                                    _F( GROUP_NO = 'A' , DX = NUL )) )

LINST=DEFI_LIST_REEL(   DEBUT=0.,
                        INTERVALLE=_F(  JUSQU_A = 3.,  PAS = 1.)  )

FCTMUL=DEFI_FONCTION(  NOM_PARA='INST',
                       VALE=( 0.0,  0.0,   1.0,  1.0,
                              2.0,  1.0,   3.0,  0.0,  )   )
#----------------------------------------------------------------------
# TEMPERATURE IMPOSEE T = T1*X+T2

T1=50.0

T2=0.0

T = FORMULE(REEL="""(REEL:X) =  T1*X+T2 """)

CHT0=CREA_CHAMP( OPERATION='AFFE', TYPE_CHAM='NOEU_TEMP_R', MAILLAGE=MA,
                      AFFE=_F(  TOUT = 'OUI', NOM_CMP = 'TEMP', VALE = 0.0) )

CHT1=CREA_CHAMP( OPERATION='AFFE', TYPE_CHAM='NOEU_TEMP_F', MAILLAGE=MA,
                      AFFE=_F(  TOUT = 'OUI', NOM_CMP = 'TEMP', VALE_F = T) )

TEMP=CREA_RESU(  OPERATION='AFFE', TYPE_RESU='EVOL_THER',    NOM_CHAM='TEMP',
                 AFFE=( _F(  INST = 0.,  CHAM_GD = CHT0),
                        _F(  INST = 1.,  CHAM_GD = CHT0),
                        _F(  INST = 2.,  CHAM_GD = CHT1),
                        _F(  INST = 3.,  CHAM_GD = CHT1))  )

CHTHER=AFFE_CHAR_MECA(  MODELE=MO,     TEMP_CALCULEE=TEMP )

#----------------------------------------------------------------------
# CHARGEMENTS MECANIQUE + THERMIQUE


RESU2=MECA_STATIQUE(  MODELE=MO,      CHAM_MATER=CHMAT,
                      LIST_INST=LINST,
                      EXCIT=( _F(  CHARGE = CHTHER),
                              _F(  CHARGE = CHMEC, FONC_MULT = FCTMUL)),
                       )
                   

RESU2=CALC_ELEM(reuse=RESU2,RESULTAT=RESU2,
                 MODELE=MO,      CHAM_MATER=CHMAT,
                 LIST_INST=LINST,
  EXCIT=( _F(  CHARGE = CHTHER),
          _F(  CHARGE = CHMEC, FONC_MULT = FCTMUL)),
               OPTION= 'SIGM_ELNO_DEPL')
  
  
  
TEST_RESU(RESU=( 
     _F(  RESULTAT = RESU2,    NOM_CHAM = 'SIGM_ELNO_DEPL',   NUME_ORDRE = 3,
       REFERENCE = 'ANALYTIQUE',
       MAILLE = 'M1',    NOEUD = 'N1',    NOM_CMP = 'SIYY',    VALE = 300.),
     _F(  RESULTAT = RESU2,    NOM_CHAM = 'SIGM_ELNO_DEPL',   NUME_ORDRE = 4,
       REFERENCE = 'ANALYTIQUE',
       MAILLE = 'M1',    NOEUD = 'N1',    NOM_CMP = 'SIYY',    VALE = 100.))
            )


#--------------------------------------------------------------------------------
#   option = FATIGUE_ZH210
#   chargement mecanique + thermique
#--------------------------------------------------------------------------------




LIGNE=INTE_MAIL_2D(  MAILLAGE=MA,
                     DEFI_SEGMENT=_F(  ORIGINE   = ( -1.0,  0.5, ),
                                       EXTREMITE = (  1.0,  0.5, )),
                     INFO=2    )


FAT5=POST_RCCM( TYPE_RESU_MECA = 'EVOLUTION',  
                       MATER = MAT,  
                    MAILLAGE = MA,
                   TYPE_RESU = 'DETAILS',
                      OPTION = 'FATIGUE_ZH210',
                       TITRE = 'FATIGUE_ZH210, RESULTAT: RESU2+RESUTH',
                     SEGMENT =_F(  CHEMIN = LIGNE,
                                   INTITULE = 'FATIGUE_ZH: RESU2'),
                 TRANSITOIRE =(_F(  RESULTAT = RESU2,
                                   NOM_CHAM = 'SIGM_ELNO_DEPL',
                                   INST = (0.,  2.,),NB_OCCUR = 200,),
                                   ),
                 )


IMPR_TABLE( TABLE  =  FAT5,
            FILTRE = _F(NOM_PARA = 'LIEU', VALE_K='ORIG',),
            TRI    = _F(NOM_PARA = 'DOMMAGE',
                        ORDRE    = 'CROISSANT',),
 )
#
IMPR_TABLE( TABLE  =  FAT5,
            FILTRE = _F(NOM_PARA = 'LIEU', VALE_K='EXTR',),
            TRI    = _F(NOM_PARA = 'DOMMAGE',
                        ORDRE    = 'CROISSANT',),
 )
                                 
TABLE=POST_RELEVE_T(ACTION=_F(INTITULE='TH1',
                                 CHEMIN=LIGNE,
                                 RESULTAT=RESU2,TOUT_CMP='OUI',
                                 NOM_CHAM='SIGM_ELNO_DEPL',
                                 OPERATION='EXTRACTION',),);

IMPR_TABLE(TABLE=TABLE,FORMAT='ASTER');
                                 

                                 
# RELECTURE DE LA TABLE AUGMENTEE DE SIXZ ET SIYZ, MECA+THER
TINS3_MX = LIRE_TABLE (UNITE=38, FORMAT='ASTER',SEPARATEUR=' ',TYPE_TABLE='TABL_POST_RELE',
                            TITRE='TINS3_FX',NUME_TABLE=3,)                           
TINS3_MY= LIRE_TABLE (UNITE=38, FORMAT='ASTER',SEPARATEUR=' ',TYPE_TABLE='TABL_POST_RELE',
                            TITRE='TINS3_FX',NUME_TABLE=3,)                           
TINS3_MZ = LIRE_TABLE (UNITE=38, FORMAT='ASTER',SEPARATEUR=' ',TYPE_TABLE='TABL_POST_RELE',
                            TITRE='TINS3_FX',NUME_TABLE=3,)                           
TINS3_PR = LIRE_TABLE (UNITE=38, FORMAT='ASTER',SEPARATEUR=' ',TYPE_TABLE='TABL_POST_RELE',
                            TITRE='TINS3_FX',NUME_TABLE=3,)                           
TINS3_T2 = LIRE_TABLE (UNITE=38, FORMAT='ASTER',SEPARATEUR=' ',TYPE_TABLE='TABL_POST_RELE',
                            TITRE='TINS3_FX',NUME_TABLE=3,)                           



TRCCM_2=POST_RCCM( TYPE_RESU_MECA = 'UNITAIRE',
                   TYPE_RESU='DETAILS',
                   OPTION='FATIGUE',
                   MATER=MAT,
                   INFO=2,
# les situations
          SITUATION=(
                  _F(NB_OCCUR=200,
                     NUME_SITU=1,
                     NOM_SITU='Essai',
                     NUME_GROUPE=1,
                     PRES_A=0.0,
                     PRES_B=0,
                     TEMP_REF_A=10.0,
                     TEMP_REF_B=287.0,
                     CHAR_ETAT_A=2,
                     CHAR_ETAT_B=1,),
                   ),
          CHAR_MECA=(
                  _F(NUME_CHAR=1,
                     NOM_CHAR='ETAT 1 SITUATION 1',
                     FX=0, FY=0,  FZ=0,  MX=0.,  MY=0.,    MZ=0.,  ),
                  _F(NUME_CHAR=2,
                     NOM_CHAR='ETAT 2 SITUATION 1',
                     FX=0, FY=0,  FZ=0,  MX=1.,  MY=0,    MZ=0,  ),
                        ),
# resultats thermiques 
          RESU_THER=(
                  _F(NUME_RESU_THER=1,
                     TABL_RESU_THER=TINS3_T2, ),
                     ),
# les profils de contraintes issus des calculs mecaniques unitaires
          RESU_MECA_UNIT=(
                  _F(
                     TABL_MX=TINS3_MX,
                     TABL_MY=TINS3_MY,
                     TABL_MZ=TINS3_MZ,
                     TABL_PRES=TINS3_PR,
                     ),
                        ),
                   );


IMPR_TABLE(TABLE=TRCCM_2,);


                                 
# RELECTURE DE LA TABLE AUGMENTEE DE SIXZ ET SIYZ, MECA+THER
TINS2_MX = LIRE_TABLE (UNITE=38, FORMAT='ASTER',SEPARATEUR=' ',TYPE_TABLE='TABL_POST_RELE',
                            TITRE='TINS2_FX',NUME_TABLE=2,)                           
TINS2_MY= LIRE_TABLE (UNITE=38, FORMAT='ASTER',SEPARATEUR=' ',TYPE_TABLE='TABL_POST_RELE',
                            TITRE='TINS2_FX',NUME_TABLE=2,)                           
TINS2_MZ = LIRE_TABLE (UNITE=38, FORMAT='ASTER',SEPARATEUR=' ',TYPE_TABLE='TABL_POST_RELE',
                            TITRE='TINS2_FX',NUME_TABLE=2,)                           
TINS2_PR = LIRE_TABLE (UNITE=38, FORMAT='ASTER',SEPARATEUR=' ',TYPE_TABLE='TABL_POST_RELE',
                            TITRE='TINS2_FX',NUME_TABLE=2,)                           
TINS2_T2 = LIRE_TABLE (UNITE=38, FORMAT='ASTER',SEPARATEUR=' ',TYPE_TABLE='TABL_POST_RELE',
                            TITRE='TINS2_FX',NUME_TABLE=2,)                           

TINS4_MX = LIRE_TABLE (UNITE=38, FORMAT='ASTER',SEPARATEUR=' ',TYPE_TABLE='TABL_POST_RELE',
                            TITRE='TINS4_FX',NUME_TABLE=4,)                           
TINS4_MY= LIRE_TABLE (UNITE=38, FORMAT='ASTER',SEPARATEUR=' ',TYPE_TABLE='TABL_POST_RELE',
                            TITRE='TINS4_FX',NUME_TABLE=4,)                           
TINS4_MZ = LIRE_TABLE (UNITE=38, FORMAT='ASTER',SEPARATEUR=' ',TYPE_TABLE='TABL_POST_RELE',
                            TITRE='TINS4_FX',NUME_TABLE=4,)                           
TINS4_PR = LIRE_TABLE (UNITE=38, FORMAT='ASTER',SEPARATEUR=' ',TYPE_TABLE='TABL_POST_RELE',
                            TITRE='TINS4_FX',NUME_TABLE=4,)                           
TINS4_T2 = LIRE_TABLE (UNITE=38, FORMAT='ASTER',SEPARATEUR=' ',TYPE_TABLE='TABL_POST_RELE',
                            TITRE='TINS4_FX',NUME_TABLE=4,)                           



TRCCM_13=POST_RCCM( TYPE_RESU='DETAILS',
                    TYPE_RESU_MECA='UNITAIRE',
                    OPTION='FATIGUE',
                    MATER=MAT,
                    INFO=2,
# les situations
          SITUATION=(
                  _F(NB_OCCUR=200,
                     NUME_SITU=1,
                     NOM_SITU='Essai',
                     NUME_GROUPE=1,
                     NUME_RESU_THER=1,
                     PRES_A=0.0,
                     PRES_B=0,
                     TEMP_REF_A=10.0,
                     TEMP_REF_B=287.0,
                     CHAR_ETAT_A=2,
                     CHAR_ETAT_B=1,),
                   ),
          CHAR_MECA=(
                  _F(NUME_CHAR=1,
                     NOM_CHAR='ETAT 1 SITUATION 1',
                     FX=0, FY=0,  FZ=0,  MX=0.,  MY=0.,    MZ=0.,  ),
                  _F(NUME_CHAR=2,
                     NOM_CHAR='ETAT 2 SITUATION 1',
                     FX=0, FY=0,  FZ=0,  MX=1.,  MY=0,    MZ=0,  ),
                        ),
# resultats thermiques 
          RESU_THER=(
                  _F(NUME_RESU_THER=1,
                     TABL_RESU_THER=TINS4_T2, ),
                     ),
# les profils de contraintes issus des calculs mecaniques unitaires
          RESU_MECA_UNIT=(
                  _F(
                     TABL_MX=TINS2_MX,
                     TABL_MY=TINS2_MY,
                     TABL_MZ=TINS2_MZ,
                     TABL_PRES=TINS2_PR,
                     ),
                        ),
                   );


IMPR_TABLE(TABLE=TRCCM_13,);



TBRCCMKM=POST_RCCM( TYPE_RESU='DETAILS',
                    TYPE_RESU_MECA='UNITAIRE',
                    OPTION='FATIGUE',
                    MATER=MAT,
                    TYPE_KE='KE_MIXTE',
                    INFO=2,

# les situations
          SITUATION=(
                  _F(NB_OCCUR=200,
                     NUME_RESU_THER=1,
                     NUME_SITU=1,
                     NOM_SITU='Essai',
                     NUME_GROUPE=1,
                     PRES_A=0.0,
                     PRES_B=0,
                     TEMP_REF_A=10.0,
                     TEMP_REF_B=287.0,
                     CHAR_ETAT_A=2,
                     CHAR_ETAT_B=1,),

                   ),

          CHAR_MECA=(
                  _F(NUME_CHAR=1,
                     NOM_CHAR='ETAT 1 SITUATION 1',
                     FX=0, FY=0,  FZ=0,  MX=0.,  MY=0.,    MZ=0.,  ),
                  _F(NUME_CHAR=2,
                     NOM_CHAR='ETAT 2 SITUATION 1',
                     FX=0, FY=0,  FZ=0,  MX=1.,  MY=0,    MZ=0,  ),
                        ),

# resultats thermiques 
          RESU_THER=(
                  _F(NUME_RESU_THER=1,
                     TABL_RESU_THER=TINS4_T2, ),
                     ),

# les profils de contraintes issus des calculs mecaniques unitaires
          RESU_MECA_UNIT=(
                  _F(
                     TABL_MX=TINS2_MX,
                     TABL_MY=TINS2_MY,
                     TABL_MZ=TINS2_MZ,
                     TABL_PRES=TINS2_PR,
                     ),
                        ),

                   );


IMPR_TABLE(TABLE=TBRCCMKM,);


FIN( )
#
