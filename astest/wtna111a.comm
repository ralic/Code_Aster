# MODIF  DATE 15/06/2010   AUTEUR GRANET S.GRANET 
# TITRE   TEST HM, AXIS , MODELISATION THMC=LIQU_SATU
# wtna111a.para = tps_job 100 mem_job 128Mo ncpus 1 liste_test S
#            CONFIGURATION MANAGEMENT OF EDF VERSION
# ======================================================================
# COPYRIGHT (C) 1991 - 2010  EDF R&D                  WWW.CODE-ASTER.ORG
# THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY  
# IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY  
# THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR     
# (AT YOUR OPTION) ANY LATER VERSION.                                                    
#                                                                       
# THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT   
# WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF            
# MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU      
# GENERAL PUBLIC LICENSE FOR MORE DETAILS.                              
#                                                                       
# YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE     
# ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,         
#    1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.        
# ======================================================================

DEBUT(CODE=_F( NOM = 'WTNA111A',NIV_PUB_WEB='INTERNET'))

tint=1000.
tfin=3000.

nbpas1=25
nbpas2=25

pini=0.
pfin=1.E6


sigxx=12.3E6-pini

kni=1.E9
ouvm=5.E-3
ouvini = 1.95E-5


VISCOL=DEFI_CONSTANTE(VALE=1.E-3,);

RHOL=DEFI_CONSTANTE(VALE=1.E03,);

DVISCOL=DEFI_CONSTANTE(VALE=0.0,);

DVISCOG=DEFI_CONSTANTE(VALE=0.0,);

PERML=DEFI_CONSTANTE(VALE=1.688E-17,);

UN=DEFI_CONSTANTE(    VALE=1.,);

####################################
#  LISTE DES INSTANTS DE CALCUL
####################################

LISTINST=DEFI_LIST_REEL(DEBUT = 0.,
                        INTERVALLE=(_F(JUSQU_A = tint,
                                      NOMBRE = nbpas1,),
                                   _F(JUSQU_A = tfin,
                                      NOMBRE = nbpas2,),),);


####################################
#   OPERATIONS SUR LE MAILLAGE
#
####################################

MA0=LIRE_MAILLAGE(FORMAT='ASTER',
                 VERI_MAIL=_F(APLAT=1.E-9,
                              VERIF='OUI'),);

MA=CREA_MAILLAGE(MAILLAGE = MA0, LINE_QUAD = _F(TOUT='OUI'));

MA=DEFI_GROUP(reuse = MA,
       MAILLAGE = MA,
       CREA_GROUP_MA = (
          _F(NOM = 'BOUCHON', GROUP_MA = 'G_2D_14'),
          _F(NOM = 'ROCHE', GROUP_MA = 'G_2D_15'),
          _F(NOM = 'FISSURE', GROUP_MA = 'G_2D_16'),
          _F(NOM = 'BAS_2', GROUP_MA = 'G_1D_17'),
          _F(NOM = 'HAUT_2', GROUP_MA = 'G_1D_18'),
          _F(NOM = 'BAS_3', GROUP_MA = 'G_1D_23'),
          _F(NOM = 'HAUT_3', GROUP_MA = 'G_1D_24'),
          _F(NOM = 'BAS_1', GROUP_MA = 'G_1D_21'),
          _F(NOM = 'HAUT_1', GROUP_MA = 'G_1D_22'),
          _F(NOM = 'HAUT',    UNION = ('HAUT_1','HAUT_2','HAUT_3'),),
          _F(NOM = 'BAS',    UNION = ('BAS_1','BAS_2','BAS_3')),
          _F(NOM = 'DROITE', GROUP_MA='G_1D_20'),
          _F(NOM = 'GAUCHE' , GROUP_MA='G_1D_19'),
       ),);



MA=MODI_MAILLAGE(reuse =MA,
                 MAILLAGE=MA,
                 ORIE_PEAU_2D=_F(GROUP_MA=('HAUT','BAS','DROITE','GAUCHE'),),
                 );

MA=MODI_MAILLAGE(reuse =MA,
                 MAILLAGE=MA,
                 ORIE_FISSURE=_F(GROUP_MA='FISSURE'),
                 );

MO=AFFE_MODELE(MAILLAGE=MA,
                    AFFE=(_F(GROUP_MA=('BOUCHON','ROCHE','GAUCHE','DROITE','BAS_1',
                            'BAS_3','HAUT_1','HAUT_3',),
                            PHENOMENE='MECANIQUE',
                            MODELISATION='AXIS_HMS',),
                         _F(GROUP_MA=('FISSURE','BAS_2','HAUT_2'),
                            PHENOMENE='MECANIQUE',
                            MODELISATION='AXIS_JOINT_HMS',),));

####################################
#   ORIENTATION FISSURE
#
####################################

ORIEN_FI=AFFE_CARA_ELEM(MODELE=MO,
                        MASSIF=_F(GROUP_MA='FISSURE',
                                  ANGL_EULER=(180,0,0,),),);

####################################
#   DEFINITION DU MATERIAU
#
####################################

MAT_M=DEFI_MATERIAU(ELAS=_F(E=200000000.0,
                          NU=0.25,
                          ALPHA=0.0,),
                       COMP_THM='LIQU_SATU',
                       THM_INIT=_F(PRE1=0.0,
                                   PORO=0.4055,),
                       THM_DIFFU=_F(RHO=1600.0,
                                    BIOT_COEF=0.9,
                                    PESA_X=0.0,
                                    PESA_Y=00.0,
                                    PESA_Z=00.0,
                                    PERM_IN=PERML,),
                       THM_LIQU=_F(RHO=1000.0,
                                   UN_SUR_K=1/3.E9,
                                   VISC=VISCOL,
                                   D_VISC_TEMP=DVISCOL,),
                         );

MAT_J=DEFI_MATERIAU(JOINT_BANDIS=_F(K=kni, 
                                     DMAX=ouvm,
                                     GAMMA=2.,),
                       COMP_THM='LIQU_SATU',
                       THM_INIT=_F(PRE1=0.0,
                                   PORO=0.4055,),
                       THM_DIFFU=_F(RHO=1600.0,
                                    BIOT_COEF=0.9,
                                    PESA_X=0.0,
                                    PESA_Y=00.0,
                                    PESA_Z=00.0,
                                    PERM_IN=PERML,),
                       THM_LIQU=_F(RHO=1000.0,
                                   UN_SUR_K=1/3.E9,
                                   VISC=VISCOL,
                                   D_VISC_TEMP=DVISCOL,),
                         );

CM=AFFE_MATERIAU(MAILLAGE=MA,
                 AFFE=(_F(TOUT='OUI',
                         MATER=MAT_M,),
                       _F(GROUP_MA='FISSURE',
                          MATER=MAT_J,),),);

####################################
#   DEFINITION DES CHARGEMENTS
#
####################################

LIAISON=AFFE_CHAR_MECA(
  MODELE=MO,
  DDL_IMPO= (
    _F(GROUP_MA='GAUCHE',DX=0,),
    _F(GROUP_MA='HAUT',DY=0),
    ),
  );

FLUH=AFFE_CHAR_MECA(MODELE=MO,
                      FLUX_THM_REP=_F(GROUP_MA=('GAUCHE','DROITE','HAUT'),
                                         FLUN_HYDR1=0.,),);

PWELL=AFFE_CHAR_MECA_F(MODELE=MO,
                          DDL_IMPO=(_F(GROUP_MA=('BAS',),
                                      PRE1=UN,),
                                   ),);

COMP=AFFE_CHAR_MECA(
   MODELE=MO,
   PRES_REP=(
      _F(GROUP_MA=('DROITE'),PRES=12.3E6),  
     ),
   );

# DEFINITION DE L'EVOLUTION DU CHARGEMENT

FCT_MON = DEFI_FONCTION(
  NOM_PARA = 'INST',
  VALE     = (0,pfin , tfin, pfin ),
  INTERPOL   ='LIN'
                );

####################################
#   INITIALISATION DES CHAMPS
#
####################################

CHAMNO=CREA_CHAMP(MAILLAGE=MA,
                    OPERATION='AFFE', 
                    TYPE_CHAM='NOEU_DEPL_R',
                    AFFE=(
                           _F(TOUT='OUI',
                             NOM_CMP='PRE1',
                             VALE=pini,),
                             ),);

SIGINIT=CREA_CHAMP(TYPE_CHAM='CART_SIEF_R',
                   OPERATION='AFFE',
                   MAILLAGE=MA,
                   AFFE=(_F(GROUP_MA=('BOUCHON','ROCHE'),
                           NOM_CMP=('SIXX','SIYY','SIZZ','SIXY','SIXZ','SIYZ','SIP','M11','FH11X','FH11Y',),
                           VALE=(-sigxx,0.,-sigxx,0.0,0.0,0.0,-pini,0.,0.,0.,),),
                         _F(GROUP_MA='FISSURE',
                           NOM_CMP=('SIGN','SITX','SIP','M11','FH11X','LH1P','LH1M','DPRE1P','DPRE1M'),
                           VALE=(-sigxx,0.0,-pini,ouvini*1000.,0.,0.,0.,0.,0.),),),);

CH_X=CREA_CHAMP( OPERATION='AFFE', TYPE_CHAM='CART_NEUT_R',
                   MODELE=MO,
                   AFFE=(
           _F( GROUP_MA = ('BOUCHON','ROCHE'),   NOM_CMP = ('X1','X2',  'X3'),
                                     VALE = ( 0 , 0, 0)),
           _F( GROUP_MA = 'FISSURE',   NOM_CMP = ('X1',     'X2',  'X3',),
                                     VALE = ( ouvini**2/12, 0., ouvini)),
                    ))

CH_VARI=CREA_CHAMP( OPERATION='ASSE', TYPE_CHAM='ELGA_VARI_R',
                   MODELE=MO,
                   ASSE=(
           _F( CHAM_GD = CH_X, 
               GROUP_MA = ('BOUCHON','ROCHE'), NOM_CMP = ('X1',  'X2',  'X3'),NOM_CMP_RESU  = ('V1',  'V2',  'V3')),
           _F( CHAM_GD = CH_X, 
               GROUP_MA = 'FISSURE',    
               NOM_CMP      = ('X1',  'X2',  'X3',),
               NOM_CMP_RESU = ('V1',  'V2',  'V3',),),
                   ))

DEFLIST =DEFI_LIST_INST(DEFI_LIST=_F(LIST_INST =LISTINST ),
                        ECHEC=_F(
                  SUBD_METHODE='UNIFORME',
                  SUBD_PAS  = 5,
                  SUBD_PAS_MINI = 1.E-10,
                  SUBD_NIVEAU=12,
                                 ),);

####################################
#   STAT_NON_LINE
#
####################################

U_1=STAT_NON_LINE( 
  MODELE     = MO,
  CHAM_MATER = CM,
  CARA_ELEM  = ORIEN_FI,
  EXCIT      = (
                 _F(CHARGE = LIAISON),
                 _F(CHARGE = COMP),
                 _F(CHARGE = FLUH),
                 _F(CHARGE = PWELL, 
                    FONC_MULT = FCT_MON),
               ),
  ETAT_INIT=_F(DEPL=CHAMNO,SIGM=SIGINIT,VARI=CH_VARI),
#  ETAT_INIT=_F(DEPL=CHAMNO,VARI=CH_VARI),
  COMP_INCR=(_F(RELATION='KIT_HM',
               RELATION_KIT=('ELAS','LIQU_SATU','HYDR_UTIL',),
               GROUP_MA=('BOUCHON','ROCHE'),),
            _F(RELATION='KIT_HM',
               RELATION_KIT=('JOINT_BANDIS','LIQU_SATU','HYDR_UTIL',),
               GROUP_MA='FISSURE',),
                ),
  INCREMENT=_F(LIST_INST=DEFLIST,
               INST_FIN=tfin,),
  NEWTON=_F(MATRICE='TANGENTE',
                          REAC_ITER=1,),
  CONVERGENCE=_F(ITER_GLOB_MAXI=10,),  
  SOLVEUR = _F(METHODE = 'MUMPS', PCENT_PIVOT=100,NPREC=-1),
  );

####################################
#   TESTS DE VALIDATION
#
#################################### 

# TEST PRE1 NS749 ET NS761 A 1000 SEC ET 3000 SEC 

TEST_RESU(RESU=_F(RESULTAT=U_1,
                  NUME_ORDRE=25,  
                  NOM_CHAM='DEPL',
                  NOM_CMP='PRE1',
                  NOEUD='NS749',
                  VALE=9.48E+05,
                  REFERENCE='NON_REGRESSION',),);

TEST_RESU(RESU=_F(RESULTAT=U_1,
                  NUME_ORDRE=50,  
                  NOM_CHAM='DEPL',
                  NOM_CMP='PRE1',
                  NOEUD='NS749',
                  VALE=9.68E+05,
                  REFERENCE='NON_REGRESSION',),);

TEST_RESU(RESU=_F(RESULTAT=U_1,
                  NUME_ORDRE=25,  
                  NOM_CHAM='DEPL',
                  NOM_CMP='PRE1',
                  NOEUD='NS761',
                  VALE=8.22E+05,
                  REFERENCE='NON_REGRESSION',),);

TEST_RESU(RESU=_F(RESULTAT=U_1,
                  NUME_ORDRE=50,  
                  NOM_CHAM='DEPL',
                  NOM_CMP='PRE1',
                  NOEUD='NS761',
                  VALE=8.89E+05,
                  REFERENCE='NON_REGRESSION',),); 
 
# TEST DX N25 ET N66 A 1000 SEC ET 3000 SEC 

TEST_RESU(RESU=_F(RESULTAT=U_1,
                  NUME_ORDRE=25,  
                  NOM_CHAM='DEPL',
                  NOM_CMP='DX',
                  NOEUD='N25',
                  VALE=2.925058E-04,
                  REFERENCE='NON_REGRESSION',),);

TEST_RESU(RESU=_F(RESULTAT=U_1,
                  NUME_ORDRE=50,  
                  NOM_CHAM='DEPL',
                  NOM_CMP='DX',
                  NOEUD='N25',
                  VALE=4.786191E-04,
                  REFERENCE='NON_REGRESSION',),);

TEST_RESU(RESU=_F(RESULTAT=U_1,
                  NUME_ORDRE=25,  
                  NOM_CHAM='DEPL',
                  NOM_CMP='DX',
                  NOEUD='N66',
                  VALE=2.925197E-04,
                  REFERENCE='NON_REGRESSION',),);

TEST_RESU(RESU=_F(RESULTAT=U_1,
                  NUME_ORDRE=50,  
                  NOM_CHAM='DEPL',
                  NOM_CMP='DX',
                  NOEUD='N66',
                  VALE=4.786331E-04,
                  REFERENCE='NON_REGRESSION',),);


FIN();
