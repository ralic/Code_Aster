# MODIF  DATE 13/01/2011   AUTEUR PELLET J.PELLET 
# TITRE ESSAI DE TRACTION-CISAILLEMENT (MISES ECROUISSAGE ISOTROPE)
# ssnp15f.para = tps_job 100 mem_job 100Mo liste_test S
#            CONFIGURATION MANAGEMENT OF EDF VERSION
# ======================================================================
# COPYRIGHT (C) 1991 - 2011  EDF R&D                  WWW.CODE-ASTER.ORG
# THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY  
# IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY  
# THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR     
# (AT YOUR OPTION) ANY LATER VERSION.                                                    
#                                                                       
# THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT   
# WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF            
# MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU      
# GENERAL PUBLIC LICENSE FOR MORE DETAILS.                              
#                                                                       
# YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE     
# ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,         
#    1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.        
# ======================================================================

DEBUT(CODE=_F(NOM='SSNP15F', NIV_PUB_WEB='INTERNET'), DEBUG=_F(SDVERI='NON'))

#......................................................................
# MODELISATION F : IDEM MODELISATION A AVEC UTILISATION D'UN CRITERE 
#                  DE RE-DECOUPAGE DU PAS DE TEMPS PAR EVENT-DRIVEN
#......................................................................

MA=LIRE_MAILLAGE( )

MO=AFFE_MODELE(

               MAILLAGE=MA,
                 VERIF='MAILLE',

                AFFE=_F(
                TOUT = 'OUI',
                PHENOMENE = 'MECANIQUE',
                MODELISATION = '3D')
              )

ACIER=DEFI_MATERIAU(


                ELAS=_F(
                E = 195000.,
                NU = 0.3),

                ECRO_LINE=_F(
                D_SIGM_EPSI = 1930.,
                SY = 181.),

                PRAGER=_F(C=0.)
              )

CM=AFFE_MATERIAU(

               MAILLAGE=MA,

                AFFE=_F(
                TOUT = 'OUI',
                MATER = ACIER)
              )

SIGMA_F=DEFI_FONCTION(

                 NOM_PARA='INST',
               PROL_DROITE='EXCLU',
              PROL_GAUCHE='EXCLU',

                VALE=(
                0.0,    0.0,
                1.0,  151.2,
                2.0,  257.2,
                3.0,    0.0,
                )
              )

TAU_F=DEFI_FONCTION(

                 NOM_PARA='INST',
               PROL_DROITE='EXCLU',
              PROL_GAUCHE='EXCLU',

                VALE=(
                0.0,    0.0,
                1.0,   93.1,
                2.0,   33.1,
                3.0,    0.0,
                )
              )

TRACTION=AFFE_CHAR_MECA(

                      MODELE=MO,

                FORCE_FACE=_F(
                MAILLE = 'GAUCHE',
                FX = -1.)
              )

CISAIL=AFFE_CHAR_MECA(

                      MODELE=MO,FORCE_FACE=(

                _F( MAILLE = 'GAUCHE',          FY = -1.),
                _F( MAILLE = 'DROITE',          FY = 1.),
                _F( MAILLE = 'HAUT',    FX = 1.),
                _F( MAILLE = 'BAS',     FX = -1.))
              )

LIAISON=AFFE_CHAR_MECA(

               MODELE=MO,DDL_IMPO=(

                _F( NOEUD = 'NO4',     DX = 0.,  DY = 0.),
                _F( NOEUD = 'NO8',     DX = 0.,  DY = 0.,  DZ = 0.),
                _F( NOEUD = 'NO2',     DX = 0.),
                _F( NOEUD = 'NO6',     DX = 0.))
              )

L_INST=DEFI_LIST_REEL(

               DEBUT=0.0,INTERVALLE=(
                _F( JUSQU_A = 0.1,     NOMBRE = 1),
                _F( JUSQU_A = 0.9,     NOMBRE = 1),
                _F( JUSQU_A = 1.0,     NOMBRE = 1),
                _F( JUSQU_A = 2.0,     NOMBRE = 1),
                _F( JUSQU_A = 3.0,     NOMBRE = 1))
              )

# gestion manuelle avec event-driven
DEFLIST = DEFI_LIST_INST(DEFI_LIST=_F(METHODE   ='MANUEL',
                                      LIST_INST = L_INST, ),
                         ECHEC=_F(EVENEMENT='DELTA_GRANDEUR',
                                  VALE_REF=0.1e-2,
                                  NOM_CHAM='VARI_ELGA',
                                  NOM_CMP ='V1',  
                                  SUBD_NIVEAU=10),

                         )


U=STAT_NON_LINE(MODELE=MO,
                CHAM_MATER=CM,
                EXCIT=(_F(CHARGE = LIAISON),
                       _F(CHARGE = TRACTION,FONC_MULT = SIGMA_F), 
                       _F(CHARGE = CISAIL,FONC_MULT = TAU_F)),
                COMP_INCR=_F(RELATION = 'VMIS_ISOT_LINE'),
                INCREMENT=_F(LIST_INST = DEFLIST),
                NEWTON=_F(MATRICE = 'ELASTIQUE',
                          REAC_ITER = 3),
                CONVERGENCE=_F(RESI_GLOB_MAXI = 1.E-3,
                              ITER_GLOB_MAXI = 10),
                RECH_LINEAIRE=_F(RHO_MAX=150,
                                 ITER_LINE_MAXI = 5)
              )

U2=STAT_NON_LINE(
                            MODELE=MO,
                        CHAM_MATER=CM,EXCIT=(
                             _F(
                CHARGE = LIAISON), _F(
                CHARGE = TRACTION,
                FONC_MULT = SIGMA_F), _F(
                CHARGE = CISAIL,
                FONC_MULT = TAU_F)),
                         COMP_INCR=_F(
                RELATION = 'VMIS_ECMI_LINE'),
                         INCREMENT=_F(
                LIST_INST = DEFLIST),
                            NEWTON=_F(
                MATRICE = 'ELASTIQUE',
                REAC_ITER = 3),
                       CONVERGENCE=_F(
                RESI_GLOB_MAXI = 1.E-3,
                ITER_GLOB_MAXI = 10),
                     RECH_LINEAIRE=_F(
                     RHO_MAX=150,
                ITER_LINE_MAXI = 5)
              )

U=CALC_ELEM( reuse=U,
                            OPTION=('EPSI_ELGA',
                  'SIEF_ELNO',  'VARI_ELNO_ELGA',),
                          RESULTAT=U,
              )
U2=CALC_ELEM( reuse=U2,
                            OPTION=('EPSI_ELGA',
                  'SIEF_ELNO',  'VARI_ELNO_ELGA',),
                          RESULTAT=U2,
              )

U=CALC_ELEM(
              reuse=U,
                  RESULTAT=U,
                   OPTION='EPSP_ELGA'
              )

U=CALC_ELEM(
              reuse=U,
                  RESULTAT=U,
                   OPTION='EPSI_ELNO_DEPL'
              )



VARI=CREA_CHAMP(  OPERATION='EXTR', TYPE_CHAM='ELNO_VARI_R',
NOM_CHAM='VARI_ELNO_ELGA',
              RESULTAT=U,
              INST=1.
              )

TEST_RESU(RESU=(

                _F(
                RESULTAT = U,
                NOM_CHAM = 'SIEF_ELNO',
                MAILLE = 'CUBE',
                NOEUD = 'NO2',
                INST = 1.,
                NOM_CMP = 'SIXX',
                VALE = 151.2),
                _F(
                RESULTAT = U,
                NOM_CHAM = 'SIEF_ELNO',
                MAILLE = 'CUBE',
                NOEUD = 'NO2',
                INST = 1.,
                NOM_CMP = 'SIXY',
                VALE = 93.1),
                _F(
                RESULTAT = U,
                NOM_CHAM = 'EPSI_ELNO_DEPL',
                MAILLE = 'CUBE',
                NOEUD = 'NO2',
                INST = 1.,
                NOM_CMP = 'EPXX',
                VALE = 1.48297E-2),
                _F(
                RESULTAT = U,
                NOM_CHAM = 'EPSI_ELNO_DEPL',
                MAILLE = 'CUBE',
                NOEUD = 'NO2',
                INST = 1.,
                NOM_CMP = 'EPXY',
                VALE = 1.36014E-2),
                _F(
                RESULTAT = U,
                NOM_CHAM = 'EPSP_ELGA',
                MAILLE = 'CUBE',
                POINT = 1,
                INST = 1.,
                NOM_CMP = 'EPXX',
                VALE = 1.4054E-2),
                _F(
                RESULTAT = U,
                NOM_CHAM = 'EPSP_ELGA',
                MAILLE = 'CUBE',
                POINT = 1,
                INST = 1.,
                NOM_CMP = 'EPXY',
                VALE = 1.2981E-2),
                _F(
                RESULTAT = U,
                NOM_CHAM = 'VARI_ELNO_ELGA',
                MAILLE = 'CUBE',
                NOEUD = 'NO2',
                INST = 1.,
                NOM_CMP = 'V1',
                VALE = 2.05473E-2),
                _F(
                RESULTAT = U,
                NOM_CHAM = 'VARI_ELNO_ELGA',
                MAILLE = 'CUBE',
                NOEUD = 'NO2',
                INST = 1.,
                NOM_CMP = 'V2',
                VALE = 1.),
#
                _F(
                RESULTAT = U,
                NOM_CHAM = 'EPSI_ELNO_DEPL',
                MAILLE = 'CUBE',
                NOEUD = 'NO2',
                INST = 2.,
                NOM_CMP = 'EPXX',
                VALE = 3.5265E-2,
                PRECISION = 0.6E-2,
                ),
                _F(
                RESULTAT = U,
                NOM_CHAM = 'EPSI_ELNO_DEPL',
                MAILLE = 'CUBE',
                NOEUD = 'NO2',
                INST = 2.,
                NOM_CMP = 'EPXY',
                VALE = 2.0471E-2,
                PRECISION = 0.6E-2,
                ),
                _F(
                RESULTAT = U,
                NOM_CHAM = 'EPSP_ELGA',
                MAILLE = 'CUBE',
                POINT = 1,
                INST = 2.,
                NOM_CMP = 'EPXX',
                VALE = 3.3946E-2,
                PRECISION = 0.6E-2,
                ),
                _F(
                RESULTAT = U,
                NOM_CHAM = 'EPSP_ELGA',
                MAILLE = 'CUBE',
                POINT = 1,
                INST = 2.,
                NOM_CMP = 'EPXY',
                VALE = 2.0250E-2,
                PRECISION = 0.6E-2,
                ),
                _F(
                RESULTAT = U,
                NOM_CHAM = 'VARI_ELNO_ELGA',
                MAILLE = 'CUBE',
                NOEUD = 'NO2',
                INST = 2.,
                NOM_CMP = 'V1',
                VALE = 4.2329E-2,
                )),
#

                CHAM_ELEM=_F(
                CHAM_GD = VARI,
                MAILLE = 'CUBE',
                NOEUD = 'NO2',
                NOM_CMP = 'V1',
                VALE = 2.05473E-2)
              )

# TEST DES INDICATEURS DE CHARGE - DECHARGE


U=CALC_ELEM( reuse=U,
                         RESULTAT=U,
                           OPTION='RADI_ELNO_SIGM',
                            NORME='VMIS'
                     )

U=CALC_ELEM( reuse=U,
                         RESULTAT=U,
                           OPTION='RADI_ELGA_SIGM',
                            NORME='VMIS'
                     )

U=CALC_ELEM( reuse=U,
                         RESULTAT=U,
                           OPTION='DCHA_ELGA_SIGM'
                     )

U=CALC_ELEM( reuse=U,
                         RESULTAT=U,
                           OPTION='DCHA_ELNO_SIGM'
                     )

U=CALC_ELEM( reuse=U,
                         RESULTAT=U,
                           OPTION='ETOT_ELGA'
                     )

U=CALC_ELEM( reuse=U,
                         RESULTAT=U,
                           OPTION='ETOT_ELNO'
                     )

U2=CALC_ELEM( reuse=U2,
                         RESULTAT=U2,
                           OPTION='ETOT_ELGA'
                     )

U2=CALC_ELEM( reuse=U2,
                         RESULTAT=U2,
                           OPTION='ETOT_ELNO'
                     )
U2=CALC_ELEM( reuse=U2,
                         RESULTAT=U2,
                           OPTION='ETOT_ELEM'
                     )
ENER_TOT=POST_ELEM(     RESULTAT=U,
                         TOUT_ORDRE='OUI',
                        ENER_TOTALE=_F( TOUT = 'OUI')
                      )

ENER_TO2=POST_ELEM(     RESULTAT=U2,
                         TOUT_ORDRE='OUI',
                        ENER_TOTALE=_F(  TOUT = 'OUI')
                      )

TEST_RESU(RESU=(
                _F(
                RESULTAT = U,
                NOM_CHAM = 'DCHA_ELGA_SIGM',
                NUME_ORDRE = 3,
                MAILLE = 'CUBE',
                POINT=1,
                NOM_CMP = 'V1',
                CRITERE = 'RELATIF',
                PRECISION = 0.1E-2,
                REFERENCE='NON_REGRESSION',
                VALE = 0.285714),
                _F(
                RESULTAT = U,
                NOM_CHAM = 'DCHA_ELNO_SIGM',
                NUME_ORDRE = 3,
                MAILLE = 'CUBE',
                NOEUD='NO2',
                NOM_CMP = 'V1',
                CRITERE = 'RELATIF',
                PRECISION = 0.1E-2,
                REFERENCE='NON_REGRESSION',
                VALE = 0.285714),
                _F(
                RESULTAT = U,
                NOM_CHAM = 'RADI_ELGA_SIGM',
                NUME_ORDRE = 12,
                MAILLE = 'CUBE',
                POINT=1,
                NOM_CMP = 'V1',
                CRITERE = 'RELATIF',
                PRECISION = 0.1E-2,
                REFERENCE='NON_REGRESSION',
                VALE = (3.10474E-12,2.9671e-11),),
               ),
           )

TEST_TABLE(TABLE=ENER_TO2,
          FILTRE=(
                 _F(  NOM_PARA = 'INST',
                          VALE = 0.1),),
          NOM_PARA='TOTALE',
          REFERENCE = 'AUTRE_ASTER',
          CRITERE='RELATIF',
          VALE=1.16403E-03  )


TEST_TABLE(TABLE=ENER_TO2,
          FILTRE=(
                 _F(  NOM_PARA = 'INST',
                          VALE = 0.9),),
          NOM_PARA='TOTALE',
          REFERENCE = 'AUTRE_ASTER',
          CRITERE='RELATIF',
          VALE= 1.84340  )


TEST_TABLE(TABLE=ENER_TO2,
          FILTRE=(
                 _F(  NOM_PARA = 'INST',
                          VALE = 2.0),),
          NOM_PARA='TOTALE',
          REFERENCE = 'AUTRE_ASTER',
          CRITERE='RELATIF',
          VALE= 9.58487  )

TEST_TABLE(TABLE=ENER_TO2,
          FILTRE=(
                 _F(  NOM_PARA = 'INST',
                          VALE =3.0 ),),
          NOM_PARA='TOTALE',
          REFERENCE = 'AUTRE_ASTER',
          CRITERE='RELATIF',
          VALE=  9.40794 )



FIN()

