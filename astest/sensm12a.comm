# MODIF  DATE 06/02/2006   AUTEUR ASSIRE A.ASSIRE 
# RESPONSABLE F6BHHBO P.DEBONNIERES
# TITRE PLAQUE SOUS PRESSION EN DP (PLASTICITE DRUCKER-PRAGER)
#            CONFIGURATION MANAGEMENT OF EDF VERSION
# ======================================================================
# COPYRIGHT (C) 1991 - 2004  EDF R&D                  WWW.CODE-ASTER.ORG
# THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY  
# IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY  
# THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR     
# (AT YOUR OPTION) ANY LATER VERSION.                                                    
#                                                                       
# THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT   
# WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF            
# MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU      
# GENERAL PUBLIC LICENSE FOR MORE DETAILS.                              
#                                                                       
# YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE     
# ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,         
#    1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.        
# ======================================================================
#            CONFIGURATION MANAGEMENT OF EDF VERSION
#
#
DEBUT(CODE=_F( NOM = 'SENSM12A',NIV_PUB_WEB='INTERNET',VISU_EFICAS='NON'),
          BASE=_F( FICHIER = 'GLOBALE',LONG_REPE = 15000), 
          PAR_LOT='NON')
#
#......................................................................
# PLAQUE EN COMPRESSION SIMPLE EN DEFORMATIONS PLANES
# (DEPLACEMENT TRANSVERSAL NUL SUR LES BORDS)
# PLASTICITE DRUCKER-PRAGER
# SENSIBILITE AUX CHARGEMENTS
#......................................................................
#

PRE_GIBI()

MA=LIRE_MAILLAGE();

MO=AFFE_MODELE(MAILLAGE=MA,
               AFFE=_F(TOUT='OUI',
                       PHENOMENE='MECANIQUE',
                       MODELISATION='D_PLAN',),);

MA=MODI_MAILLAGE( reuse=MA,
             MAILLAGE=MA,
             MODELE=MO,
             ORIE_PEAU_2D=_F(  GROUP_MA = ('AB')),
             INFO=1);

FORCES = DEFI_PARA_SENSI(VALE=1.0E8)
S9999999=DEFI_PARA_SENSI(VALE=0.0)
S9999998=DEFI_PARA_SENSI(VALE=1.0)
MEMO_NOM_SENSI(NOM=_F(NOM_COMPOSE='S9999998',
                        PARA_SENSI=FORCES,
                        NOM_SD='FORCES'),
              )
FORCE1 = DEFI_CONSTANTE(VALE=1.0E8)
E1 = DEFI_CONSTANTE(VALE=5800.0E6)
NU1 = DEFI_CONSTANTE(VALE=0.3)
PS2 = DEFI_PARA_SENSI(VALE=0.0)
ALPHA1 = DEFI_CONSTANTE(VALE=0.33)
P_ULTM1 = DEFI_CONSTANTE(VALE=0.01)
SY1 = DEFI_CONSTANTE(VALE=2.57E6)
SY_ULTM1 = DEFI_CONSTANTE(VALE=1.0E8)

MAT=DEFI_MATERIAU(ELAS_FO=_F(E = E1,
                             NU = NU1,),
                    DRUCK_PRAGER_FO=_F( 
                                 ECROUISSAGE = 'PARABOLIQUE',
                                 ALPHA = ALPHA1,
                                 P_ULTM = P_ULTM1,
                                 SY = SY1,
                                 SY_ULTM = SY_ULTM1,),
                                );

CHMAT=AFFE_MATERIAU(MAILLAGE=MA,
                    AFFE=(_F(GROUP_MA='MA',
                             MATER=MAT,),
                             ),);

ZERO = DEFI_CONSTANTE(VALE=0.0)

CHAS=AFFE_CHAR_MECA_F(MODELE=MO,
                   FORCE_NODALE = _F(NOEUD = ('N3','N4'),
                   FY = FORCES),
                   DDL_IMPO=(
                             _F(GROUP_MA='AB',
                                DY=ZERO,),
                             _F(NOEUD=('N1','N2','N3','N4',),
                                DX=ZERO,),
                                     ),
                   );
S9999997=AFFE_CHAR_MECA_F(MODELE=MO,
                          FORCE_NODALE=_F(FY=S9999998,
                                          NOEUD=('N3','N4',)),
                          VERI_NORM='OUI',
                          DDL_IMPO=(_F(DY=S9999999,
                                       GROUP_MA='AB'),
                                    _F(DX=S9999999,
                                       NOEUD=('N1','N2','N3','N4',))),
                          INFO=1,
                         )
MEMO_NOM_SENSI(NOM=_F(MOT_CLE=('FY',),
                      PARA_SENSI=FORCES,
                      NOM_SD='CHAS',
                      VALEUR=('FORCES',),
                      NOM_COMPOSE='S9999997',
                      MOT_FACT=('FORCE_NODALE',)),
              )

CHA1=AFFE_CHAR_MECA_F(MODELE=MO,
                   FORCE_NODALE = _F(NOEUD = ('N3','N4'),
                   FY = FORCE1),
                   DDL_IMPO=(
                             _F(GROUP_MA='AB',
                                DY=ZERO,),
                             _F(NOEUD=('N1','N2','N3','N4',),
                                DX=ZERO,),
                                     ),
                   );

L_INST=DEFI_LIST_REEL(DEBUT=0.0,
                      INTERVALLE=_F(JUSQU_A=1.0,
                                    NOMBRE=5,),);

F=DEFI_FONCTION(NOM_PARA='INST',
                VALE=(0.0,  0.0,
                      1.0,  1.0),
                      );
MEMO_NOM_SENSI(NOM=_F(NOM_COMPOSE='S9999996',
                        PARA_SENSI=FORCES,
                        NOM_SD='RESUS'),
              )

RESUS=STAT_NON_LINE(MODELE=MO,
                   CHAM_MATER=CHMAT,
                   EXCIT=_F(CHARGE=CHAS,
                            FONC_MULT=F,),
                   COMP_INCR=_F(RELATION='DRUCKER_PRAGER',
                                RESI_INTE_RELA = 1.E-8),
                   INCREMENT=_F(LIST_INST=L_INST,
                                INST_FIN=1.,
                                SUBD_PAS=4,
                                SUBD_PAS_MINI=1.E-4,
                                COEF_SUBD_PAS_1=1.0,),
                   NEWTON=_F(MATRICE='TANGENTE',
                             PREDICTION='ELASTIQUE',
                             REAC_ITER=1,),
                   CONVERGENCE=_F(RESI_GLOB_RELA = 1.E-8),
                   ARCHIVAGE=_F(LIST_INST=L_INST,
                                ARCH_ETAT_INIT='OUI',),
                   SENSIBILITE=FORCES,
                   INFO=1);

RESUS=CALC_ELEM( reuse=RESUS,
                            OPTION=(
                  'SIEF_ELNO_ELGA',  'VARI_ELNO_ELGA',),
                          RESULTAT=RESUS,
              )

RESUS=CALC_ELEM( reuse=RESUS,
                            OPTION=(
                  'SIEF_ELNO_ELGA',  'VARI_ELNO_ELGA',),
                   SENSIBILITE=FORCES,
                          RESULTAT=RESUS,
              )


RESU1=STAT_NON_LINE(MODELE=MO,
                   CHAM_MATER=CHMAT,
                   EXCIT=_F(CHARGE=CHA1,
                            FONC_MULT=F,),
                   COMP_INCR=_F(RELATION='DRUCKER_PRAGER',
                                RESI_INTE_RELA = 1.E-8),
                   INCREMENT=_F(LIST_INST=L_INST,
                                INST_FIN=1.,
                                SUBD_PAS=4,
                                SUBD_PAS_MINI=1.E-4,
                                COEF_SUBD_PAS_1=1.0,),
                   NEWTON=_F(MATRICE='TANGENTE',
                             PREDICTION='ELASTIQUE',
                             REAC_ITER=1,),
                   CONVERGENCE=_F(RESI_GLOB_RELA = 1.E-8),
                   ARCHIVAGE=_F(LIST_INST=L_INST,
                                ARCH_ETAT_INIT='OUI',),
                   INFO=1);

RESU1=CALC_ELEM( reuse=RESU1,
                            OPTION=(
                  'SIEF_ELNO_ELGA',  'VARI_ELNO_ELGA',),
                          RESULTAT=RESU1,
              )


epsilon = 1.0E-4
eps = 1.0 + epsilon

FORCE2 = DEFI_CONSTANTE(VALE=1.0E8*eps)

CHA2 = AFFE_CHAR_MECA_F(MODELE=MO,
                        FORCE_NODALE = _F(NOEUD = ('N3','N4'),
                        FY = FORCE2),
                        DDL_IMPO=(
                             _F(GROUP_MA='AB',
                                DY=ZERO,),
                             _F(NOEUD=('N1','N2','N3','N4',),
                                DX=ZERO,),
                                     ),
                       );

RESU2 = STAT_NON_LINE(MODELE=MO,
                      CHAM_MATER=CHMAT,
                      EXCIT=_F(CHARGE=CHA2,
                               FONC_MULT=F,),
                      COMP_INCR=_F(RELATION='DRUCKER_PRAGER',
                                   RESI_INTE_RELA = 1.E-8),
                      INCREMENT=_F(LIST_INST=L_INST,
                                   INST_FIN=1.,
                                   SUBD_PAS=4,
                                   SUBD_PAS_MINI=1.E-4,
                                   COEF_SUBD_PAS_1=1.0,),
                      NEWTON=_F(MATRICE='TANGENTE',
                                PREDICTION='ELASTIQUE',
                                REAC_ITER=1,),
                      CONVERGENCE=_F(RESI_GLOB_RELA = 1.E-8),
                      ARCHIVAGE=_F(LIST_INST=L_INST,
                                   ARCH_ETAT_INIT='OUI',),
                      INFO=1);

RESU2=CALC_ELEM( reuse=RESU2,
                            OPTION=(
                  'SIEF_ELNO_ELGA',  'VARI_ELNO_ELGA',),
                          RESULTAT=RESU2,
              )


for j in range(1, 6):

  TAB_REF = CREA_CHAMP(TYPE_CHAM = 'ELGA_SIEF_R',
                       OPERATION = 'EXTR',
                       RESULTAT = RESU1,
                       NOM_CHAM = 'SIEF_ELGA',
                       NUME_ORDRE = j
                      )

  TAB_REFNP = TAB_REF.EXTR_COMP('SIYY', [], 1)

  TAB_DIF = CREA_CHAMP(TYPE_CHAM = 'ELGA_SIEF_R',
                       OPERATION = 'EXTR',
                       RESULTAT = RESU2,
                       NOM_CHAM = 'SIEF_ELGA',
                       NUME_ORDRE = j
                      )
  TAB_DIFNP = TAB_DIF.EXTR_COMP('SIYY',[])

  diff = (TAB_DIFNP.valeurs[0]-TAB_REFNP.valeurs[0])/(1.0E8*epsilon)

  TEST_RESU(RESU=(_F(RESULTAT = RESUS,   NUME_ORDRE = j,
                     NOM_CHAM = 'SIEF_ELGA', MAILLE = 'M1', POINT = 1,
                     CRITERE = 'RELATIF', PRECISION = 1.E-2,
                     NOM_CMP = 'SIYY',   SENSIBILITE = FORCES,
                     VALE = diff, REFERENCE = 'AUTRE_ASTER' )))

  DETRUIRE( CONCEPT =_F(NOM = TAB_REF ))
  DETRUIRE( CONCEPT =_F(NOM = TAB_DIF ))

for j in range(1, 6):

  TAB_REF = CREA_CHAMP(TYPE_CHAM = 'ELNO_SIEF_R',
                       OPERATION = 'EXTR',
                       RESULTAT = RESU1,
                       NOM_CHAM = 'SIEF_ELNO_ELGA',
                       NUME_ORDRE = j
                      )

  TAB_REFNP = TAB_REF.EXTR_COMP('SIYY', [], 1)

  TAB_DIF = CREA_CHAMP(TYPE_CHAM = 'ELNO_SIEF_R',
                       OPERATION = 'EXTR',
                       RESULTAT = RESU2,
                       NOM_CHAM = 'SIEF_ELNO_ELGA',
                       NUME_ORDRE = j
                      )
  TAB_DIFNP = TAB_DIF.EXTR_COMP('SIYY',[])

  diff = (TAB_DIFNP.valeurs[0]-TAB_REFNP.valeurs[0])/(1.0E8*epsilon)

  TEST_RESU(RESU=(_F(RESULTAT = RESUS,   NUME_ORDRE = j,
                     NOM_CHAM = 'SIEF_ELNO_ELGA', MAILLE = 'M1', NOEUD = 'N1',
                     CRITERE = 'RELATIF', PRECISION = 1.E-2,
                     NOM_CMP = 'SIYY',   SENSIBILITE = FORCES,
                     VALE = diff, REFERENCE = 'AUTRE_ASTER' )))

  DETRUIRE( CONCEPT =_F(NOM = TAB_REF ))
  DETRUIRE( CONCEPT =_F(NOM = TAB_DIF ))

for j in range(1, 6):

  TAB_REF = CREA_CHAMP(TYPE_CHAM = 'ELNO_VARI_R',
                       OPERATION = 'EXTR',
                       RESULTAT = RESU1,
                       NOM_CHAM = 'VARI_ELNO_ELGA',
                       NUME_ORDRE = j
                      )

  TAB_REFNP = TAB_REF.EXTR_COMP('V1', [], 1)

  TAB_DIF = CREA_CHAMP(TYPE_CHAM = 'ELNO_VARI_R',
                       OPERATION = 'EXTR',
                       RESULTAT = RESU2,
                       NOM_CHAM = 'VARI_ELNO_ELGA',
                       NUME_ORDRE = j
                      )
  TAB_DIFNP = TAB_DIF.EXTR_COMP('V1',[])

  diff = (TAB_DIFNP.valeurs[0]-TAB_REFNP.valeurs[0])/(1.0E8*epsilon)

  TEST_RESU(RESU=(_F(RESULTAT = RESUS,   NUME_ORDRE = j,
                     NOM_CHAM = 'VARI_ELNO_ELGA', MAILLE = 'M1', NOEUD = 'N1',
                     CRITERE = 'RELATIF', PRECISION = 1.E-2,
                     NOM_CMP = 'V1',   SENSIBILITE = FORCES,
                     VALE = diff, REFERENCE = 'AUTRE_ASTER' )))

  DETRUIRE( CONCEPT =_F(NOM = TAB_REF ))
  DETRUIRE( CONCEPT =_F(NOM = TAB_DIF ))


FIN();

