# TITRE ETUDE:  ESSAI OEDOMETRIQUE NON-DRAINE (MECA PUR) AVEC LA LOI DE CAMCLAY
# ======================================================================
# COPYRIGHT (C) 1991 - 2015  EDF R&D                  WWW.CODE-ASTER.ORG
# THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY
# IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY
# THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR
# (AT YOUR OPTION) ANY LATER VERSION.
#
# THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT
# WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF
# MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU
# GENERAL PUBLIC LICENSE FOR MORE DETAILS.
#
# YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE
# ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,
#    1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.
# ======================================================================
# PRESSION DE CONSOLITDATION PCO = 10KPA


DEBUT(CODE=_F(NIV_PUB_WEB='INTERNET',VISU_EFICAS='NON'),DEBUG=_F(SDVERI='OUI'))


# PROPRIETES MECANIQUES
E    = 1.2*6.E5 ;
NU   = 0.3      ;
mu = 276923.      ;
RHO  = 1900.    ;


# PROPRIETES ANELASTIQUES (CAMCLAY)
E0     = 2.   ;  # INDICE DES VIDES INITIAL (CORRESPONDANT A PCO)
PATM   = 1.E2 ;
PCO    = 1.E4 ;  # PRESSION DE PRECONSOLIDATION ISOTROPE
M      = 1.02 ;  # CORRESPOND A UN ANGLE DE FROTTEMENT DE 25.85 DEGRES
PCR    = PCO/2. ;       # PRESSION CRITIQUE
N      = E0 /(1.+E0) ;  # POROSITE
KAPA   = 0.05 ;
LAMBD  = 0.2  ;


#    =================
#    MAILLAGE + MODELE
#    =================


MAILLAGE=LIRE_MAILLAGE(FORMAT='MED',);

MODELE=AFFE_MODELE(MAILLAGE=MAILLAGE,
                   AFFE=_F(TOUT = 'OUI',
                           PHENOMENE = 'MECANIQUE',
                           MODELISATION = '3D'));

MAILLAGE=MODI_MAILLAGE(reuse=MAILLAGE,
                       MAILLAGE=MAILLAGE,
                       ORIE_PEAU_3D=_F(GROUP_MA = ('HAUT', 'DEVANT', 'DROITE')));

MAILLAGE = DEFI_GROUP(reuse= MAILLAGE,
                      MAILLAGE=MAILLAGE,
                      CREA_GROUP_MA=_F(NOM='ROCHE',TOUT='OUI'),
                      CREA_GROUP_NO=_F(GROUP_MA='ROCHE'));

SOL=DEFI_MATERIAU(ELAS=_F(E=E,
                          NU=NU,
                          RHO=RHO,
                          ALPHA=0.),
                  CAM_CLAY=_F(MU        =mu,
                              PORO      = N,
                              LAMBDA    = LAMBD,
                              KAPA      = KAPA,
                              M         = M,
                              PRES_CRIT = PCR,
                              KCAM        = 0.,
                              PTRAC       =0.));

CHMAT=AFFE_MATERIAU(MAILLAGE=MAILLAGE,
                    AFFE=_F(TOUT='OUI', MATER=SOL));

DEP_LATE=AFFE_CHAR_MECA(MODELE=MODELE,
                        FACE_IMPO=(_F(GROUP_MA = 'DEVANT', DX = 0.),
                                   _F(GROUP_MA = 'DROITE', DY = 0.)));

DEP_SYM=AFFE_CHAR_MECA(MODELE=MODELE,
                       FACE_IMPO=(_F(GROUP_MA = 'BAS'     , DZ=0.),
                                  _F(GROUP_MA = 'DERRIERE', DX=0.),
                                  _F(GROUP_MA = 'GAUCHE'  , DY=0.)));

TAN=DEFI_LIST_REEL(DEBUT=0.,
                   INTERVALLE=(_F(JUSQU_A = 1. , NOMBRE = 50),
                               _F(JUSQU_A = 2. , NOMBRE = 10),
                               _F(JUSQU_A = 10., NOMBRE = 10)));

SIEF=CREA_CHAMP(TYPE_CHAM='ELGA_SIEF_R',
                OPERATION='AFFE',
                MODELE=MODELE,
                PROL_ZERO='OUI',
                AFFE=_F(TOUT    = 'OUI',
                        NOM_CMP = ('SIXX','SIYY','SIZZ'),
                        VALE    = (-PCO,-PCO,-PCO)));


#   ====================
#   CALCUL QUASISTATIQUE
#   ====================


DEP_V=AFFE_CHAR_MECA(MODELE=MODELE,
                     FACE_IMPO=_F(GROUP_MA = 'HAUT',DZ = 1.));

EVOL_DEV=DEFI_FONCTION(NOM_PARA='INST',
                       PROL_DROITE='LINEAIRE',
                       PROL_GAUCHE='CONSTANT',
                       VALE=(0. ,  0.     ,
                             1. , -1.E-2  ,
                             2. , -2.E-02 ,
                             10., -10.E-02));

U1=STAT_NON_LINE(MODELE=MODELE,
                 CHAM_MATER=CHMAT,
                 EXCIT=(_F(CHARGE = DEP_SYM),
                        _F(CHARGE = DEP_LATE),
                        _F(CHARGE = DEP_V,
                           FONC_MULT = EVOL_DEV)),
                 COMPORTEMENT=_F(RELATION = 'CAM_CLAY'),
                 ETAT_INIT=_F(SIGM=SIEF),
                 INCREMENT=_F(LIST_INST    = TAN,
                              INST_FIN     = 10.,),
                 NEWTON=_F(MATRICE   = 'TANGENTE',
                           REAC_ITER = 1),
                 CONVERGENCE=_F(RESI_GLOB_RELA = 1.E-6,
                                ITER_GLOB_MAXI = 10));

U1=CALC_CHAMP(reuse=U1,VARI_INTERNE=('VARI_ELNO'),DEFORMATION=('EPSI_ELNO'),RESULTAT=U1)


TAB_VARI=POST_RELEVE_T(ACTION=_F(INTITULE='VARI_NOEU',
                                 NOEUD='NO8',
                                 RESULTAT=U1,
                                 NOM_CHAM='VARI_ELNO',
                                 NOM_CMP=('V1','V3','V4','V5','V6','V7'),
                                 OPERATION='EXTRACTION'));

TAB_EPSZ=POST_RELEVE_T(ACTION=_F(INTITULE='EPSI_ELNO',
                                 NOEUD='NO8',
                                 RESULTAT=U1,
                                 NOM_CHAM='EPSI_ELNO',
                                 NOM_CMP='EPZZ',
                                 OPERATION='EXTRACTION'));

TAB_VARI=CALC_TABLE(reuse=TAB_VARI,
                    TABLE=TAB_VARI,
                    ACTION=_F(OPERATION='COMB',
                              TABLE=TAB_EPSZ,
                              NOM_PARA='INST'));


# TEST DE LA CONTRAINTE VOLUMIQUE PAR RAPPORT AUX REFERENCES FLAQ
TEST_TABLE(CRITERE='RELATIF',
           REFERENCE='SOURCE_EXTERNE',
           PRECISION=1.E-2,
           VALE_CALC= 1.01322930E+04,
           VALE_REFE=1.0070E4,
           NOM_PARA='V3',
           TABLE=TAB_VARI,
           FILTRE=_F(CRITERE='ABSOLU',
                     PRECISION=9.0000000000000006E-05,
                     NOM_PARA='EPZZ',
                     VALE=-1.E-3,),
           )

TEST_TABLE(CRITERE='RELATIF',
           REFERENCE='SOURCE_EXTERNE',
           PRECISION=1.E-2,
           VALE_CALC= 1.05058933E+04,
           VALE_REFE=1.0500E4,
           NOM_PARA='V3',
           TABLE=TAB_VARI,
           FILTRE=_F(CRITERE='ABSOLU',
                     PRECISION=9.0000000000000006E-05,
                     NOM_PARA='EPZZ',
                     VALE=-5.0000000000000001E-3,),
           )

TEST_TABLE(CRITERE='RELATIF',
           REFERENCE='SOURCE_EXTERNE',
           PRECISION=1.E-2,
           VALE_CALC= 1.10145183E+04,
           VALE_REFE=1.1010E4,
           NOM_PARA='V3',
           TABLE=TAB_VARI,
           FILTRE=_F(CRITERE='ABSOLU',
                     PRECISION=9.0000000000000006E-05,
                     NOM_PARA='EPZZ',
                     VALE=-1.E-2,),
           )

TEST_TABLE(CRITERE='RELATIF',
           REFERENCE='SOURCE_EXTERNE',
           PRECISION=1.E-2,
           VALE_CALC= 1.24993018E+04,
           VALE_REFE=1.2480E4,
           NOM_PARA='V3',
           TABLE=TAB_VARI,
           FILTRE=_F(CRITERE='ABSOLU',
                     PRECISION=9.0000000000000006E-05,
                     NOM_PARA='EPZZ',
                     VALE=-0.02,),
           )

TEST_TABLE(CRITERE='RELATIF',
           REFERENCE='SOURCE_EXTERNE',
           PRECISION=1.E-2,
           VALE_CALC= 4.19890157E+04,
           VALE_REFE=4.1840E4,
           NOM_PARA='V3',
           TABLE=TAB_VARI,
           FILTRE=_F(CRITERE='ABSOLU',
                     PRECISION=9.0000000000000006E-05,
                     NOM_PARA='EPZZ',
                     VALE=-0.10000000000000001,),
           )

# TEST DE LA NORME DU DEVIATEUR DES CONTRAINTES PAR RAPPORT AUX REFERENCES FLAQ
TEST_TABLE(CRITERE='RELATIF',
           REFERENCE='SOURCE_EXTERNE',
           PRECISION=0.014999999999999999,
           VALE_CALC=514.640393493,
           VALE_REFE=521.0,
           NOM_PARA='V4',
           TABLE=TAB_VARI,
           FILTRE=_F(CRITERE='ABSOLU',
                     PRECISION=9.0000000000000006E-05,
                     NOM_PARA='EPZZ',
                     VALE=-1.E-3,),
           )

TEST_TABLE(CRITERE='RELATIF',
           REFERENCE='SOURCE_EXTERNE',
           PRECISION=1.E-2,
           VALE_CALC= 1.99875260E+03,
           VALE_REFE=2016.0,
           NOM_PARA='V4',
           TABLE=TAB_VARI,
           FILTRE=_F(CRITERE='ABSOLU',
                     PRECISION=9.0000000000000006E-05,
                     NOM_PARA='EPZZ',
                     VALE=-5.0000000000000001E-3,),
           )

TEST_TABLE(CRITERE='RELATIF',
           REFERENCE='SOURCE_EXTERNE',
           PRECISION=1.E-2,
           VALE_CALC= 3.05111885E+03,
           VALE_REFE=3068.0,
           NOM_PARA='V4',
           TABLE=TAB_VARI,
           FILTRE=_F(CRITERE='ABSOLU',
                     PRECISION=9.0000000000000006E-05,
                     NOM_PARA='EPZZ',
                     VALE=-1.E-2,),
           )

TEST_TABLE(CRITERE='RELATIF',
           REFERENCE='SOURCE_EXTERNE',
           PRECISION=1.E-2,
           VALE_CALC= 4.18969632E+03,
           VALE_REFE=4219.0,
           NOM_PARA='V4',
           TABLE=TAB_VARI,
           FILTRE=_F(CRITERE='ABSOLU',
                     PRECISION=9.0000000000000006E-05,
                     NOM_PARA='EPZZ',
                     VALE=-0.02,),
           )

TEST_TABLE(CRITERE='RELATIF',
           REFERENCE='SOURCE_EXTERNE',
           PRECISION=1.E-2,
           VALE_CALC= 1.29049467E+04,
           VALE_REFE=1.3020E4,
           NOM_PARA='V4',
           TABLE=TAB_VARI,
           FILTRE=_F(CRITERE='ABSOLU',
                     PRECISION=9.0000000000000006E-05,
                     NOM_PARA='EPZZ',
                     VALE=-0.10000000000000001,),
           )

# TEST DE L'INDICE DES VIDES PAR RAPPORT AUX REFERENCES GEFDYN
TEST_TABLE(CRITERE='RELATIF',
           REFERENCE='SOURCE_EXTERNE',
           PRECISION=1.E-3,
           VALE_CALC=1.997600000,
           VALE_REFE=1.9970000000000001,
           NOM_PARA='V7',
           TABLE=TAB_VARI,
           FILTRE=_F(CRITERE='ABSOLU',
                     PRECISION=9.0000000000000006E-05,
                     NOM_PARA='EPZZ',
                     VALE=-1.E-3,),
           )

TEST_TABLE(CRITERE='RELATIF',
           REFERENCE='SOURCE_EXTERNE',
           PRECISION=1.E-3,
           VALE_CALC=1.985600000,
           VALE_REFE=1.9850000000000001,
           NOM_PARA='V7',
           TABLE=TAB_VARI,
           FILTRE=_F(CRITERE='ABSOLU',
                     PRECISION=9.0000000000000006E-05,
                     NOM_PARA='EPZZ',
                     VALE=-5.0000000000000001E-3,),
           )

TEST_TABLE(CRITERE='RELATIF',
           REFERENCE='SOURCE_EXTERNE',
           PRECISION=1.E-3,
           VALE_CALC=1.970600000,
           VALE_REFE=1.97,
           NOM_PARA='V7',
           TABLE=TAB_VARI,
           FILTRE=_F(CRITERE='ABSOLU',
                     PRECISION=9.0000000000000006E-05,
                     NOM_PARA='EPZZ',
                     VALE=-1.E-2,),
           )

TEST_TABLE(CRITERE='RELATIF',
           REFERENCE='SOURCE_EXTERNE',
           PRECISION=1.E-3,
           VALE_CALC=1.940600000,
           VALE_REFE=1.9399999999999999,
           NOM_PARA='V7',
           TABLE=TAB_VARI,
           FILTRE=_F(CRITERE='ABSOLU',
                     PRECISION=9.0000000000000006E-05,
                     NOM_PARA='EPZZ',
                     VALE=-0.02,),
           )

TEST_TABLE(CRITERE='RELATIF',
           REFERENCE='SOURCE_EXTERNE',
           PRECISION=1.E-3,
           VALE_CALC=1.700600000,
           VALE_REFE=1.7,
           NOM_PARA='V7',
           TABLE=TAB_VARI,
           FILTRE=_F(CRITERE='ABSOLU',
                     PRECISION=9.0000000000000006E-05,
                     NOM_PARA='EPZZ',
                     VALE=-0.10000000000000001,),
           )

FIN () ;
