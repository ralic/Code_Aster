# MODIF  DATE 22/10/2007   AUTEUR PELLET J.PELLET 
# TITRE SENSIBILITE DES MODES PROPRES CALCULES PAR MODE_ITER_INV
#            CONFIGURATION MANAGEMENT OF EDF VERSION
# ======================================================================
# COPYRIGHT (C) 1991 - 2004  EDF R&D                  WWW.CODE-ASTER.ORG
# THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY
# IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY
# THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR
# (AT YOUR OPTION) ANY LATER VERSION.
#
# THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT
# WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF
# MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU
# GENERAL PUBLIC LICENSE FOR MORE DETAILS.
#
# YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE
# ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,
#    1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.
# ======================================================================

DEBUT(CODE=_F(NOM='SENSD08B',NIV_PUB_WEB='INTERNET',VISU_EFICAS='NON'),PAR_LOT='OUI',DEBUG=_F(SDVERI='NON'))

# ----------------------------------------------------------------------
# Poutre en flexion appuyee-appuyee (L=0.4m, b=0.02m, h=0.01m)
# Sensibilite des modes propres par rapport au module d'young
# La solution de reference est obtenue analytiquement
# ----------------------------------------------------------------------

pi = 3.14159
h = 0.01
l = 0.4
rho = 7800.

#           E      NU  AMOR_ALPHA AMOR_BETA
sensible=[2.1E11,  0.3,  1.E-6,   1.E-6,   ]
n=len(sensible)
PS=[None]*n

for i in range(n):
    PS[i]=DEFI_PARA_SENSI(VALE=sensible[i])

PRE_GIBI()
MAILLAGE=LIRE_MAILLAGE();

MAILLAGE=DEFI_GROUP(reuse =MAILLAGE,
                    MAILLAGE=MAILLAGE,
                    CREA_GROUP_NO=(
                                   _F(OPTION='PLAN',
                                      NOM='L5',
                                      POINT=(l,0.,h/2),
                                      VECT_NORMALE=(1.0,0.0,-0.1),
                                      PRECISION=1.E-4,),
                                   _F(OPTION='PLAN',
                                      NOM='L6',
                                      POINT=(0.,0.,h/2),
                                      VECT_NORMALE=(-1.0,0.0,-0.1),
                                      PRECISION=1.E-4,),
                                   ),);

MO=AFFE_MODELE(MAILLAGE=MAILLAGE,
               AFFE=_F(GROUP_MA=('POUTRE',),
                       PHENOMENE='MECANIQUE',
                       MODELISATION='3D',),);

MAT=DEFI_MATERIAU(ELAS_FO=_F(E=PS[0],
                             RHO=rho, NU=PS[1],
                             AMOR_ALPHA = PS[2], AMOR_BETA = PS[3],
                             ),);

CHMAT=AFFE_MATERIAU(MAILLAGE=MAILLAGE,
                    AFFE=(_F(GROUP_MA='POUTRE',MATER=MAT,),),)

CLIM=AFFE_CHAR_MECA(MODELE=MO,
                    DDL_IMPO=(_F(GROUP_NO='L5',DX=0.,DY=0.,DZ=0.),
                              _F(GROUP_NO='L6',DX=0.,DY=0.,DZ=0.),),);

MATELER=CALC_MATR_ELEM(MODELE=MO,OPTION='RIGI_MECA',
                       CHAM_MATER=CHMAT,
                       CHARGE=CLIM);

MATELEM=CALC_MATR_ELEM(MODELE=MO,
                       OPTION='MASS_MECA',
                       CHAM_MATER=CHMAT,
                       CHARGE=CLIM);

MATELEC=CALC_MATR_ELEM(MODELE=MO,
                       OPTION='AMOR_MECA',
                       RIGI_MECA=MATELER,MASS_MECA=MATELEM,
                       CHAM_MATER=CHMAT,
                       CHARGE=CLIM);

NUM=NUME_DDL(MATR_RIGI=MATELER);

MATASSR=ASSE_MATRICE(MATR_ELEM=MATELER,NUME_DDL=NUM);

MATASSM=ASSE_MATRICE(MATR_ELEM=MATELEM,NUME_DDL=NUM);

MATASSC=ASSE_MATRICE(MATR_ELEM=MATELEC,NUME_DDL=NUM);

# calcul solution analytique
# derivee frequence :
def sqrt(x):
    return x**.5

f1 = pi*sqrt(h*h*sensible[0]/(12.*rho))/(2.*l*l)
f2 = 4*f1
df1 = pi*sqrt(h*h/(12.*rho*sensible[0]))/(4.*l*l)
df2 = 4*df1

# MODES REELS

MODEI=MODE_ITER_INV(MATR_A=MATASSR,MATR_B=MATASSM,
#         MATR_C=MATASSC,
         SENSIBILITE=(PS[0],),CHAM_MATER=CHMAT,
         CALC_FREQ=_F(FREQ=(100.,600.,),OPTION='SEPARE'),
         )

TEST_RESU(RESU=(
          _F( RESULTAT = MODEI, PARA = 'FREQ', REFERENCE='ANALYTIQUE',
                CRITERE = 'RELATIF', PRECISION = 1.E-2,
                NUME_ORDRE = 1,  VALE = f1),
          _F( RESULTAT = MODEI, PARA = 'FREQ', REFERENCE='ANALYTIQUE',
                CRITERE = 'RELATIF', PRECISION = 1.E-2,
                NUME_ORDRE = 2,  VALE = f2),
          _F( RESULTAT = MODEI, PARA = 'FREQ', REFERENCE='ANALYTIQUE',
                CRITERE = 'RELATIF', PRECISION = 1.E-2,
                SENSIBILITE=PS[0],
                NUME_ORDRE = 1,  VALE = df1),
          _F( RESULTAT = MODEI, PARA = 'FREQ', REFERENCE='ANALYTIQUE',
                CRITERE = 'RELATIF', PRECISION = 1.E-2,
                SENSIBILITE=PS[0],
                NUME_ORDRE = 2,  VALE = df2),
          _F( RESULTAT = MODEI, REFERENCE='ANALYTIQUE',
                NOM_CHAM='DEPL',NOEUD='N6',NOM_CMP='DY',
                CRITERE = 'ABSOLU', PRECISION = 1.E-15,
                SENSIBILITE=PS[0],
                NUME_ORDRE = 1,  VALE = 0.E0),
          _F( RESULTAT = MODEI, REFERENCE='ANALYTIQUE',
                NOM_CHAM='DEPL',NOEUD='N6',NOM_CMP='DY',
                CRITERE = 'ABSOLU', PRECISION = 1.E-14,
                SENSIBILITE=PS[0],
                NUME_ORDRE = 2,  VALE = 0.E0),
          ),)

MODEI=NORM_MODE(reuse=MODEI,MODE=MODEI,
                  SENSIBILITE=(PS[0],),
                  NORME=('MASS_GENE',),)

TEST_RESU(RESU=(
          _F( RESULTAT = MODEI, REFERENCE='ANALYTIQUE',
                NOM_CHAM='DEPL',NOEUD='N6',NOM_CMP='DY',
                CRITERE = 'ABSOLU', PRECISION = 1.E-15,
                SENSIBILITE=PS[0],
                NUME_ORDRE = 1,  VALE = 0.E0),
          _F( RESULTAT = MODEI, REFERENCE='ANALYTIQUE',
                NOM_CHAM='DEPL',NOEUD='N6',NOM_CMP='DY',
                CRITERE = 'ABSOLU', PRECISION = 1.E-13,
                SENSIBILITE=PS[0],
                NUME_ORDRE = 2,  VALE = 0.E0),
          ),)

# MODES COMPLEXES

MODEIC=MODE_ITER_INV(MATR_A=MATASSR,MATR_B=MATASSM,
         MATR_C=MATASSC,
         SENSIBILITE=(PS[0],),CHAM_MATER=CHMAT,
         CALC_FREQ=_F(FREQ=(100.,600.,),OPTION='SEPARE'),
         )

TEST_RESU(RESU=(
          _F( RESULTAT = MODEIC, PARA = 'FREQ', REFERENCE='ANALYTIQUE',
                CRITERE = 'RELATIF', PRECISION = 1.E-2,
                NUME_ORDRE = 1,  VALE = f1),
          _F( RESULTAT = MODEIC, PARA = 'FREQ', REFERENCE='ANALYTIQUE',
                CRITERE = 'RELATIF', PRECISION = 1.E-2,
                NUME_ORDRE = 2,  VALE = f2),
          _F( RESULTAT = MODEIC, PARA = 'FREQ', REFERENCE='ANALYTIQUE',
                CRITERE = 'RELATIF', PRECISION = 1.E-2,
                SENSIBILITE=PS[0],
                NUME_ORDRE = 1,  VALE = df1),
          _F( RESULTAT = MODEIC, PARA = 'FREQ', REFERENCE='ANALYTIQUE',
                CRITERE = 'RELATIF', PRECISION = 1.E-2,
                SENSIBILITE=PS[0],
                NUME_ORDRE = 2,  VALE = df2),
          _F( RESULTAT = MODEIC, REFERENCE='ANALYTIQUE',
                NOM_CHAM='DEPL',NOEUD='N6',NOM_CMP='DY',
                CRITERE = 'ABSOLU', PRECISION = 1.E-14,
                SENSIBILITE=PS[0],
                VALE_C=0.0+0.0j,
                NUME_ORDRE = 1, ),
          _F( RESULTAT = MODEIC, REFERENCE='ANALYTIQUE',
                NOM_CHAM='DEPL',NOEUD='N6',NOM_CMP='DY',
                CRITERE = 'ABSOLU', PRECISION = 1.E-13,
                SENSIBILITE=PS[0],
                VALE_C=0.0+0.0j,
                NUME_ORDRE = 2, ),
          ),)

MODEIC=NORM_MODE(reuse=MODEIC,MODE=MODEIC,
                  SENSIBILITE=(PS[0],),
                  NORME=('MASS_GENE',),)

TEST_RESU(RESU=(
          _F( RESULTAT = MODEIC, REFERENCE='ANALYTIQUE',
                NOM_CHAM='DEPL',NOEUD='N6',NOM_CMP='DY',
                CRITERE = 'ABSOLU', PRECISION = 1.E-16,
                SENSIBILITE=PS[0],
                VALE_C=0.0+0.0j,
                NUME_ORDRE = 1, ),
          _F( RESULTAT = MODEIC, REFERENCE='ANALYTIQUE',
                NOM_CHAM='DEPL',NOEUD='N6',NOM_CMP='DY',
                CRITERE = 'ABSOLU', PRECISION = 1.E-15,
                SENSIBILITE=PS[0],
                VALE_C=0.0+0.0j,
                NUME_ORDRE = 2, ),
          ),)

FIN()
