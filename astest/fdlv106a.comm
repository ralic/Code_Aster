# ======================================================================
# COPYRIGHT (C) 1991 - 2016  EDF R&D                  WWW.CODE-ASTER.ORG
# THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY
# IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY
# THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR
# (AT YOUR OPTION) ANY LATER VERSION.
#
# THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT
# WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF
# MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU
# GENERAL PUBLIC LICENSE FOR MORE DETAILS.
#
# YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE
# ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,
#    1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.
# ======================================================================
#      CALCUL DE DIVERS AMORTISSEMENTS AJOUTES EN ECOULEMENT
#  ANNULAIRE POTENTIEL POUR DIFFERENTES VITESSES D'ECOULEMENT
#                ECOULEMENT AMORTISSANT
#                   VITESSE CRITIQUE
#                     FLOTTEMENT
#                      CALCUL 3D
#            CALCUL MODAL COMPLEXE EN EAU AVEC TRI_DIAG ET QZ
#                   CAS TEST FDLV106A

DEBUT(CODE=_F(
              NIV_PUB_WEB='INTERNET',),
      DEBUG=_F(SDVERI='OUI',),
      IGNORE_ALARM=('MODELE1_63','MODELE1_64',),);

# <MODELE1_63> : DANS UN MODELE, IL EXISTE DES ELEMENTS DE TYPE "BORD" QUI N'ONT PAS DE VOISIN AVEC RIGIDITE
# <MODELE1_64> : DANS UN MODELE, IL N'Y A AUCUN ELEMENT AVEC AVEC RIGIDITE
#  LE MODELE PROVOQUANT CES ALARMES EST UN MODELE D'INTERFACE

PRE_IDEAS(UNITE_IDEAS=19,
          UNITE_MAILLAGE=23,);

MAYA=LIRE_MAILLAGE(UNITE=23,);

# CARACTERISTIQUES DE LA STRUCTURE: CYLINDRES CONCENTRIQUES
# SEPARES PAR UN FLUIDE ANNULAIRE

ACIER=DEFI_MATERIAU(ELAS=_F(E=2.E11,
                            NU=0.3,
                            RHO=7800.,),);

DOMSTRUC=AFFE_MATERIAU(MAILLAGE=MAYA,
                       AFFE=_F(GROUP_MA='INTERFAC',
                               MATER=ACIER,),);

STRUCTUR=AFFE_MODELE(MAILLAGE=MAYA,
                     AFFE=_F(GROUP_MA='INTERFAC',
                             PHENOMENE='MECANIQUE',
                             MODELISATION='DKT',),);

CARA=AFFE_CARA_ELEM(MODELE=STRUCTUR,
                    COQUE=_F(GROUP_MA='INTERFAC',
                             EPAIS=1.E-3,),);

CHARGS=AFFE_CHAR_MECA(MODELE=STRUCTUR,
                      DDL_IMPO=(_F(GROUP_NO='NOEXT',
                                   DX=0.,
                                   DRY=0.,
                                   DRZ=0.,),
                                _F(GROUP_NO='NOINT',
                                   DX=0.,
                                   DY=0.,
                                   DZ=0.,
                                   DRX=0.,
                                   DRY=0.,
                                   DRZ=0.,),),);

MEL_KSTR=CALC_MATR_ELEM(OPTION='RIGI_MECA',
                        MODELE=STRUCTUR,
                        CHAM_MATER=DOMSTRUC,
                        CARA_ELEM=CARA,
                        CHARGE=CHARGS,);

MEL_MSTR=CALC_MATR_ELEM(OPTION='MASS_MECA',
                        MODELE=STRUCTUR,
                        CHAM_MATER=DOMSTRUC,
                        CARA_ELEM=CARA,
                        CHARGE=CHARGS,);

NUSTR=NUME_DDL(MATR_RIGI=MEL_KSTR,);

MATASKS=ASSE_MATRICE(MATR_ELEM=MEL_KSTR,
                     NUME_DDL=NUSTR,);

MATASMS=ASSE_MATRICE(MATR_ELEM=MEL_MSTR,
                     NUME_DDL=NUSTR,);

# CARACTERISTIQUES DU FLUIDE EN ECOULEMENT
# MATERIAU (CARACTERISTIQUES THERMIQUES EQUIVALENTES)

EAU=DEFI_MATERIAU(THER=_F(LAMBDA=1.,
                          RHO_CP=1000.,),);

DOMFLUI=AFFE_MATERIAU(MAILLAGE=MAYA,
                      AFFE=(_F(GROUP_MA='FLUIDE',
                               MATER=EAU,),
                            _F(GROUP_MA='ENTREE',
                               MATER=EAU,),
                            _F(GROUP_MA='SORTIE',
                               MATER=EAU,),
                            _F(GROUP_MA='INTERFAC',
                               MATER=EAU,),),);

DOMINTER=AFFE_MATERIAU(MAILLAGE=MAYA,
                       AFFE=_F(GROUP_MA='INTERFAC',
                               MATER=EAU,),);

# MODELES FLUIDES ET INTERFACE

FLUIDE=AFFE_MODELE(MAILLAGE=MAYA,
                   AFFE=(_F(GROUP_MA='FLUIDE',
                            PHENOMENE='THERMIQUE',
                            MODELISATION='3D',),
                         _F(GROUP_MA='ENTREE',
                            PHENOMENE='THERMIQUE',
                            MODELISATION='3D',),
                         _F(GROUP_MA='SORTIE',
                            PHENOMENE='THERMIQUE',
                            MODELISATION='3D',),),);

FLUIDE2=AFFE_MODELE(MAILLAGE=MAYA,
                    AFFE=(_F(GROUP_MA='FLUIDE',
                             PHENOMENE='THERMIQUE',
                             MODELISATION='3D',),
                          _F(GROUP_MA='INTERFAC',
                             PHENOMENE='THERMIQUE',
                             MODELISATION='3D',),),);

INTERFAC=AFFE_MODELE(MAILLAGE=MAYA,
                     AFFE=_F(GROUP_MA='INTERFAC',
                             PHENOMENE='THERMIQUE',
                             MODELISATION='3D',),);

# DIRICHLET POUR LES PROBLEMES POTENTIELS INSTATIONNAIRES

CL2=AFFE_CHAR_THER(MODELE=FLUIDE2,
                   TEMP_IMPO=_F(GROUP_NO='TEMPIMPO',
                                TEMP=0.,),);

# CALCUL DU POTENTIEL DES VITESSES A 4 M/S (ECOULEMENT AMORTISSANT)

CL=AFFE_CHAR_THER(MODELE=FLUIDE,
                  TEMP_IMPO=_F(GROUP_NO='NOSORT',
                               TEMP=0.,),
                  FLUX_REP=(_F(GROUP_MA='ENTREE',
                               FLUN=-4.,),
                            _F(GROUP_MA='SORTIE',
                               FLUN=4.,),),);

PHIBAR=THER_LINEAIRE(MODELE=FLUIDE,
                     CHAM_MATER=DOMFLUI,
                     EXCIT=_F(CHARGE=CL,),);

# CALCUL DU POTENTIEL DES VITESSES A 4.24 M/S (VITESSE CRITIQUE)

CLCRIT=AFFE_CHAR_THER(MODELE=FLUIDE,
                      TEMP_IMPO=_F(GROUP_NO='NOSORT',
                                   TEMP=0.,),
                      FLUX_REP=(_F(GROUP_MA='ENTREE',
                                   FLUN=-4.24,),
                                _F(GROUP_MA='SORTIE',
                                   FLUN=4.24,),),);

PHIBCRIT=THER_LINEAIRE(MODELE=FLUIDE,
                       CHAM_MATER=DOMFLUI,
                       EXCIT=_F(CHARGE=CLCRIT,),);

# CALCUL DU POTENTIEL DES VITESSES A 6 M/S (FLOTTEMENT)

CLFLOT=AFFE_CHAR_THER(MODELE=FLUIDE,
                      TEMP_IMPO=_F(GROUP_NO='NOSORT',
                                   TEMP=0.,),
                      FLUX_REP=(_F(GROUP_MA='ENTREE',
                                   FLUN=-6.,),
                                _F(GROUP_MA='SORTIE',
                                   FLUN=6.,),),);

PHIBFLOT=THER_LINEAIRE(MODELE=FLUIDE,
                       CHAM_MATER=DOMFLUI,
                       EXCIT=_F(CHARGE=CLFLOT,),);

# AFFECTATION DU DEPLACEMENT AU CYLINDRE EXTERNE
# ROTATION AUTOUR D UN PIVOT EN AVAL DE L ECOULEMENT

CHAMNO=CREA_CHAMP(TYPE_CHAM='NOEU_DEPL_R',
                  NUME_DDL=NUSTR,
                  OPERATION='AFFE', PROL_ZERO='OUI',
                  MAILLAGE=MAYA,
                  AFFE=(
                  _F(GROUP_NO='NOINT',
                     NOM_CMP=('DX','DY','DZ',),
                     VALE=(0.,0.,0.,),),
                  _F(GROUP_NO='GRNO5',
                     NOM_CMP=('DX','DY','DZ',),
                     VALE=(0.,0.,0.,),),
                  _F(GROUP_NO='GRNO4',
                     NOM_CMP=('DX','DY','DZ',),
                     VALE=(12.5,0.,0.,),),
                  _F(GROUP_NO='GRNO3',
                     NOM_CMP=('DX','DY','DZ',),
                     VALE=(25.,0.,0.,),),
                  _F(GROUP_NO='GRNO2',
                     NOM_CMP=('DX','DY','DZ',),
                     VALE=(37.5,0.,0.,),),
                  _F(GROUP_NO='GRNO1',
                     NOM_CMP=('DX','DY','DZ',),
                     VALE=(50.,0.,0.,),),),);

# MASSE ET AMORTISSEMENT AJOUTES A 4 M/S

AMOR=CALC_MATR_AJOU(MODELE_FLUIDE=FLUIDE2,
                    MODELE_INTERFACE=INTERFAC,
                    CHAM_MATER=DOMFLUI,
                    CHARGE=CL2,
                    CHAM_NO=CHAMNO,
                    OPTION='AMOR_AJOU',
                    POTENTIEL=PHIBAR,
                    SOLVEUR=_F(METHODE='GCPC',),);

MASS=CALC_MATR_AJOU(MODELE_FLUIDE=FLUIDE2,
                    MODELE_INTERFACE=INTERFAC,
                    CHAM_MATER=DOMFLUI,
                    CHARGE=CL2,
                    CHAM_NO=CHAMNO,
                    OPTION='MASS_AJOU',
                    POTENTIEL=PHIBAR,
                    SOLVEUR=_F(METHODE='GCPC',PRE_COND='LDLT_SP'),);

RIGI=CALC_MATR_AJOU(MODELE_FLUIDE=FLUIDE2,
                    MODELE_INTERFACE=INTERFAC,
                    CHAM_MATER=DOMFLUI,
                    CHARGE=CL2,
                    CHAM_NO=CHAMNO,
                    OPTION='RIGI_AJOU',
                    POTENTIEL=PHIBAR,
                    SOLVEUR=_F(METHODE='GCPC',),);

ENGENDRE_TEST(FORMAT='OBJET',
              CO=(MASS,RIGI,AMOR,),);

# validation du resultat de ENGENDRE_TEST :
TEST_RESU(OBJET=(
_F(NOM='MASS               .CONL',VALE_CALC= 1.0000000000000E+00,),
_F(NOM='MASS          .SMOS.SMDI',VALE_CALC_I=              1       ,),
_F(NOM='MASS          .SMOS.SMDE',VALE_CALC_I=              3       ,),
_F(NOM='RIGI               .CONL',VALE_CALC= 1.0000000000000E+00,),
_F(NOM='RIGI          .SMOS.SMDI',VALE_CALC_I=              1       ,),
_F(NOM='RIGI          .SMOS.SMDE',VALE_CALC_I=              3       ,),
_F(NOM='AMOR               .CONL',VALE_CALC= 1.0000000000000E+00,),
_F(NOM='AMOR          .SMOS.SMDI',VALE_CALC_I=              1       ,),
_F(NOM='AMOR          .SMOS.SMDE',VALE_CALC_I=              3       ,),
))

#TESTS DES VALEURS DES MATRICES D'AMORTISSEMENT ET DE MASSE AJOUTES
#NE COMPRENNENT QU'UN ELEMENT

TEST_RESU(OBJET=(_F(VALE_CALC= 1.66014403E+09,
                    VALE_REFE=1.666800000E9,
                    REFERENCE='NON_DEFINI',
                    NOM='MASS               .VALM',
                    PRECISION=1.E-2,),
                 _F(VALE_CALC=-3.96644423E+08,
                    VALE_REFE=-4.00040000E8,
                    REFERENCE='NON_DEFINI',
                    NOM='AMOR               .VALM',
                    PRECISION=1.E-2,),
                 ),
          )

#NOUVELLE METHODE AVEC MACRO_MATR_AJOU

MACRO_MATR_AJOU(MAILLAGE=MAYA,
                GROUP_MA_FLUIDE='FLUIDE',
                GROUP_MA_INTERF='INTERFAC',
                MODELISATION='3D',
                FLUIDE=_F(RHO=1000.0,),
                DDL_IMPO=(_F(GROUP_NO='TEMPIMPO',
                             PRES_FLUIDE=0.0,),
                          _F(GROUP_NO='NOSORT',
                             PRES_SORTIE=0.0,),),
                ECOULEMENT=_F(GROUP_MA_1='ENTREE',
                              GROUP_MA_2='SORTIE',
                              VNOR_1=-4.0,
                              VNOR_2=4.0,),
                DEPL_IMPO=CHAMNO,
                MATR_MASS_AJOU=CO('MASSAJ'),
                MATR_RIGI_AJOU=CO('RIGIAJ'),
                MATR_AMOR_AJOU=CO('AMORAJ'),
                SOLVEUR=_F(METHODE='GCPC',),
                INFO=2,);

# MASSE ET AMORTISSEMENT AJOUTES A 4.24 M/S

AMORCRIT=CALC_MATR_AJOU(MODELE_FLUIDE=FLUIDE2,
                        MODELE_INTERFACE=INTERFAC,
                        CHAM_MATER=DOMFLUI,
                        CHARGE=CL2,
                        CHAM_NO=CHAMNO,
                        OPTION='AMOR_AJOU',
                        POTENTIEL=PHIBCRIT,
                        SOLVEUR=_F(METHODE='LDLT',),);

MASSCRIT=CALC_MATR_AJOU(MODELE_FLUIDE=FLUIDE2,
                        MODELE_INTERFACE=INTERFAC,
                        CHAM_MATER=DOMFLUI,
                        CHARGE=CL2,
                        CHAM_NO=CHAMNO,
                        OPTION='MASS_AJOU',
                        POTENTIEL=PHIBCRIT,
                        SOLVEUR=_F(METHODE='LDLT',),);

ENGENDRE_TEST(FORMAT='OBJET',
              CO=(MASSCRIT,AMORCRIT,),);

TEST_RESU(OBJET=(_F(VALE_CALC= 1.66014403E+09,
                    NOM='MASSCRIT           .VALM',),
                 _F(VALE_CALC=-4.20443084E+08,
                    NOM='AMORCRIT           .VALM',),
                 ),
          )

# MASSE ET AMORTISSEMENT AJOUTES A 6 M/S

AMORFLOT=CALC_MATR_AJOU(MODELE_FLUIDE=FLUIDE2,
                        MODELE_INTERFACE=INTERFAC,
                        CHAM_MATER=DOMFLUI,
                        CHARGE=CL2,
                        CHAM_NO=CHAMNO,
                        OPTION='AMOR_AJOU',
                        POTENTIEL=PHIBFLOT,
                        SOLVEUR=_F(METHODE='MULT_FRONT',),);

MASSFLOT=CALC_MATR_AJOU(MODELE_FLUIDE=FLUIDE2,
                        MODELE_INTERFACE=INTERFAC,
                        CHAM_MATER=DOMFLUI,
                        CHARGE=CL2,
                        CHAM_NO=CHAMNO,
                        OPTION='MASS_AJOU',
                        POTENTIEL=PHIBFLOT,
                        SOLVEUR=_F(METHODE='MULT_FRONT',),);

TEST_RESU(OBJET=(_F(VALE_CALC= 1.66014403E+09,
                    VALE_REFE=1.666800000E9,
                    REFERENCE='NON_DEFINI',
                    NOM='MASSFLOT           .VALM',
                    PRECISION=1.E-2,),
                 _F(VALE_CALC=-5.94966629E+08,
                    VALE_REFE=-6.00060000E8,
                    REFERENCE='NON_DEFINI',
                    NOM='AMORFLOT           .VALM',
                    PRECISION=1.E-2,),
                 ),
          )

# SYSTEME A UN DDL EQUIVALENT SUR LEQUEL ON CALCULE LES MODES
# COMPLEXES

PRE_IDEAS(UNITE_IDEAS=21,
          UNITE_MAILLAGE=22,);

MAYA2=LIRE_MAILLAGE(UNITE=22,);

SYSTEQ=AFFE_MODELE(MAILLAGE=MAYA2,
                   AFFE=_F(TOUT='OUI',
                           PHENOMENE='MECANIQUE',
                           MODELISATION='DIS_T',),);

# MODE COMPLEXE AVEC AMORTISSEMENT FLUIDE

CARAC=AFFE_CARA_ELEM(MODELE=SYSTEQ,
                     DISCRET=(_F(CARA='M_T_N',
                                 GROUP_MA='MASS',
                                 VALE=(1.645E9,0.,1.645E9,0.,0.,1.645E9,),),
                              _F(CARA='K_T_N',
                                 GROUP_MA='MASS',
                                 VALE=(0.,0.,0.,0.,0.,0.),),
                              _F(CARA='A_T_N',
                                 GROUP_MA='MASS',
                                 VALE=(0.,0.,0.,0.,0.,0.),),
                              _F(CARA='K_T_D_L',
                                 GROUP_MA='RESSORT',
                                 VALE=(1.E13,1.E13,1.E13,),),
                              _F(CARA='A_T_D_L',
                                 GROUP_MA='DASHPOT',
                                 VALE=(2.8E7,2.8E7,2.8E7,),),),);

ENCASTR=AFFE_CHAR_MECA(MODELE=SYSTEQ,
                       DDL_IMPO=(_F(GROUP_NO='ENCAST',
                                    DX=0.,
                                    DY=0.,
                                    DZ=0.,),
                                 _F(GROUP_NO='GUIDE',
                                    DY=0.,
                                    DZ=0.,),),);

RIGIELEM=CALC_MATR_ELEM(OPTION='RIGI_MECA',
                        MODELE=SYSTEQ,
                        CARA_ELEM=CARAC,
                        CHARGE=ENCASTR,);

MASSELEM=CALC_MATR_ELEM(OPTION='MASS_MECA',
                        MODELE=SYSTEQ,
                        CARA_ELEM=CARAC,
                        CHARGE=ENCASTR,);

AMORELEM=CALC_MATR_ELEM(OPTION='AMOR_MECA',
                        MODELE=SYSTEQ,
                        CARA_ELEM=CARAC,
                        CHARGE=ENCASTR,);

NUMERO=NUME_DDL(MATR_RIGI=RIGIELEM,);

RAIDEUR=ASSE_MATRICE(MATR_ELEM=RIGIELEM,
                     NUME_DDL=NUMERO,);

MASSE=ASSE_MATRICE(MATR_ELEM=MASSELEM,
                   NUME_DDL=NUMERO,);

AMORT=ASSE_MATRICE(MATR_ELEM=AMORELEM,
                   NUME_DDL=NUMERO,);

MODBIS=CALC_MODES(MATR_RIGI=RAIDEUR,
                  VERI_MODE=_F(SEUIL=1.E-2,
                               ),
                  MATR_AMOR=AMORT,
                  MATR_MASS=MASSE,
                  SOLVEUR_MODAL=_F(METHODE='TRI_DIAG',
                                   ),
                  )

# AVEC QZ + OPTION='PLUS_PETITE' + 'QZ_SIMPLE'

MODBISZ=CALC_MODES(MATR_RIGI=RAIDEUR,
                   VERI_MODE=_F(SEUIL=1.E-2,
                                ),
                   MATR_AMOR=AMORT,
                   MATR_MASS=MASSE,
                   SOLVEUR_MODAL=_F(METHODE='QZ',
                                    ),
                   )

# MODE COMPLEXE A VITESSE CRITIQUE

CARACRIT=AFFE_CARA_ELEM(MODELE=SYSTEQ,
                        DISCRET=(_F(CARA='M_T_N',
                                    GROUP_MA='MASS',
                                    VALE=(1.645E9,0.,1.645E9,0.,0.,1.645E9,),),
                                 _F(CARA='K_T_N',
                                    GROUP_MA='MASS',
                                    VALE=(0.,0.,0.,0.,0.,0.,),),
                                 _F(CARA='A_T_N',
                                    GROUP_MA='MASS',
                                    VALE=(0.,0.,0.,0.,0.,0.,),),
                                 _F(CARA='K_T_D_L',
                                    GROUP_MA='RESSORT',
                                    VALE=(1.E13,1.E13,1.E13,),),
                                 _F(CARA='A_T_D_L',
                                    GROUP_MA='DASHPOT',
                                    VALE=(3.56E6,3.56E6,3.56E6,),),),);

RIGELCR=CALC_MATR_ELEM(OPTION='RIGI_MECA',
                       MODELE=SYSTEQ,
                       CARA_ELEM=CARACRIT,
                       CHARGE=ENCASTR,);

MASELCR=CALC_MATR_ELEM(OPTION='MASS_MECA',
                       MODELE=SYSTEQ,
                       CARA_ELEM=CARACRIT,
                       CHARGE=ENCASTR,);

AMELCR=CALC_MATR_ELEM(OPTION='AMOR_MECA',
                      MODELE=SYSTEQ,
                      CARA_ELEM=CARACRIT,
                      CHARGE=ENCASTR,);

NUMCR=NUME_DDL(MATR_RIGI=RIGELCR,);

RAIDCR=ASSE_MATRICE(MATR_ELEM=RIGELCR,
                    NUME_DDL=NUMCR,);

MASSCR=ASSE_MATRICE(MATR_ELEM=MASELCR,
                    NUME_DDL=NUMCR,);

AMORCR=ASSE_MATRICE(MATR_ELEM=AMELCR,
                    NUME_DDL=NUMCR,);

MODCRIT=CALC_MODES(MATR_RIGI=RAIDCR,
                   VERI_MODE=_F(SEUIL=1.E-2,
                                ),
                   MATR_AMOR=AMORCR,
                   MATR_MASS=MASSCR,
                   SOLVEUR_MODAL=_F(METHODE='TRI_DIAG',
                                    ),
                   )

# AVEC QZ + OPTION='PLUS_PETITE' + 'QZ_SIMPLE'

MODCRITZ=CALC_MODES(MATR_RIGI=RAIDCR,
                    VERI_MODE=_F(SEUIL=1.E-2,
                                 ),
                    MATR_AMOR=AMORCR,
                    MATR_MASS=MASSCR,
                    SOLVEUR_MODAL=_F(METHODE='QZ',
                                     ),
                    )

# MODE COMPLEXE AU FLOTTEMENT

CARAFLOT=AFFE_CARA_ELEM(MODELE=SYSTEQ,
                        DISCRET=(_F(CARA='M_T_N',
                                    GROUP_MA='MASS',
                                    VALE=(1.645E9,0.,1.645E9,0.,0.,1.645E9,),),
                                 _F(CARA='K_T_N',
                                    GROUP_MA='MASS',
                                    VALE=(0.,0.,0.,0.,0.,0.,),),
                                 _F(CARA='A_T_N',
                                    GROUP_MA='MASS',
                                    VALE=(0.,0.,0.,0.,0.,0.,),),
                                 _F(CARA='K_T_D_L',
                                    GROUP_MA='RESSORT',
                                    VALE=(1.E13,1.E13,1.E13,),),
                                 _F(CARA='A_T_D_L',
                                    GROUP_MA='DASHPOT',
                                    VALE=(-1.7E8,-1.7E8,-1.7E8,),),),);

RIGELFL=CALC_MATR_ELEM(OPTION='RIGI_MECA',
                       MODELE=SYSTEQ,
                       CARA_ELEM=CARAFLOT,
                       CHARGE=ENCASTR,);

MASELFL=CALC_MATR_ELEM(OPTION='MASS_MECA',
                       MODELE=SYSTEQ,
                       CARA_ELEM=CARAFLOT,
                       CHARGE=ENCASTR,);

AMELFL=CALC_MATR_ELEM(OPTION='AMOR_MECA',
                      MODELE=SYSTEQ,
                      CARA_ELEM=CARAFLOT,
                      CHARGE=ENCASTR,);

NUMFL=NUME_DDL(MATR_RIGI=RIGELFL,);

RAIDFL=ASSE_MATRICE(MATR_ELEM=RIGELFL,
                    NUME_DDL=NUMFL,);

MASSFL=ASSE_MATRICE(MATR_ELEM=MASELFL,
                    NUME_DDL=NUMFL,);

AMORFL=ASSE_MATRICE(MATR_ELEM=AMELFL,
                    NUME_DDL=NUMFL,);

MODFLOT=CALC_MODES(MATR_RIGI=RAIDFL,
                   VERI_MODE=_F(SEUIL=1.E-2,
                                ),
                   MATR_AMOR=AMORFL,
                   MATR_MASS=MASSFL,
                   SOLVEUR_MODAL=_F(METHODE='TRI_DIAG',
                                    ),
                   )

# AVEC QZ + OPTION='PLUS_PETITE' + 'QZ_SIMPLE'

MODFLOTZ=CALC_MODES(MATR_RIGI=RAIDFL,
                    VERI_MODE=_F(SEUIL=1.E-2,
                                 ),
                    MATR_AMOR=AMORFL,
                    MATR_MASS=MASSFL,
                    SOLVEUR_MODAL=_F(METHODE='QZ',
                                     ),
                    )

TEST_RESU(RESU=(_F(NUME_ORDRE=1,
                   PARA='FREQ',
                   REFERENCE='ANALYTIQUE',
                   RESULTAT=MODBIS,
                   VALE_CALC=12.409011239,
                   VALE_REFE=12.5,
                   CRITERE='RELATIF',
                   PRECISION=1.E-2,),
                _F(NUME_ORDRE=1,
                   PARA='AMOR_REDUIT',
                   REFERENCE='ANALYTIQUE',
                   RESULTAT=MODBIS,
                   VALE_CALC= 1.09155365E-04,
                   VALE_REFE=1.1E-4,
                   CRITERE='RELATIF',
                   PRECISION=1.E-2,),
                _F(NUME_ORDRE=1,
                   PARA='FREQ',
                   REFERENCE='ANALYTIQUE',
                   RESULTAT=MODCRIT,
                   VALE_CALC=12.409011312,
                   VALE_REFE=12.5,
                   CRITERE='RELATIF',
                   PRECISION=1.E-2,),
                _F(NUME_ORDRE=1,
                   PARA='AMOR_REDUIT',
                   REFERENCE='ANALYTIQUE',
                   RESULTAT=MODCRIT,
                   VALE_CALC= 1.38783249E-05,
                   VALE_REFE=1.38E-05,
                   CRITERE='RELATIF',
                   PRECISION=1.E-2,),
                _F(NUME_ORDRE=1,
                   PARA='FREQ',
                   REFERENCE='ANALYTIQUE',
                   RESULTAT=MODFLOT,
                   VALE_CALC=12.409008588,
                   VALE_REFE=12.5,
                   CRITERE='RELATIF',
                   PRECISION=1.E-2,),
                _F(NUME_ORDRE=1,
                   PARA='AMOR_REDUIT',
                   REFERENCE='ANALYTIQUE',
                   RESULTAT=MODFLOT,
                   VALE_CALC=-6.62728999E-04,
                   VALE_REFE=-6.6E-4,
                   CRITERE='RELATIF',
                   PRECISION=1.E-2,),
                ),
          )

# POUR QZ

TEST_RESU(RESU=(_F(NUME_ORDRE=1,
                   PARA='FREQ',
                   REFERENCE='ANALYTIQUE',
                   RESULTAT=MODBISZ,
                   VALE_CALC=12.409011239,
                   VALE_REFE=12.5,
                   CRITERE='RELATIF',
                   PRECISION=1.E-2,),
                _F(NUME_ORDRE=1,
                   PARA='AMOR_REDUIT',
                   REFERENCE='ANALYTIQUE',
                   RESULTAT=MODBISZ,
                   VALE_CALC= 1.09155365E-04,
                   VALE_REFE=1.1E-4,
                   CRITERE='RELATIF',
                   PRECISION=1.E-2,),
                _F(NUME_ORDRE=1,
                   PARA='FREQ',
                   REFERENCE='ANALYTIQUE',
                   RESULTAT=MODCRITZ,
                   VALE_CALC=12.409011312,
                   VALE_REFE=12.5,
                   CRITERE='RELATIF',
                   PRECISION=1.E-2,),
                _F(NUME_ORDRE=1,
                   PARA='AMOR_REDUIT',
                   REFERENCE='ANALYTIQUE',
                   RESULTAT=MODCRITZ,
                   VALE_CALC= 1.38783249E-05,
                   VALE_REFE=1.38E-05,
                   CRITERE='RELATIF',
                   PRECISION=1.E-2,),
                _F(NUME_ORDRE=1,
                   PARA='FREQ',
                   REFERENCE='ANALYTIQUE',
                   RESULTAT=MODFLOTZ,
                   VALE_CALC=12.409008588,
                   VALE_REFE=12.5,
                   CRITERE='RELATIF',
                   PRECISION=1.E-2,),
                _F(NUME_ORDRE=1,
                   PARA='AMOR_REDUIT',
                   REFERENCE='ANALYTIQUE',
                   RESULTAT=MODFLOTZ,
                   VALE_CALC=-6.62728999E-04,
                   VALE_REFE=-6.6E-4,
                   CRITERE='RELATIF',
                   PRECISION=1.E-2,),
                ),
          )

FIN();
