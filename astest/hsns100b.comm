# MODIF  DATE 28/05/2004   AUTEUR LEBOUVIE F.LEBOUVIER 
# TITRE PLAQUE SOUMISE A UN GRADIENT DE TEMPERATURE DANS L'EPAISSEUR
#            CONFIGURATION MANAGEMENT OF EDF VERSION
# ======================================================================
# COPYRIGHT (C) 1991 - 2001  EDF R&D                  WWW.CODE-ASTER.ORG
# THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY
# IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY
# THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR   
# (AT YOUR OPTION) ANY LATER VERSION.                                 
#
# THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT 
# WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF          
# MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU    
# GENERAL PUBLIC LICENSE FOR MORE DETAILS.                            
#
# YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE   
# ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,       
#    1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.      
# ======================================================================
#CAS_TEST__: HSNS100B
# ----------------------------------------------------------------------
# MODELISATION : DKT ET COQUE_3D
# ----------------------------------------------------------------------
#

DEBUT(CODE=_F(  NOM = 'HSNS100B',NIV_PUB_WEB='INTERNET') )

M=LIRE_MAILLAGE( )

M=DEFI_GROUP( reuse=M,   MAILLAGE=M,
  CREA_GROUP_MA=_F(  NOM = 'TOUT', TOUT = 'OUI'))

M=DEFI_GROUP(reuse=M,  MAILLAGE=M,
        CREA_GROUP_NO=_F( TOUT_GROUP_MA = 'OUI'))

TEMPZ1=DEFI_NAPPE(    # RELEVE DE TEMPERATURE SUR LA ZONE=ZONE1
          NOM_RESU='TEMP',
           NOM_PARA='INST',  NOM_PARA_FONC='EPAIS',
           PARA=(0.,10.,),DEFI_FONCTION=(

            _F( VALE = (-.05,-50.,   .05,50.,)),   # PROFIL A T=1.
            _F( VALE = (-.05,-50.,   .05,50.,)))   # PROFIL A T=10.
        )

TEMPZ2=DEFI_NAPPE(   # RELEVE DE TEMPERATURE SUR LA ZONE=ZONE2
          NOM_RESU='TEMP',
           NOM_PARA='INST',  NOM_PARA_FONC='EPAIS',
           PARA=(0.,10.,),DEFI_FONCTION=(

            _F( VALE = (-.05,-50.,   .05,50.,)),   # PROFIL A T=1.
            _F( VALE = (-.05,-50.,   .05,50.,)))   # PROFIL A T=10.
        )

#  PUIS ON FABRIQUE UNE CARTE ( DE TEMP_F) AVEC CES 2 NAPPES :
TEMPER=CREA_CHAMP(OPERATION='AFFE', TYPE_CHAM='CART_TEMP_F',
MAILLAGE=M,AFFE=(
        _F(   TOUT = 'OUI',        NOM_CMP = 'TEMP',  VALE_F = TEMPZ1),
        _F(   MAILLE = ('M1','M2','M7',), NOM_CMP = 'TEMP',  VALE_F = TEMPZ2))
        )

MO=AFFE_MODELE(    MAILLAGE=M,AFFE=(
       # TRIA3 : DKT
       _F( MAILLE = ('M1','M2',),
       PHENOMENE = 'MECANIQUE', MODELISATION = 'DKT'),
       # QUAD4 : DKQ
       _F( MAILLE = ('M3',),
       PHENOMENE = 'MECANIQUE', MODELISATION = 'DKT'),
       # TRIA7 : MEC3TR7H
       _F( MAILLE = ('M4','M5',),
       PHENOMENE = 'MECANIQUE', MODELISATION = 'COQUE_3D'),
       # QUAD9 : MEC3QU9H
       _F( MAILLE = ('M6',),
       PHENOMENE = 'MECANIQUE', MODELISATION = 'COQUE_3D'))
  )

CARAC=AFFE_CARA_ELEM(  MODELE=MO,
           COQUE=_F( COQUE_NCOU=5,
       GROUP_MA = 'TOUT',
 EPAIS = 0.10,  A_CIS = 1.E+5) )

ACIER=DEFI_MATERIAU(       ELAS=_F( E = 2.,  NU = 0.3, ALPHA = 1.E-2),
           ECRO_LINE=_F( D_SIGM_EPSI = .2, SY = 10000.) )

CM=AFFE_MATERIAU(   MAILLAGE=M,
       AFFE=_F( TOUT = 'OUI', MATER = ACIER, TEMP_REF = 20.))

CH_LA=AFFE_CHAR_MECA(   MODELE=MO,
         TEMP_CALCULEE=TEMPER,DDL_IMPO=(
        _F( TOUT = 'OUI', DRZ = 0.),
        _F( GROUP_NO = 'BOUT1', DX = 0., DY = 0., DRZ = 0.),
        _F( GROUP_NO = 'BOUT1', DRX = 0.,DRY = 0.,DZ = 0.))
           )

CH_FO=AFFE_CHAR_MECA(    MODELE=MO,

         FORCE_NODALE=_F( GROUP_NO = 'BOUT2',   FX = 1.0000, FY = 1.0000, FZ = 1.0000)
         )

RAMPE=DEFI_FONCTION(   NOM_PARA='INST',
           PROL_GAUCHE='LINEAIRE',  PROL_DROITE='LINEAIRE',
           VALE=(0.0,0.0,1.0,1.0,))

L_INST=DEFI_LIST_REEL(  DEBUT=0.0,
              INTERVALLE=_F( JUSQU_A = 1.0,      NOMBRE = 3) )

U2=STAT_NON_LINE(
                            MODELE=MO,
                        CHAM_MATER=CM,
                         CARA_ELEM=CARAC,EXCIT=(
                             _F(
                CHARGE = CH_FO,
                FONC_MULT = RAMPE), _F(
                CHARGE = CH_LA)),
                         COMP_INCR=_F( RELATION = 'VMIS_ISOT_LINE', ),
                         INCREMENT=_F(
                LIST_INST = L_INST,
                NUME_INST_FIN = 2),
                            NEWTON=_F(
                MATRICE = 'ELASTIQUE'),
                       CONVERGENCE=_F(
                ITER_GLOB_MAXI = 30,
                ITER_INTE_MAXI = 30,
                RESI_INTE_RELA = 1.E-8)
              )

U2=CALC_ELEM( reuse=U2,
                            OPTION=(
                  'SIEF_ELNO_ELGA',  'VARI_ELNO_ELGA',),
                          RESULTAT=U2,
              )

U2=STAT_NON_LINE( reuse=U2,
                            MODELE=MO,
                        CHAM_MATER=CM,
                         CARA_ELEM=CARAC,EXCIT=(
                             _F(
                CHARGE = CH_FO,
                FONC_MULT = RAMPE), _F(
                CHARGE = CH_LA)),
                         COMP_INCR=_F( RELATION = 'VMIS_ISOT_LINE', ),
                         ETAT_INIT=_F(
                EVOL_NOLI = U2,
                NUME_ORDRE = 2),
                         INCREMENT=_F(
                LIST_INST = L_INST,
                NUME_INST_FIN = 3),
                            NEWTON=_F(
                MATRICE = 'TANGENTE',
                REAC_ITER = 2),
                       CONVERGENCE=_F(
                ITER_INTE_MAXI = 30,
                RESI_INTE_RELA = 1.E-8)
              )

U2=CALC_ELEM( reuse=U2,
                            OPTION=(
                  'SIEF_ELNO_ELGA',  'VARI_ELNO_ELGA',),
                          RESULTAT=U2,
                        NUME_ORDRE=3,
              )

U2=CALC_ELEM( reuse=U2,   RESULTAT=U2,
                 
                    TOUT_ORDRE='OUI',
                 NUME_COUCHE=1,  NIVE_COUCHE='SUP',
                  OPTION='EPSI_ELNO_DEPL'
                    )

#L'OPTION DEGE_ELNO_DEPL N'EXISTE PAS POUR LES ELEMENTS COQUE
#NECESSITE DE REPARTIR LES OPTIONS SUIVANT LES ELEMENTS

U2=CALC_ELEM( reuse=U2,   RESULTAT=U2,
                 
                  MAILLE=('M1','M2','M3',),
                 TOUT_ORDRE='OUI',
                 NUME_COUCHE=1,  NIVE_COUCHE='SUP',
                  OPTION='DEGE_ELNO_DEPL'
                    )

TEST_RESU(RESU=(

# DEPL :
  _F( RESULTAT = U2,NOM_CHAM = 'DEPL',NUME_ORDRE = 3,
        NOEUD = 'N1',  NOM_CMP = 'DY', VALE = 1.10831E+02,
        REFERENCE='NON_REGRESSION',),
  _F( RESULTAT = U2,NOM_CHAM = 'DEPL',NUME_ORDRE = 3,
        NOEUD = 'N1',   NOM_CMP = 'DZ', VALE = 1.1379E+05,
        REFERENCE='NON_REGRESSION',),
  _F( RESULTAT = U2,NOM_CHAM = 'DEPL',NUME_ORDRE = 3,
        NOEUD = 'N17',  NOM_CMP = 'DRY', VALE = -1.9616E+04,
        REFERENCE='NON_REGRESSION',),

# EPSI_ELNO_DEPL :
  _F( RESULTAT = U2,NOM_CHAM = 'EPSI_ELNO_DEPL',NUME_ORDRE = 3, REFERENCE='NON_REGRESSION',
        MAILLE = 'M1', NOEUD = 'N16', NOM_CMP = 'EPXY', VALE = -8.590736E+00),
  _F( RESULTAT = U2,NOM_CHAM = 'EPSI_ELNO_DEPL',NUME_ORDRE = 3, REFERENCE='NON_REGRESSION',
        MAILLE = 'M5', NOEUD = 'N12',  NOM_CMP = 'EPXY', VALE = -8.575944E+01),

# SIEF_ELGA :
  _F( RESULTAT = U2,NOM_CHAM = 'SIEF_ELGA',NUME_ORDRE = 3, REFERENCE='NON_REGRESSION',
        MAILLE = 'M1', POINT = 1, SOUS_POINT=1,NOM_CMP = 'SIXX',  VALE = -5.57986E+02),
  _F( RESULTAT = U2,NOM_CHAM = 'SIEF_ELGA',NUME_ORDRE = 3, REFERENCE='NON_REGRESSION',
        MAILLE = 'M1', POINT = 1, SOUS_POINT=6, NOM_CMP = 'SIXX', VALE = -1.08505E+02),
  _F( RESULTAT = U2,NOM_CHAM = 'SIEF_ELGA',NUME_ORDRE = 3, REFERENCE='NON_REGRESSION',
#       cache dans SIXY du sous_point 16, il y a MXX :
        MAILLE = 'M1', POINT = 3, SOUS_POINT=16,NOM_CMP = 'SIXY', VALE = -6.74340E+02),
  _F( RESULTAT = U2,NOM_CHAM = 'SIEF_ELGA',NUME_ORDRE = 3, REFERENCE='NON_REGRESSION',
        MAILLE = 'M5', POINT = 1, SOUS_POINT=14, NOM_CMP = 'SIYY', VALE = -1.6665E+02),

# SIEF_ELNO_ELGA :
  _F( RESULTAT = U2,NOM_CHAM = 'SIEF_ELNO_ELGA',NUME_ORDRE = 3, REFERENCE='NON_REGRESSION',
        MAILLE = 'M1', NOEUD = 'N8', NOM_CMP = 'MXX', VALE = 3.594152E+00),
  _F( RESULTAT = U2,NOM_CHAM = 'SIEF_ELNO_ELGA',NUME_ORDRE = 3, REFERENCE='NON_REGRESSION',
        MAILLE = 'M5', NOEUD = 'Z2',  NOM_CMP = 'NXY', VALE = -7.83839E-01),

# DEGE_ELNO_DEPL :
  _F( RESULTAT = U2,NOM_CHAM = 'DEGE_ELNO_DEPL',NUME_ORDRE = 3, REFERENCE='NON_REGRESSION',
        MAILLE = 'M1', NOEUD = 'N8', NOM_CMP = 'GAX', VALE = -9.358623E+00),

# VARI_ELGA :
  _F( RESULTAT = U2,NOM_CHAM = 'VARI_ELGA',NUME_ORDRE = 3, REFERENCE='NON_REGRESSION',
        MAILLE = 'M5', POINT = 1, NOM_CMP = 'V1',  VALE = 0.0E0,
        CRITERE = 'ABSOLU'))
                           )

#==================================================================================
# pour tester les valeurs propres de la matrice de rigidite d'un DKT
# (test de l'option 'MASS_ID_MDEP_R')
#----------------------------------------------------------------------------------
MO2=AFFE_MODELE(MAILLAGE=M,AFFE=_F(MAILLE='M1',PHENOMENE='MECANIQUE',MODELISATION='DKT'))

CARA2=AFFE_CARA_ELEM(  MODELE=MO2, COQUE=_F(MAILLE = ('M1',),EPAIS = 0.10, A_CIS= 1.E+5) )

CHARG2=AFFE_CHAR_MECA(  MODELE=MO2,
    DDL_IMPO= (_F( NOEUD='N8',DX=0.,DY=0.,DZ=0.,DRX=0.,DRY=0.,),
               _F( NOEUD='N16',DX=0.,),
               _F( NOEUD=('N8','N16','N10',),DRZ=0.,),
               ),)

MACRO_MATR_ASSE(  MODELE=MO2, CHAM_MATER=CM, NUME_DDL=CO("NUM2"), CHARGE=CHARG2, CARA_ELEM=CARA2,
                  MATR_ASSE=(  _F(  MATRICE = CO("MATASK"), OPTION = 'RIGI_MECA',),
                               _F(  MATRICE = CO("MATASM"), OPTION = 'MASS_ID_MDEP_R'),
                                 ) )

MODES=MODE_ITER_SIMULT( MATR_A=MATASK,  MATR_B=MATASM,  METHODE='SORENSEN',
                       CALC_FREQ=_F(NMAX_FREQ=10,),  VERI_MODE=_F( STURM='NON',),
                      )


TEST_RESU(RESU=_F(RESULTAT=MODES,PARA='FREQ',NUME_ORDRE=2,VALE=7.51896819E-04,REFERENCE='NON_REGRESSION'))
TEST_RESU(RESU=_F(RESULTAT=MODES,PARA='FREQ',NUME_ORDRE=3,VALE=1.44468427E-03,REFERENCE='NON_REGRESSION'))
TEST_RESU(RESU=_F(RESULTAT=MODES,PARA='FREQ',NUME_ORDRE=4,VALE=2.24141700E-03,REFERENCE='NON_REGRESSION'))



FIN()
