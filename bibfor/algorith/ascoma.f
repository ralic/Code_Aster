      SUBROUTINE ASCOMA(MESUIV,INSTAP,NUMEDD,SOLVEU,LISCHA,
     &                  MATSUI)
C            CONFIGURATION MANAGEMENT OF EDF VERSION
C MODIF ALGORITH  DATE 17/10/2006   AUTEUR MABBAS M.ABBAS 
C ======================================================================
C COPYRIGHT (C) 1991 - 2001  EDF R&D                  WWW.CODE-ASTER.ORG
C THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY
C IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY
C THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR
C (AT YOUR OPTION) ANY LATER VERSION.
C
C THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT
C WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF
C MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU
C GENERAL PUBLIC LICENSE FOR MORE DETAILS.
C
C YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE
C ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,
C    1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.
C ======================================================================
C RESPONSABLE MABBAS M.ABBAS
      IMPLICIT NONE
      CHARACTER*24  MESUIV,NUMEDD
      CHARACTER*19  SOLVEU,LISCHA
      REAL*8        INSTAP
      CHARACTER*(*) MATSUI
C      
C ----------------------------------------------------------------------
C
C ROUTINE POUR OP0070 (*_NON_LINE)
C
C ASSEMBLAGE DE LA MATRICE DE RIGIDITE ASSOCIEE AUX CHARGEMENTS
C SUIVEURS 
C
C ----------------------------------------------------------------------
C 
C
C IN  MESUIV : MATRICES ELEMENTAIRES DE RIGIDITE
C IN  NUMEDD : NOM DE LA NUMEROTATION MECANIQUE
C IN  LISCHA : SD L_CHARGE
C IN  SOLVEU : NOM DU SOLVEUR DE NEWTON
C IN  INSTAP : INSTANT DE CALCUL
C OUT MATRIG : MATRICE DES FORCES SUIVEUSES ASSEMBLEE
C
C -------------- DEBUT DECLARATIONS NORMALISEES JEVEUX -----------------
C
      INTEGER            ZI
      COMMON  / IVARJE / ZI(1)
      REAL*8             ZR
      COMMON  / RVARJE / ZR(1)
      COMPLEX*16         ZC
      COMMON  / CVARJE / ZC(1)
      LOGICAL            ZL
      COMMON  / LVARJE / ZL(1)
      CHARACTER*8        ZK8
      CHARACTER*16                ZK16
      CHARACTER*24                          ZK24
      CHARACTER*32                                    ZK32
      CHARACTER*80                                              ZK80
      COMMON  / KVARJE / ZK8(1) , ZK16(1) , ZK24(1) , ZK32(1) , ZK80(1)
C
C ---------------- FIN DECLARATIONS NORMALISEES JEVEUX -----------------
C
      LOGICAL BIDON,FCT
      INTEGER            IRET,NBCHME,JMEC,NCHAR,JFONCT
      INTEGER            K,ILICOE,ICHA,IER,JRESU,JCOEF
      REAL*8             VALRES
      CHARACTER*24       LICOEF,FOMULT
      CHARACTER*8        K8BLA
C
      DATA K8BLA /' '/      
C
C ----------------------------------------------------------------------
C
      CALL JEMARQ()
C      
      FOMULT = LISCHA(1:19)//'.FCHA'
      BIDON  = .FALSE.
      CALL JEEXIN(MESUIV,IRET)
      IF ( IRET .NE. 0 ) THEN
        CALL JELIRA(MESUIV,'LONUTI',NBCHME,K8BLA)
        IF ( NBCHME .EQ. 0 ) THEN
          BIDON = .TRUE.
        ELSE
          CALL JEVEUO(MESUIV,'L',JMEC)
          IF ( ZK24(JMEC)(7:8) .EQ. '00' ) THEN
            BIDON = .TRUE.
          ENDIF  
        ENDIF
      ELSE
        CALL ASSERT(.FALSE.)
      ENDIF
      IF (BIDON) THEN
        GOTO 9999
      ENDIF  
C
      LICOEF = '&&ASCOMA.LICOEF'
      CALL JEEXIN(FOMULT,IRET)
      IF ( IRET .EQ. 0 ) THEN
        FCT = .FALSE.
      ELSE
        FCT = .TRUE.
        CALL JELIRA(FOMULT,'LONMAX',NCHAR,K8BLA)
        IF ( NCHAR .EQ. 0 ) GOTO 9999
        CALL JEVEUO(FOMULT,'L',JFONCT)
      ENDIF

      CALL WKVECT(LICOEF,'V V R  ',NBCHME,ILICOE)
      DO 1 K = 1,NBCHME
        IF ( FCT ) THEN
C
C ------- ON RECUPERE LE NUMERO DE LA CHARGE ICHA STOCKEE DANS LE NOM
C ------- DU VECTEUR ASSEMBLE
C
          CALL LXLIIS(ZK24(JMEC+K-1)(7:8),ICHA,IER)
          IF ( ICHA .GT. 0 ) THEN
            CALL FOINTE('F ',ZK24(JFONCT+ICHA-1)(1:8),1,'INST',INSTAP,
     &                  VALRES,IER)
          ELSE
            CALL ASSERT(.FALSE.)
          ENDIF
        ELSE
          VALRES = 1.D0
        ENDIF
        ZR(ILICOE+K-1)  = VALRES
 1    CONTINUE

      CALL WKVECT('&&ASCOMA.LISTE_RESU','V V K24',1,JRESU)
      CALL JEDUPO(MESUIV(1:8)//'.REFE_RESU',
     &            'V','&&ASCOMA.REFE_RESU',.TRUE.)
      CALL WKVECT('&&ASCOMA.LISTE_COEF','V V R',1,JCOEF)
      DO 777,K=1,NBCHME
        ZK24(JRESU) = ZK24(JMEC+K-1)
        ZR(JCOEF)   = ZR(ILICOE+K-1)
        CALL ASMATR(1,'&&ASCOMA','&&ASCOMA.LISTE_COEF',NUMEDD,SOLVEU,
     &              LISCHA,'CUMU','V',1,MATSUI)
 777  CONTINUE
C
      CALL JEDETR('&&ASCOMA.LISTE_RESU')
      CALL JEDETR('&&ASCOMA.REFE_RESU')
      CALL JEDETR('&&ASCOMA.LISTE_COEF')
      CALL JEDETR(LICOEF)
9999  CONTINUE
C 
      CALL JEDEMA()
      END
