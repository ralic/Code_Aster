      SUBROUTINE NMPOST(MODELE,NUMEDD,CARELE,COMPOR,SOLVEU,
     &                  NUMINS,RESULT,MATE  ,COMREF,LISCHA,
     &                  DEFICO,RESOCO,METHOD,PARMET,FONACT,
     &                  CARCRI,ITERAT,SDDISC,SDTIME,VALMOI,
     &                  VALPLU,POUGD ,SOLALG,MATASS,MEELEM,
     &                  MEASSE,VEELEM,SDDYNA)
C
C            CONFIGURATION MANAGEMENT OF EDF VERSION
C MODIF ALGORITH  DATE 06/07/2009   AUTEUR COURTOIS M.COURTOIS 
C ======================================================================
C COPYRIGHT (C) 1991 - 2007  EDF R&D                  WWW.CODE-ASTER.ORG
C THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY  
C IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY  
C THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR     
C (AT YOUR OPTION) ANY LATER VERSION.                                   
C                                                                       
C THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT   
C WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF            
C MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU      
C GENERAL PUBLIC LICENSE FOR MORE DETAILS.                              
C                                                                       
C YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE     
C ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,         
C   1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.         
C ======================================================================
C RESPONSABLE ABBAS M.ABBAS
C TOLE CRP_21 
C
      IMPLICIT     NONE
      INTEGER      NUMINS,ITERAT
      REAL*8       PARMET(*)
      CHARACTER*8  RESULT
      CHARACTER*19 MEELEM(*)
      CHARACTER*24 RESOCO,DEFICO
      CHARACTER*16 METHOD(*)
      CHARACTER*19 MATASS
      CHARACTER*19 LISCHA,SOLVEU,SDDISC,SDDYNA
      CHARACTER*24 MODELE,NUMEDD,CARELE,COMPOR
      CHARACTER*24 VALMOI(8),VALPLU(8)
      CHARACTER*19 VEELEM(*),SOLALG(*)
      CHARACTER*24 MATE,SDTIME
      CHARACTER*24 CARCRI,POUGD,COMREF
      LOGICAL      FONACT(*)
      CHARACTER*19 MEASSE(*)
C
C ----------------------------------------------------------------------
C
C ROUTINE MECA_NON_LINE (ALGORITHME)
C
C CALCULS DE POST-TRAITEMENT (FLAMBEMENT ET MODES VIBRATOIRES)
C      
C ----------------------------------------------------------------------
C
C
C IN  MODELE : MODELE
C IN  NUMEDD : NUME_DDL
C IN  MATE   : CHAMP MATERIAU
C IN  CARELE : CARACTERISTIQUES DES ELEMENTS DE STRUCTURE
C IN  COMREF : VARI_COM DE REFERENCE
C IN  COMPOR : COMPORTEMENT
C IN  LISCHA : LISTE DES CHARGES
C IN  RESOCO : SD RESOLUTION CONTACT
C IN  DEFICO : SD DEF. CONTACT
C IN  SDDYNA : SD POUR LA DYNAMIQUE
C IN  METHOD : INFORMATIONS SUR LES METHODES DE RESOLUTION (VOIR NMLECT)
C IN  PARMET : PARAMETRES DES METHODES DE RESOLUTION (VOIR NMLECT)
C IN  SOLVEU : SOLVEUR
C IN  CARCRI : PARAMETRES METHODES D'INTEGRATION LOCALES (VOIR NMLECT)
C IN  SDDISC : SD DISC_INST
C IN  PREMIE : SI PREMIER INSTANT DE CALCUL
C IN  NUMINS : NUMERO D'INSTANT
C IN  ITERAT : NUMERO D'ITERATION
C IN  VALMOI : VARIABLE CHAPEAU POUR ETAT EN T-
C IN  VALPLU : VARIABLE CHAPEAU POUR ETAT EN T+
C IN  POUGD  : VARIABLE CHAPEAU POUR POUR POUTRES EN GRANDES ROTATIONS
C IN  SOLALG : VARIABLE CHAPEAU POUR INCREMENTS SOLUTIONS
C IN  MATASS : MATRICE ASSEMBLEE GLOBALE
C
C --- DEBUT DECLARATIONS NORMALISEES JEVEUX ----------------------------
C
      INTEGER            ZI
      COMMON  / IVARJE / ZI(1)
      REAL*8             ZR
      COMMON  / RVARJE / ZR(1)
      COMPLEX*16         ZC
      COMMON  / CVARJE / ZC(1)
      LOGICAL            ZL
      COMMON  / LVARJE / ZL(1)
      CHARACTER*8        ZK8
      CHARACTER*16                ZK16
      CHARACTER*24                          ZK24
      CHARACTER*32                                    ZK32
      CHARACTER*80                                              ZK80
      COMMON  / KVARJE / ZK8(1) , ZK16(1) , ZK24(1) , ZK32(1) , ZK80(1)
C
C -------------- FIN  DECLARATIONS  NORMALISEES  JEVEUX ----------------
C
      LOGICAL      ISFONC,LMVIB,LFLAM
      LOGICAL      NDYNLO,LSTAT ,LIMPL
      LOGICAL      CALCUL
      INTEGER      DIARCH,NUMARC
      INTEGER      IRET
      CHARACTER*8  OPTFLA
      CHARACTER*24 PASCAL
C      
C ----------------------------------------------------------------------
C
      CALL JEMARQ()
C
C --- FONCTIONNALITES ACTIVEES
C
      LMVIB  = ISFONC(FONACT,'MODE_VIBR')
      LFLAM  = ISFONC(FONACT,'CRIT_FLAMB')
      LSTAT  = NDYNLO(SDDYNA,'STATIQUE')
      LIMPL  = NDYNLO(SDDYNA,'IMPLICITE') 
C            
C -- DOIT-ON FAIRE LE CALCUL ?
C
      IF (LFLAM) THEN
        CALL GETVTX('CRIT_FLAMB','INST_CALCUL',1,1,1,PASCAL  ,IRET)   
      ELSEIF (LMVIB) THEN
        CALL GETVTX('MODE_VIBR','INST_CALCUL',1,1,1,PASCAL  ,IRET)
      ELSE
        GOTO 999  
      ENDIF
C    
      IF (PASCAL(1:8).EQ.'TOUT_PAS') THEN
        CALCUL = .TRUE.
      ELSEIF (PASCAL(1:15).EQ.'LISTE_ARCHIVAGE') THEN
        NUMARC = DIARCH(SDDISC,NUMINS,.FALSE.,.FALSE.)
        IF (NUMARC.EQ.-1) THEN
          CALCUL = .FALSE.
        ELSE
          CALCUL = .TRUE.  
        ENDIF 
      ENDIF  
C            
C -- CALCUL DE FLAMBEMENT EN STATIQUE ET DYNAMIQUE
C
      IF (LFLAM) THEN
        IF (CALCUL) THEN
          IF (LSTAT) THEN
            OPTFLA = 'FLAMBSTA'
          ELSE IF (LIMPL) THEN
            OPTFLA = 'FLAMBDYN'
          ELSE
            CALL ASSERT(.FALSE.)
          ENDIF
          CALL NMIMPR('TITR','POST','FLAMBEMENT        ',0.D0,0)
C
C --- CALCUL EFFECTIF
C
          CALL NMFLAM(MODELE,NUMEDD,CARELE,COMPOR,SOLVEU,
     &                NUMINS,RESULT,MATE  ,COMREF,LISCHA,
     &                DEFICO,RESOCO,METHOD,PARMET,FONACT,
     &                CARCRI,ITERAT,SDDISC,SDTIME,OPTFLA,
     &                VALMOI,VALPLU,POUGD ,SOLALG,MATASS,
     &                MEELEM,MEASSE,VEELEM,SDDYNA)
        ENDIF  
      ENDIF
C
C --- CALCUL DE MODES VIBRATOIRES EN DYNAMIQUE
C
      IF (LMVIB) THEN
        IF (CALCUL) THEN
          IF (LSTAT) THEN
            CALL ASSERT(.FALSE.)
          ELSE IF (LIMPL) THEN
            OPTFLA = 'VIBRDYNA'
          ELSE
            CALL ASSERT(.FALSE.)
          ENDIF
          CALL NMIMPR('TITR','POST','MODES VIBRATOIRES ',0.D0,0)
C
C --- CALCUL EFFECTIF
C
          CALL NMFLAM(MODELE,NUMEDD,CARELE,COMPOR,SOLVEU,
     &                NUMINS,RESULT,MATE  ,COMREF,LISCHA,
     &                DEFICO,RESOCO,METHOD,PARMET,FONACT,
     &                CARCRI,ITERAT,SDDISC,SDTIME,OPTFLA,
     &                VALMOI,VALPLU,POUGD ,SOLALG,MATASS,
     &                MEELEM,MEASSE,VEELEM,SDDYNA)
        ENDIF  
      ENDIF
C
 999  CONTINUE      
C
      CALL JEDEMA()      
C   
      END
