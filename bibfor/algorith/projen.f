      SUBROUTINE PROJEN(IZONE ,NDIM  ,NEWGEO,RESOCO,DEFICO,
     &                  POSESC,POSMAI,NORM  ,TANG  ,COEF  ,
     &                  COFX  ,COFY  ,JEU   ,NBNOM ,POSNO ,
     &                  NBDDLT,DDL)
C     
C            CONFIGURATION MANAGEMENT OF EDF VERSION
C MODIF ALGORITH  DATE 24/09/2007   AUTEUR ABBAS M.ABBAS 
C ======================================================================
C COPYRIGHT (C) 1991 - 2007  EDF R&D                  WWW.CODE-ASTER.ORG
C THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY  
C IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY  
C THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR     
C (AT YOUR OPTION) ANY LATER VERSION.                                   
C                                                                       
C THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT   
C WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF            
C MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU      
C GENERAL PUBLIC LICENSE FOR MORE DETAILS.                              
C                                                                       
C YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE     
C ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,         
C   1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.         
C ======================================================================
C RESPONSABLE ABBAS M.ABBAS
C
      IMPLICIT     NONE
      INTEGER      IZONE
      INTEGER      NDIM
      CHARACTER*24 NEWGEO
      CHARACTER*24 RESOCO
      CHARACTER*24 DEFICO
      INTEGER      POSESC
      INTEGER      POSMAI
      REAL*8       NORM(3)
      REAL*8       TANG(6)
      REAL*8       COEF(30),COFX(30),COFY(30)       
      REAL*8       JEU
      INTEGER      NBNOM
      INTEGER      POSNO(10)
      INTEGER      DDL(30)  
      INTEGER      NBDDLT  
C      
C ----------------------------------------------------------------------
C
C ROUTINE CONTACT (METHODES DISCRETES - APPARIEMENT - NODAL)
C
C APPARIEMENT NODAL
C
C ----------------------------------------------------------------------
C
C
C IN  IZONE  : NUMERO DE LA ZONE DE CONTACT
C IN  NDIM   : DIMENSION DE L'ESPACE (2 OU 3)
C IN  NEWGEO : GEOMETRIE ACTUALISEE EN TENANT COMPTE DU CHAMP DE
C              DEPLACEMENTS COURANT
C VAR RESOCO : SD DE TRAITEMENT NUMERIQUE DU CONTACT
C IN  DEFICO : SD DE DEFINITION DU CONTACT (ISSUE D'AFFE_CHAR_MECA)
C IN  POSESC : INDICE DU NOEUD ESCLAVE DANS CONTNO
C IN  POSMAI : INDICE DU NOEUD MAITRE DANS CONTNO 
C OUT NORM   : DIRECTION DE PROJECTION (DIRECTION PM NORMEE)
C I/O TANG   : LES DEUX VECTEURS TANGENTS
C OUT COEF   : COEFFICIENTS LIES AU NOEUD ESCLAVE ET AUX NOEUDS MAITRES
C              (DIRECTION NORMALE)
C OUT COEFX  : COEFFICIENTS LIES AU NOEUD ESCLAVE ET AUX NOEUDS MAITRES
C              (PROJECTION SUR LA PREMIERE TANGENTE)
C OUT COEFY  : COEFFICIENTS LIES AU NOEUD ESCLAVE ET AUX NOEUDS MAITRES
C              (PROJECTION SUR LA SECONDE TANGENTE)
C OUT OLDJEU : JEU OBTENU AVANT CORRECTION
C OUT JEU    : VALEUR DU JEU APRES CORRECTION
C OUT NBNOM  : NOMBRE DE NOEUDS MAITRES CONCERNES
C OUT POSNO  : INDICES DANS CONTNO DES NOEUDS ESCLAVE ET MAITRES
C OUT NBDDLT : NOMBRE DE DDL NOEUD ESCLAVE+NOEUDS MAITRES
C OUT DDL    : NUMEROS DES DDLS ESCLAVE ET MAITRES CONCERNES
C
C -------------- DEBUT DECLARATIONS NORMALISEES JEVEUX -----------------
C
      INTEGER            ZI
      COMMON  / IVARJE / ZI(1)
      REAL*8             ZR
      COMMON  / RVARJE / ZR(1)
      COMPLEX*16         ZC
      COMMON  / CVARJE / ZC(1)
      LOGICAL            ZL
      COMMON  / LVARJE / ZL(1)
      CHARACTER*8        ZK8
      CHARACTER*16                ZK16
      CHARACTER*24                          ZK24
      CHARACTER*32                                    ZK32
      CHARACTER*80                                              ZK80
      COMMON  / KVARJE / ZK8(1) , ZK16(1) , ZK24(1) , ZK32(1) , ZK80(1)
C
C ---------------- FIN DECLARATIONS NORMALISEES JEVEUX -----------------
C
      REAL*8       COORDP(3),COORDM(3)
      INTEGER      NBDDLE,POSNOM
      INTEGER      LISSA,MOYEN  
      REAL*8       COEFNO(9),ENORM(3),MNORM(3)              
C
C ----------------------------------------------------------------------
C
      CALL JEMARQ()
C
C --- CARACTERISTIQUES DU NOEUD ESCLAVE
C
      CALL CARANO(IZONE ,DEFICO,RESOCO,NEWGEO,NDIM  ,
     &            POSESC,COORDP,ENORM ,NBDDLE)  
C
C --- NOEUD ESCLAVE
C
      POSNO(1) = POSESC 
C
C --- NOEUD MAITRE
C     
      POSNO(2) = ABS(POSMAI)
      POSNOM   = POSNO(2)       
C
C --- CARACTERISTIQUES DU NOEUD MAITRE
C
      CALL CARANM(DEFICO,RESOCO,NEWGEO,POSNOM,IZONE,
     &            MOYEN ,LISSA ,COORDM,MNORM)
C
C --- "PROJECTION" SUR LE NOEUD
C
      IF (POSMAI.LT.0) THEN
        NBNOM    = 1
        CALL PROJNO(DEFICO,IZONE ,NDIM  ,ENORM ,MNORM,
     &              COORDP,COORDM,COEFNO,MOYEN,
     &              NORM  ,TANG  ,JEU)
      ELSEIF (POSMAI.EQ.0) THEN
        NBNOM    = 0
        JEU      = 0.D0      
      ELSE
        CALL ASSERT(.FALSE.)
      ENDIF           
C
C --- CALCULE LES COEFFICIENTS DES RELATIONS LINEAIRES ET DONNE LES 
C --- NUMEROS DES DDL ASSOCIES
C
      CALL CFCOEF(NDIM  ,DEFICO,NBDDLE,NBNOM,POSNO ,
     &            COEFNO,NORM  ,TANG  ,COEF  ,            
     &            COFX  ,COFY  ,NBDDLT,DDL)
C
      CALL JEDEMA()
      
      END
