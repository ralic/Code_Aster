      SUBROUTINE WPTEST(EXCLU,XH,XB,VP,NEQ,NMAX)
      IMPLICIT REAL*8 (A-H,O-Z)
C
      COMPLEX*16 VP,XH(*),XB(*)
      INTEGER    NEQ,EXCLU(*)
      REAL*8     NMAX
C     -----------------------------------------------------------------
C            CONFIGURATION MANAGEMENT OF EDF VERSION
C MODIF ALGELINE  DATE 08/03/2004   AUTEUR REZETTE C.REZETTE 
C ======================================================================
C COPYRIGHT (C) 1991 - 2001  EDF R&D                  WWW.CODE-ASTER.ORG
C THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY
C IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY
C THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR   
C (AT YOUR OPTION) ANY LATER VERSION.                                 
C
C THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT 
C WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF          
C MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU    
C GENERAL PUBLIC LICENSE FOR MORE DETAILS.                            
C
C YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE   
C ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,       
C    1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.      
C ======================================================================
C
C     TEST SUR LE COUPLAGE HAUT-BAS DU PB GENERALISE ASSOCIE AU PB
C     QUADRATIQUE POUR CHOISIR LA VALEUR PROPRE QUADRATIQUE RACINE
C     D' UNE EQUATION DE SECOND DEGRE (CF WP2VEC)
C
C              NMAX := !! M*XB - VP*M*XH !!
C     -----------------------------------------------------------------
C IN  XH   : C : PARTIE HAUTE D' UN VECTEUR PROPRE DU PB QUAD
C IN  XB   : C : PARTIE BASSE D' UN VECTEUR PROPRE DU PB QUAD
C IN  VP   : C : VALEUR CANDIDATE A LA PROPRETE
C IN  NEQ  : I : TAILLE DES VECTEURS DU PB QUADRATIQUE
C OUT NMAX : R : NORME MAX DU COUPLAGE
C     -----------------------------------------------------------------
      INTEGER    I
      REAL*8     A
C     -----------------------------------------------------------------
C
      NMAX  = -1.0D-50
C
C     --- TEST SUR LA PARTIE BASSE : COUPLAGE ----
C
C-DEB
C
C     /* CE QUI SUIT MARCHE POUR UNE MATRICE DE MASSE GENERALE */
C
C     CALL MRMULT('ZERO',LMASSE,XH,'C',V1,1)
C     CALL MRMULT('ZERO',LMASSE,XB,'C',V2,1)
C
C     DO 10, I = 1, NEQ, 1
C        A    = ABS(VP*V1(I)-V2(I))
C        NMAX = MAX(A,NMAX)
C10    CONTINUE
C
C-FIN
C
C     /* CE QUI SUIT MARCHE POUR UNE MATRICE DE MASSE      */
C     /* AVEC DECOMPOSITION BLOC CONFORME A LA DOC DE REF */
C     /* I.E : BLOCS ASSOCIES AUX DDL LAGR A ZERO         */
C
      DO 20, I = 1, NEQ, 1
         A    = ABS(VP*XH(I)-XB(I))*EXCLU(I)
         NMAX = MAX(A,NMAX)
20    CONTINUE
C
      END
