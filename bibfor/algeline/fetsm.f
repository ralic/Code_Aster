      SUBROUTINE FETSM(OPTMPI,NBSD,IFM,NIV,RANG,NBPROC)
C-----------------------------------------------------------------------
C            CONFIGURATION MANAGEMENT OF EDF VERSION
C MODIF ALGELINE  DATE 20/06/2005   AUTEUR BOITEAU O.BOITEAU 
C ======================================================================
C COPYRIGHT (C) 1991 - 2005  EDF R&D                  WWW.CODE-ASTER.ORG
C THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY  
C IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY  
C THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR     
C (AT YOUR OPTION) ANY LATER VERSION.                                   
C                                                                       
C THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT   
C WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF            
C MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU      
C GENERAL PUBLIC LICENSE FOR MORE DETAILS.                              
C                                                                       
C YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE     
C ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,         
C   1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.         
C ======================================================================
C-----------------------------------------------------------------------
C    - FONCTION REALISEE:  COQUILLE VIDE SI PAS DE COMPIL MPI POUR FETI
C               PENDANT DE FETAM.F, TOUS DEUX APPELES PAR FETMPI.C
C
C ARGUMENTS D'APPELS
C IN OPTMPI  : OPTION DE LA ROUTINE
C    =1        CREATION OBJET JEVEUX  '&FETI.LISTE.SD.MPI' POUR BOUCLE
C              SEQUENTIELLE SUR LES SOUS-DOMAINES
C    =2        RANG DU PROCESSUS
C    =3        NOMBRE DE PROCESSEURS
C    =4/5/6/7  SANS OBJET SANS MPI
C IN NBSD    : NOMBRE DE SOUS-DOMAINES (SI OPTMI=1)
C IN IFM,NIV : NIVEAU D'IMPRESSION (SI NIV.GE.2 IMPRESSION, DOIT ETRE
C              CONTROLE PAR INFOFE(10:10) DANS ROUTINE APPELANTE)
C OUT RANG   : RANG DU PROCESSUS (SI OPTMI=2)
C OUT NBPROC : RANG DU PROCESSUS (SI OPTMI=3)
C----------------------------------------------------------------------
C RESPONSABLE BOITEAU O.BOITEAU
C CORPS DU PROGRAMME
      IMPLICIT NONE

C DECLARATION PARAMETRES D'APPELS
      INTEGER      OPTMPI,IFM,NIV,NBSD,RANG,NBPROC

C --- DEBUT DECLARATIONS NORMALISEES JEVEUX ----------------------------
      INTEGER ZI
      COMMON /IVARJE/ZI(1)
      REAL*8 ZR
      COMMON /RVARJE/ZR(1)
      COMPLEX*16 ZC
      COMMON /CVARJE/ZC(1)
      CHARACTER*8 ZK8
      CHARACTER*16 ZK16
      CHARACTER*24 ZK24
      CHARACTER*32 ZK32
      CHARACTER*80 ZK80
      COMMON /KVARJE/ZK8(1),ZK16(1),ZK24(1),ZK32(1),ZK80(1)
C --- FIN DECLARATIONS NORMALISEES JEVEUX ------------------------------

C DECLARATION VARIABLES LOCALES
      INTEGER      NBSD1,ILIST,IDD,IEXIST
      CHARACTER*24 NOMLOG

C CORPS DU PROGRAMME
      CALL JEMARQ()
      
      IF (OPTMPI.EQ.1) THEN
        NBSD1=NBSD+1
        NOMLOG='&FETI.LISTE.SD.MPI'
        CALL JEEXIN(NOMLOG,IEXIST)       
        IF (IEXIST.NE.0)
     &    CALL UTMESS('F','FETSM','&FETI.LISTE.SD.MPI EXISTE DEJA !')
        CALL WKVECT(NOMLOG,'V V I',NBSD1,ILIST)
        DO 200 IDD=0,NBSD
          ZI(ILIST+IDD)=1
  200   CONTINUE
        NOMLOG='&FETI.LISTE.SD.MPIB'
        CALL JEEXIN(NOMLOG,IEXIST)       
        IF (IEXIST.NE.0)
     &    CALL UTMESS('F','FETSM','&FETI.LISTE.SD.MPIB EXISTE DEJA !')
        CALL WKVECT(NOMLOG,'V V I',NBSD,ILIST)
        DO 201 IDD=1,NBSD
          ZI(ILIST+IDD-1)=0
  201   CONTINUE
        RANG=0
        NBPROC=1
C MONITORING
        IF (NIV.GE.2) THEN
          CALL UTIMSD(IFM,2,.FALSE.,.TRUE.,NOMLOG(1:19),1,'V')
          WRITE(IFM,*)'<FETI/FETSM> RANG/NBPROC ',RANG,NBPROC
        ENDIF
      ELSE IF (OPTMPI.EQ.2) THEN
        RANG=0
C MONITORING
        IF (NIV.GE.2) WRITE(IFM,*)'<FETI/FETSM> RANG ',RANG
      ELSE IF (OPTMPI.EQ.3) THEN
        NBPROC=1
C MONITORING
        IF (NIV.GE.2) WRITE(IFM,*)'<FETI/FETSM> NBPROC ',NBPROC
      ELSE IF ((OPTMPI.GE.4).AND.(OPTMPI.LE.10)) THEN
C MONITORING
        IF (NIV.GE.2) WRITE(IFM,*)'<FETI/FETSM> OPTMPI=',OPTMPI,' VIDE '
      ELSE
        CALL UTMESS('F','FETSM','OPTION NON PREVUE EN NON COMPILE MPI')
      ENDIF
      CALL JEDEMA()       
      END
